/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var $c=Object.create;var Br=Object.defineProperty,Wc=Object.defineProperties,Uc=Object.getOwnPropertyDescriptor,Gc=Object.getOwnPropertyDescriptors,Qc=Object.getOwnPropertyNames,vo=Object.getOwnPropertySymbols,qc=Object.getPrototypeOf,_o=Object.prototype.hasOwnProperty,Yc=Object.prototype.propertyIsEnumerable;var bo=(t,e,r)=>e in t?Br(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ce=(t,e)=>{for(var r in e||(e={}))_o.call(e,r)&&bo(t,r,e[r]);if(vo)for(var r of vo(e))Yc.call(e,r)&&bo(t,r,e[r]);return t},ke=(t,e)=>Wc(t,Gc(e)),xo=t=>Br(t,"__esModule",{value:!0});var vn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Jc=(t,e)=>{xo(t);for(var r in e)Br(t,r,{get:e[r],enumerable:!0})},Xc=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Qc(e))!_o.call(t,n)&&n!=="default"&&Br(t,n,{get:()=>e[n],enumerable:!(r=Uc(e,n))||r.enumerable});return t},Fe=t=>Xc(xo(Br(t!=null?$c(qc(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Oa=vn((fn,Ms)=>{(function(t,e){if(typeof fn=="object"&&typeof Ms=="object")Ms.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var r=e();for(var n in r)(typeof fn=="object"?fn:t)[n]=r[n]}})(typeof self!="undefined"?self:fn,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(n,i,s){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},r.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var o in n)r.d(s,o,function(a){return n[a]}.bind(null,o));return s},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"md5",function(){return w});var n="0123456789abcdef".split(""),i=function(x){for(var p="",b=0;b<4;b++)p+=n[x>>8*b+4&15]+n[x>>8*b&15];return p},s=function(x){for(var p=x.length,b=0;b<p;b++)x[b]=i(x[b]);return x.join("")},o=function(x,p){return x+p&4294967295},a=function(x,p,b,m,g,_,y){return function(j,C,S){return o(j<<C|j>>>32-C,S)}(p=function(j,C,S,E){return C=o(o(C,j),o(S,E))}(x,p,m,_),g,b)},u=function(x,p,b,m,g,_,y,j){return a(b&m|~b&g,p,b,_,y,j,x)},l=function(x,p,b,m,g,_,y,j){return a(b&g|m&~g,p,b,_,y,j,x)},f=function(x,p,b,m,g,_,y,j){return a(b^m^g,p,b,_,y,j,x)},h=function(x,p,b,m,g,_,y,j){return a(m^(b|~g),p,b,_,y,j,x)},c=function(x,p,b){b===void 0&&(b=o);var m=x[0],g=x[1],_=x[2],y=x[3],j=u.bind(null,b);m=j(m,g,_,y,p[0],7,-680876936),y=j(y,m,g,_,p[1],12,-389564586),_=j(_,y,m,g,p[2],17,606105819),g=j(g,_,y,m,p[3],22,-1044525330),m=j(m,g,_,y,p[4],7,-176418897),y=j(y,m,g,_,p[5],12,1200080426),_=j(_,y,m,g,p[6],17,-1473231341),g=j(g,_,y,m,p[7],22,-45705983),m=j(m,g,_,y,p[8],7,1770035416),y=j(y,m,g,_,p[9],12,-1958414417),_=j(_,y,m,g,p[10],17,-42063),g=j(g,_,y,m,p[11],22,-1990404162),m=j(m,g,_,y,p[12],7,1804603682),y=j(y,m,g,_,p[13],12,-40341101),_=j(_,y,m,g,p[14],17,-1502002290),g=j(g,_,y,m,p[15],22,1236535329);var C=l.bind(null,b);m=C(m,g,_,y,p[1],5,-165796510),y=C(y,m,g,_,p[6],9,-1069501632),_=C(_,y,m,g,p[11],14,643717713),g=C(g,_,y,m,p[0],20,-373897302),m=C(m,g,_,y,p[5],5,-701558691),y=C(y,m,g,_,p[10],9,38016083),_=C(_,y,m,g,p[15],14,-660478335),g=C(g,_,y,m,p[4],20,-405537848),m=C(m,g,_,y,p[9],5,568446438),y=C(y,m,g,_,p[14],9,-1019803690),_=C(_,y,m,g,p[3],14,-187363961),g=C(g,_,y,m,p[8],20,1163531501),m=C(m,g,_,y,p[13],5,-1444681467),y=C(y,m,g,_,p[2],9,-51403784),_=C(_,y,m,g,p[7],14,1735328473),g=C(g,_,y,m,p[12],20,-1926607734);var S=f.bind(null,b);m=S(m,g,_,y,p[5],4,-378558),y=S(y,m,g,_,p[8],11,-2022574463),_=S(_,y,m,g,p[11],16,1839030562),g=S(g,_,y,m,p[14],23,-35309556),m=S(m,g,_,y,p[1],4,-1530992060),y=S(y,m,g,_,p[4],11,1272893353),_=S(_,y,m,g,p[7],16,-155497632),g=S(g,_,y,m,p[10],23,-1094730640),m=S(m,g,_,y,p[13],4,681279174),y=S(y,m,g,_,p[0],11,-358537222),_=S(_,y,m,g,p[3],16,-722521979),g=S(g,_,y,m,p[6],23,76029189),m=S(m,g,_,y,p[9],4,-640364487),y=S(y,m,g,_,p[12],11,-421815835),_=S(_,y,m,g,p[15],16,530742520),g=S(g,_,y,m,p[2],23,-995338651);var E=h.bind(null,b);m=E(m,g,_,y,p[0],6,-198630844),y=E(y,m,g,_,p[7],10,1126891415),_=E(_,y,m,g,p[14],15,-1416354905),g=E(g,_,y,m,p[5],21,-57434055),m=E(m,g,_,y,p[12],6,1700485571),y=E(y,m,g,_,p[3],10,-1894986606),_=E(_,y,m,g,p[10],15,-1051523),g=E(g,_,y,m,p[1],21,-2054922799),m=E(m,g,_,y,p[8],6,1873313359),y=E(y,m,g,_,p[15],10,-30611744),_=E(_,y,m,g,p[6],15,-1560198380),g=E(g,_,y,m,p[13],21,1309151649),m=E(m,g,_,y,p[4],6,-145523070),y=E(y,m,g,_,p[11],10,-1120210379),_=E(_,y,m,g,p[2],15,718787259),g=E(g,_,y,m,p[9],21,-343485551),x[0]=b(m,x[0]),x[1]=b(g,x[1]),x[2]=b(_,x[2]),x[3]=b(y,x[3])},d=function(x){for(var p=[],b=0;b<64;b+=4)p[b>>2]=x.charCodeAt(b)+(x.charCodeAt(b+1)<<8)+(x.charCodeAt(b+2)<<16)+(x.charCodeAt(b+3)<<24);return p},v=function(x,p){var b,m=x.length,g=[1732584193,-271733879,-1732584194,271733878];for(b=64;b<=m;b+=64)c(g,d(x.substring(b-64,b)),p);var _=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=(x=x.substring(b-64)).length;for(b=0;b<y;b++)_[b>>2]|=x.charCodeAt(b)<<(b%4<<3);if(_[b>>2]|=128<<(b%4<<3),b>55)for(c(g,_,p),b=16;b--;)_[b]=0;return _[14]=8*m,c(g,_,p),g};function w(x){var p;return s(v("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(p=function(b,m){var g=(65535&b)+(65535&m);return(b>>16)+(m>>16)+(g>>16)<<16|65535&g}),s(v(x,p))}}])})});var al=vn(oi=>{oi.parse=function(t,e){if(e?e.offsets=typeof e.offsets=="undefined"?!0:e.offsets:e={offsets:!0},t||(t=""),t.indexOf(":")===-1&&!e.tokenize)return t;if(!e.keywords&&!e.ranges&&!e.tokenize)return t;var r={text:[]};e.offsets&&(r.offsets=[]);for(var n={},i=[],s=/(\S+:'(?:[^'\\]|\\.)*')|(\S+:"(?:[^"\\]|\\.)*")|(-?"(?:[^"\\]|\\.)*")|(-?'(?:[^'\\]|\\.)*')|\S+|\S+:\S+/g,o;(o=s.exec(t))!==null;){var c=o[0],a=c.indexOf(":");if(a!==-1){var u=c.split(":"),l=c.slice(0,a),f=c.slice(a+1);f=f.replace(/^\"|\"$|^\'|\'$/g,""),f=(f+"").replace(/\\(.?)/g,function(y,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),i.push({keyword:l,value:f,offsetStart:o.index,offsetEnd:o.index+c.length})}else{var h=!1;c[0]==="-"&&(h=!0,c=c.slice(1)),c=c.replace(/^\"|\"$|^\'|\'$/g,""),c=(c+"").replace(/\\(.?)/g,function(y,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),h?n.text?(n.text instanceof Array||(n.text=[n.text]),n.text.push(c)):n.text=c:i.push({text:c,offsetStart:o.index,offsetEnd:o.index+c.length})}}i.reverse();for(var c;c=i.pop();)if(c.text)r.text.push(c.text),e.offsets&&r.offsets.push(c);else{var l=c.keyword;e.keywords=e.keywords||[];var d=!1,v=!1;if(!/^-/.test(l))d=e.keywords.indexOf(l)!==-1;else if(l[0]==="-"){var w=l.slice(1);d=e.keywords.indexOf(w)!==-1,d&&(l=w,v=!0)}e.ranges=e.ranges||[];var x=e.ranges.indexOf(l)!==-1;if(d){e.offsets&&r.offsets.push({keyword:l,value:c.value,offsetStart:v?c.offsetStart+1:c.offsetStart,offsetEnd:c.offsetEnd});var p=c.value;if(p.length){var b=p.split(",");v?n[l]?n[l]instanceof Array?b.length>1?n[l]=n[l].concat(b):n[l].push(p):(n[l]=[n[l]],n[l].push(p)):b.length>1?n[l]=b:e.alwaysArray?n[l]=[p]:n[l]=p:r[l]?r[l]instanceof Array?b.length>1?r[l]=r[l].concat(b):r[l].push(p):(r[l]=[r[l]],r[l].push(p)):b.length>1?r[l]=b:e.alwaysArray?r[l]=[p]:r[l]=p}}else if(x){e.offsets&&r.offsets.push(c);var p=c.value,m=p.split("-");r[l]={},m.length===2?(r[l].from=m[0],r[l].to=m[1]):!m.length%2||(r[l].from=p)}else{var g=c.keyword+":"+c.value;r.text.push(g),e.offsets&&r.offsets.push({text:g,offsetStart:c.offsetStart,offsetEnd:c.offsetEnd})}}return r.text.length?e.tokenize||(r.text=r.text.join(" ").trim()):delete r.text,r.exclude=n,r};oi.stringify=function(t,e,r){if(e||(e={offsets:!0}),!t)return"";if(typeof t=="string")return t;if(Array.isArray(t))return t.join(" ");if(!Object.keys(t).length)return"";if(Object.keys(t).length===3&&!!t.text&&!!t.offsets&&!!t.exclude&&typeof t.text=="string")return t.text;r||(r="");var n=function(a){return a.indexOf(" ")>-1?JSON.stringify(a):a},i=function(a){return r+a},s=[];if(t.text){var o=[];typeof t.text=="string"?o.push(t.text):o.push.apply(o,t.text),o.length>0&&s.push(o.map(n).map(i).join(" "))}return e.keywords&&e.keywords.forEach(function(a){if(!!t[a]){var u=[];typeof t[a]=="string"?u.push(t[a]):u.push.apply(u,t[a]),u.length>0&&s.push(i(a+":"+u.map(n).join(",")))}}),e.ranges&&e.ranges.forEach(function(a){if(!!t[a]){var u=t[a].from,l=t[a].to;l&&(u=u+"-"+l),u&&s.push(i(a+":"+u))}}),t.exclude&&Object.keys(t.exclude).length>0&&s.push(oi.stringify(t.exclude,e,"-")),s.join(" ")}});var ul=vn((u_,ll)=>{ll.exports=al()});var Ac=vn(Ei=>{function po(t){return po=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},po(t)}(function(t,e){if(typeof define=="function"&&define.amd)define(["exports"],e);else if(typeof Ei!="undefined")e(Ei);else{var r={exports:{}};e(r.exports),t.CancelablePromise=r.exports}})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:Ei,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelablePromise=void 0,t.cancelable=L,t.default=void 0,t.isCancelablePromise=O;function e(A,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(F&&F.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),F&&r(A,F)}function r(A,F){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,k){return N.__proto__=k,N},r(A,F)}function n(A){var F=o();return function(){var N=a(A),k;if(F){var X=a(this).constructor;k=Reflect.construct(N,arguments,X)}else k=N.apply(this,arguments);return i(this,k)}}function i(A,F){if(F&&(po(F)==="object"||typeof F=="function"))return F;if(F!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(A)}function s(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(A){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(T){return T.__proto__||Object.getPrototypeOf(T)},a(A)}function u(A,F){var T=typeof Symbol!="undefined"&&A[Symbol.iterator]||A["@@iterator"];if(!T){if(Array.isArray(A)||(T=l(A))||F&&A&&typeof A.length=="number"){T&&(A=T);var N=0,k=function(){};return{s:k,n:function(){return N>=A.length?{done:!0}:{done:!1,value:A[N++]}},e:function(te){throw te},f:k}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var X=!0,le=!1,_e;return{s:function(){T=T.call(A)},n:function(){var te=T.next();return X=te.done,te},e:function(te){le=!0,_e=te},f:function(){try{!X&&T.return!=null&&T.return()}finally{if(le)throw _e}}}}function l(A,F){if(!!A){if(typeof A=="string")return f(A,F);var T=Object.prototype.toString.call(A).slice(8,-1);if(T==="Object"&&A.constructor&&(T=A.constructor.name),T==="Map"||T==="Set")return Array.from(A);if(T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T))return f(A,F)}}function f(A,F){(F==null||F>A.length)&&(F=A.length);for(var T=0,N=new Array(F);T<F;T++)N[T]=A[T];return N}function h(A,F){if(!(A instanceof F))throw new TypeError("Cannot call a class as a function")}function c(A,F){for(var T=0;T<F.length;T++){var N=F[T];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(A,N.key,N)}}function d(A,F,T){return F&&c(A.prototype,F),T&&c(A,T),Object.defineProperty(A,"prototype",{writable:!1}),A}function v(A,F,T){return F in A?Object.defineProperty(A,F,{value:T,enumerable:!0,configurable:!0,writable:!0}):A[F]=T,A}function w(A,F,T){x(A,F),F.set(A,T)}function x(A,F){if(F.has(A))throw new TypeError("Cannot initialize the same private elements twice on an object")}function p(A,F){var T=g(A,F,"get");return b(A,T)}function b(A,F){return F.get?F.get.call(A):F.value}function m(A,F,T){var N=g(A,F,"set");return _(A,N,T),T}function g(A,F,T){if(!F.has(A))throw new TypeError("attempted to "+T+" private field on non-instance");return F.get(A)}function _(A,F,T){if(F.set)F.set.call(A,T);else{if(!F.writable)throw new TypeError("attempted to set read only private field");F.value=T}}var y=typeof Symbol!="undefined"?Symbol.toStringTag:"@@toStringTag",j=new WeakMap,C=new WeakMap,S=function(){function A(F){var T=F.executor,N=T===void 0?function(){}:T,k=F.internals,X=k===void 0?Z():k,le=F.promise,_e=le===void 0?new Promise(function(Ce,te){return N(Ce,te,function(Y){X.onCancelList.push(Y)})}):le;h(this,A),w(this,j,{writable:!0,value:void 0}),w(this,C,{writable:!0,value:void 0}),v(this,y,"CancelablePromise"),this.cancel=this.cancel.bind(this),m(this,j,X),m(this,C,_e||new Promise(function(Ce,te){return N(Ce,te,function(Y){X.onCancelList.push(Y)})}))}return d(A,[{key:"then",value:function(T,N){return J(p(this,C).then(z(T,p(this,j)),z(N,p(this,j))),p(this,j))}},{key:"catch",value:function(T){return J(p(this,C).catch(z(T,p(this,j))),p(this,j))}},{key:"finally",value:function(T,N){var k=this;return N&&p(this,j).onCancelList.push(T),J(p(this,C).finally(z(function(){if(T)return N&&(p(k,j).onCancelList=p(k,j).onCancelList.filter(function(X){return X!==T})),T()},p(this,j))),p(this,j))}},{key:"cancel",value:function(){p(this,j).isCanceled=!0;var T=p(this,j).onCancelList;p(this,j).onCancelList=[];var N=u(T),k;try{for(N.s();!(k=N.n()).done;){var X=k.value;if(typeof X=="function")try{X()}catch(le){console.error(le)}}}catch(le){N.e(le)}finally{N.f()}}},{key:"isCanceled",value:function(){return p(this,j).isCanceled===!0}}]),A}(),E=function(A){e(T,A);var F=n(T);function T(N){return h(this,T),F.call(this,{executor:N})}return d(T)}(S);t.CancelablePromise=E,v(E,"all",function(F){return q(F,Promise.all(F))}),v(E,"allSettled",function(F){return q(F,Promise.allSettled(F))}),v(E,"any",function(F){return q(F,Promise.any(F))}),v(E,"race",function(F){return q(F,Promise.race(F))}),v(E,"resolve",function(F){return L(Promise.resolve(F))}),v(E,"reject",function(F){return L(Promise.reject(F))}),v(E,"isCancelable",O);var P=E;t.default=P;function L(A){return J(A,Z())}function O(A){return A instanceof E||A instanceof S}function z(A,F){if(A)return function(T){if(!F.isCanceled){var N=A(T);return O(N)&&F.onCancelList.push(N.cancel),N}return T}}function J(A,F){return new S({internals:F,promise:A})}function q(A,F){var T=Z();return T.onCancelList.push(function(){var N=u(A),k;try{for(N.s();!(k=N.n()).done;){var X=k.value;O(X)&&X.cancel()}}catch(le){N.e(le)}finally{N.f()}}),new S({internals:T,promise:F})}function Z(){return{isCanceled:!1,onCancelList:[]}}})});Jc(exports,{default:()=>go});var Lr=Fe(require("obsidian"));var zc=Fe(require("obsidian"));function fe(){}function Zc(t,e){for(let r in e)t[r]=e[r];return t}function Ii(t){return t()}function wo(){return Object.create(null)}function Ue(t){t.forEach(Ii)}function tr(t){return typeof t=="function"}function be(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var _n;function ki(t,e){return _n||(_n=document.createElement("a")),_n.href=e,t===_n.href}function jo(t){return Object.keys(t).length===0}function Co(t,...e){if(t==null)return fe;let r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function bn(t,e,r){t.$$.on_destroy.push(Co(e,r))}function rr(t,e,r,n){if(t){let i=Ao(t,e,r,n);return t[0](i)}}function Ao(t,e,r,n){return t[1]&&n?Zc(r.ctx.slice(),t[1](n(e))):r.ctx}function nr(t,e,r,n){if(t[2]&&n){let i=t[2](n(r));if(e.dirty===void 0)return i;if(typeof i=="object"){let s=[],o=Math.max(e.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function ir(t,e,r,n,i,s){if(i){let o=Ao(e,r,n,s);t.p(o,i)}}function sr(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let n=0;n<r;n++)e[n]=-1;return e}return-1}function So(t){return t&&tr(t.destroy)?t.destroy:fe}var Fo=!1;function ef(){Fo=!0}function tf(){Fo=!1}function I(t,e){t.appendChild(e)}function $(t,e,r){t.insertBefore(e,r||null)}function H(t){t.parentNode&&t.parentNode.removeChild(t)}function xn(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function R(t){return document.createElement(t)}function xe(t){return document.createTextNode(t)}function U(){return xe(" ")}function or(){return xe("")}function Le(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function B(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function rf(t){return Array.from(t.childNodes)}function Ge(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Oi(t,e){t.value=e??""}function ze(t,e,r,n){r===null?t.style.removeProperty(e):t.style.setProperty(e,r,n?"important":"")}function Pi(t,e,r){t.classList[r?"add":"remove"](e)}function nf(t,e,{bubbles:r=!1,cancelable:n=!1}={}){let i=document.createEvent("CustomEvent");return i.initCustomEvent(t,r,n,e),i}var Nr;function Kr(t){Nr=t}function Mi(){if(!Nr)throw new Error("Function called outside component initialization");return Nr}function zr(t){Mi().$$.on_mount.push(t)}function Vr(t){Mi().$$.on_destroy.push(t)}function Ri(){let t=Mi();return(e,r,{cancelable:n=!1}={})=>{let i=t.$$.callbacks[e];if(i){let s=nf(e,r,{cancelable:n});return i.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function Ve(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(n=>n.call(this,e))}var Hr=[];var tt=[],wn=[],Eo=[],Do=Promise.resolve(),Li=!1;function To(){Li||(Li=!0,Do.then(Io))}function mt(){return To(),Do}function Bi(t){wn.push(t)}var Ni=new Set,jn=0;function Io(){let t=Nr;do{for(;jn<Hr.length;){let e=Hr[jn];jn++,Kr(e),sf(e.$$)}for(Kr(null),Hr.length=0,jn=0;tt.length;)tt.pop()();for(let e=0;e<wn.length;e+=1){let r=wn[e];Ni.has(r)||(Ni.add(r),r())}wn.length=0}while(Hr.length);for(;Eo.length;)Eo.pop()();Li=!1,Ni.clear(),Kr(t)}function sf(t){if(t.fragment!==null){t.update(),Ue(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Bi)}}var Cn=new Set,Lt;function Bt(){Lt={r:0,c:[],p:Lt}}function Nt(){Lt.r||Ue(Lt.c),Lt=Lt.p}function ee(t,e){t&&t.i&&(Cn.delete(t),t.i(e))}function re(t,e,r,n){if(t&&t.o){if(Cn.has(t))return;Cn.add(t),Lt.c.push(()=>{Cn.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}var ev=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Be(t){t&&t.c()}function Oe(t,e,r,n){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,r),n||Bi(()=>{let o=t.$$.on_mount.map(Ii).filter(tr);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ue(o),t.$$.on_mount=[]}),s.forEach(Bi)}function Ee(t,e){let r=t.$$;r.fragment!==null&&(Ue(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function of(t,e){t.$$.dirty[0]===-1&&(Hr.push(t),To(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function De(t,e,r,n,i,s,o,a=[-1]){let u=Nr;Kr(t);let l=t.$$={fragment:null,ctx:[],props:s,update:fe,not_equal:i,bound:wo(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:wo(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};o&&o(l.root);let f=!1;if(l.ctx=r?r(t,e.props||{},(h,c,...d)=>{let v=d.length?d[0]:c;return l.ctx&&i(l.ctx[h],l.ctx[h]=v)&&(!l.skip_bound&&l.bound[h]&&l.bound[h](v),f&&of(t,h)),c}):[],l.update(),f=!0,Ue(l.before_update),l.fragment=n?n(l.ctx):!1,e.target){if(e.hydrate){ef();let h=rf(e.target);l.fragment&&l.fragment.l(h),h.forEach(H)}else l.fragment&&l.fragment.c();e.intro&&ee(t.$$.fragment),Oe(t,e.target,e.anchor,e.customElement),tf(),Io()}Kr(u)}var af;typeof HTMLElement=="function"&&(af=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(Ii).filter(tr);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,r){this[t]=r}disconnectedCallback(){Ue(this.$$.on_disconnect)}$destroy(){Ee(this,1),this.$destroy=fe}$on(t,e){if(!tr(e))return fe;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{let n=r.indexOf(e);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!jo(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var Ae=class{$destroy(){Ee(this,1),this.$destroy=fe}$on(e,r){if(!tr(r))return fe;let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{let i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!jo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Rt=Fe(require("obsidian"));var Ga=Fe(require("obsidian"));var Ki=class{constructor(){this.handlers=new Map;this.disabled=[]}on(e,r,n){if(e.includes("@")||r.includes("@"))throw new Error("Invalid context/event name - Cannot contain @");this.handlers.set(`${e}@${r}`,n)}off(e,r){if(r)this.handlers.delete(`${e}@${r}`);else for(let[n]of this.handlers.entries())n.startsWith(`${e}@`)&&this.handlers.delete(n)}disable(e){this.enable(e),this.disabled.push(e)}enable(e){this.disabled=this.disabled.filter(r=>r!==e)}emit(e,...r){let n=[...this.handlers.entries()].filter(([i,s])=>!this.disabled.includes(i.split("@")[0]));for(let[i,s]of n)i.endsWith(`@${e}`)&&s(...r)}};var ar=[];function An(t,e=fe){let r,n=new Set;function i(a){if(be(t,a)&&(t=a,r)){let u=!ar.length;for(let l of n)l[1](),ar.push(l,t);if(u){for(let l=0;l<ar.length;l+=2)ar[l][0](ar[l+1]);ar.length=0}}}function s(a){i(a(t))}function o(a,u=fe){let l=[a,u];return n.add(l),n.size===1&&(r=e(i)||fe),a(t),()=>{n.delete(l),n.size===0&&(r(),r=null)}}return{set:i,update:s,subscribe:o}}var W=Fe(require("obsidian"));var ie=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,he=Object.keys,Te=Array.isArray;typeof Promise!="undefined"&&!ie.Promise&&(ie.Promise=Promise);function Pe(t,e){return typeof e!="object"||he(e).forEach(function(r){t[r]=e[r]}),t}var $r=Object.getPrototypeOf,lf={}.hasOwnProperty;function He(t,e){return lf.call(t,e)}function lr(t,e){typeof e=="function"&&(e=e($r(t))),(typeof Reflect=="undefined"?he:Reflect.ownKeys)(e).forEach(r=>{rt(t,r,e[r])})}var ko=Object.defineProperty;function rt(t,e,r,n){ko(t,e,Pe(r&&He(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function ur(t){return{from:function(e){return t.prototype=Object.create(e.prototype),rt(t.prototype,"constructor",t),{extend:lr.bind(null,t.prototype)}}}}var uf=Object.getOwnPropertyDescriptor;function zi(t,e){let r=uf(t,e),n;return r||(n=$r(t))&&zi(n,e)}var cf=[].slice;function Sn(t,e,r){return cf.call(t,e,r)}function Oo(t,e){return e(t)}function Wr(t){if(!t)throw new Error("Assertion Failed")}function Po(t){ie.setImmediate?setImmediate(t):setTimeout(t,0)}function Mo(t,e){return t.reduce((r,n,i)=>{var s=e(n,i);return s&&(r[s[0]]=s[1]),r},{})}function ff(t,e,r){try{t.apply(null,r)}catch(n){e&&e(n)}}function nt(t,e){if(He(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,i=e.length;n<i;++n){var s=nt(t,e[n]);r.push(s)}return r}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:nt(a,e.substr(o+1))}}function Qe(t,e,r){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Wr(typeof r!="string"&&"length"in r);for(var n=0,i=e.length;n<i;++n)Qe(t,e[n],r[n])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")r===void 0?Te(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=r;else{var u=t[o];(!u||!He(t,o))&&(u=t[o]={}),Qe(u,a,r)}}else r===void 0?Te(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function df(t,e){typeof e=="string"?Qe(t,e,void 0):"length"in e&&[].map.call(e,function(r){Qe(t,r,void 0)})}function Ro(t){var e={};for(var r in t)He(t,r)&&(e[r]=t[r]);return e}var pf=[].concat;function Lo(t){return pf.apply([],t)}var Bo="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Lo([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>ie[t]),hf=Bo.map(t=>ie[t]);Mo(Bo,t=>[t,!0]);var gt=null;function Ur(t){gt=typeof WeakMap!="undefined"&&new WeakMap;let e=Vi(t);return gt=null,e}function Vi(t){if(!t||typeof t!="object")return t;let e=gt&&gt.get(t);if(e)return e;if(Te(t)){e=[],gt&&gt.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(Vi(t[r]))}else if(hf.indexOf(t.constructor)>=0)e=t;else{let s=$r(t);e=s===Object.prototype?{}:Object.create(s),gt&&gt.set(t,e);for(var i in t)He(t,i)&&(e[i]=Vi(t[i]))}return e}var{toString:mf}={};function Hi(t){return mf.call(t).slice(8,-1)}var $i=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",gf=typeof $i=="symbol"?function(t){var e;return t!=null&&(e=t[$i])&&e.apply(t)}:function(){return null},cr={};function it(t){var e,r,n,i;if(arguments.length===1){if(Te(t))return t.slice();if(this===cr&&typeof t=="string")return[t];if(i=gf(t)){for(r=[];n=i.next(),!n.done;)r.push(n.value);return r}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var Wi=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,Xe=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function No(t,e){Xe=t,Ko=e}var Ko=()=>!0,yf=!new Error("").stack;function Kt(){if(yf)try{throw Kt.arguments,new Error}catch(t){return t}return new Error}function Ui(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(Ko).map(n=>`
`+n).join("")):""}var vf=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],zo=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Gi=vf.concat(zo),_f={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function fr(t,e){this._e=Kt(),this.name=t,this.message=e}ur(fr).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ui(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Vo(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Fn(t,e,r,n){this._e=Kt(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=Vo(t,e)}ur(Fn).from(fr);function Gr(t,e){this._e=Kt(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=Vo(t,e)}ur(Gr).from(fr);var Qi=Gi.reduce((t,e)=>(t[e]=e+"Error",t),{}),bf=fr,V=Gi.reduce((t,e)=>{var r=e+"Error";function n(i,s){this._e=Kt(),this.name=r,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=_f[e]||r,this.inner=null)}return ur(n).from(bf),t[e]=n,t},{});V.Syntax=SyntaxError;V.Type=TypeError;V.Range=RangeError;var Ho=zo.reduce((t,e)=>(t[e+"Error"]=V[e],t),{});function xf(t,e){if(!t||t instanceof fr||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Ho[t.name])return t;var r=new Ho[t.name](e||t.message,t);return"stack"in t&&rt(r,"stack",{get:function(){return this.inner.stack}}),r}var En=Gi.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=V[e]),t),{});En.ModifyError=Fn;En.DexieError=fr;En.BulkError=Gr;function ne(){}function Qr(t){return t}function wf(t,e){return t==null||t===Qr?e:function(r){return e(t(r))}}function zt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function jf(t,e){return t===ne?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?zt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?zt(i,this.onerror):i),s!==void 0?s:r}}function Cf(t,e){return t===ne?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?zt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?zt(n,this.onerror):n)}}function Af(t,e){return t===ne?e:function(r){var n=t.apply(this,arguments);Pe(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?zt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?zt(s,this.onerror):s),n===void 0?o===void 0?void 0:o:Pe(n,o)}}function Sf(t,e){return t===ne?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function qi(t,e){return t===ne?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then(function(){return e.apply(n,s)})}return e.apply(this,arguments)}}var qr={},Ff=100,Ef=20,$o=100,[Yi,Dn,Ji]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,$r(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,$r(e),t]})(),Wo=Dn&&Dn.then,Tn=Yi&&Yi.constructor,Xi=!!Ji,Zi=!1,Df=Ji?()=>{Ji.then(Pn)}:ie.setImmediate?setImmediate.bind(null,Pn):ie.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Pn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Pn,0)},Yr=function(t,e){Jr.push([t,e]),In&&(Df(),In=!1)},es=!0,In=!0,Vt=[],kn=[],ts=null,rs=Qr,dr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ta,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{ta(t[0],t[1])}catch{}})}},K=dr,Jr=[],Ht=0,On=[];function M(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ne,this._lib=!1;var e=this._PSD=K;if(Xe&&(this._stackHolder=Kt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==qr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&is(this,this._value);return}this._state=null,this._value=null,++e.ref,Go(this,t)}var ns={get:function(){var t=K,e=Ln;function r(n,i){var s=!t.global&&(t!==K||e!==Ln);let o=s&&!st();var a=new M((u,l)=>{ss(this,new Uo(Nn(n,t,s,o),Nn(i,t,s,o),u,l,t))});return Xe&&Yo(a,this),a}return r.prototype=qr,r},set:function(t){rt(this,"then",t&&t.prototype===qr?ns:{get:function(){return t},set:ns.set})}};lr(M.prototype,{then:ns,_then:function(t,e){ss(this,new Uo(null,null,t,e,K))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):Mn(n)):this.then(null,n=>n&&n.name===e?r(n):Mn(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Mn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Zi=!0;var t=qo(this,[],Ef),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Zi=!1}}},timeout:function(t,e){return t<1/0?new M((r,n)=>{var i=setTimeout(()=>n(new V.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&rt(M.prototype,Symbol.toStringTag,"Dexie.Promise");dr.env=Jo();function Uo(t,e,r,n,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=i}lr(M,{all:function(){var t=it.apply(null,arguments).map(Bn);return new M(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((i,s)=>M.resolve(i).then(o=>{t[s]=o,--n||e(t)},r))})},resolve:t=>{if(t instanceof M)return t;if(t&&typeof t.then=="function")return new M((r,n)=>{t.then(r,n)});var e=new M(qr,!0,t);return Yo(e,ts),e},reject:Mn,race:function(){var t=it.apply(null,arguments).map(Bn);return new M((e,r)=>{t.map(n=>M.resolve(n).then(e,r))})},PSD:{get:()=>K,set:t=>K=t},totalEchoes:{get:()=>Ln},newPSD:yt,usePSD:hr,scheduler:{get:()=>Yr,set:t=>{Yr=t}},rejectionMapper:{get:()=>rs,set:t=>{rs=t}},follow:(t,e)=>new M((r,n)=>yt((i,s)=>{var o=K;o.unhandleds=[],o.onunhandled=s,o.finalize=zt(function(){If(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,r,n))});Tn&&(Tn.allSettled&&rt(M,"allSettled",function(){let t=it.apply(null,arguments).map(Bn);return new M(e=>{t.length===0&&e([]);let r=t.length,n=new Array(r);t.forEach((i,s)=>M.resolve(i).then(o=>n[s]={status:"fulfilled",value:o},o=>n[s]={status:"rejected",reason:o}).then(()=>--r||e(n)))})}),Tn.any&&typeof AggregateError!="undefined"&&rt(M,"any",function(){let t=it.apply(null,arguments).map(Bn);return new M((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length,i=new Array(n);t.forEach((s,o)=>M.resolve(s).then(a=>e(a),a=>{i[o]=a,--n||r(new AggregateError(i))}))})}));function Go(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&Xr();r&&typeof r.then=="function"?Go(t,(i,s)=>{r instanceof M?r._then(i,s):r.then(i,s)}):(t._state=!0,t._value=r,Qo(t)),n&&Zr()}},is.bind(null,t))}catch(r){is(t,r)}}function is(t,e){if(kn.push(e),t._state===null){var r=t._lib&&Xr();e=rs(e),t._state=!1,t._value=e,Xe&&e!==null&&typeof e=="object"&&!e._promise&&ff(()=>{var n=zi(e,"stack");e._promise=t,rt(e,"stack",{get:()=>Zi?n&&(n.get?n.get.apply(e):n.value):t.stack})}),kf(t),Qo(t),r&&Zr()}}function Qo(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)ss(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),Ht===0&&(++Ht,Yr(()=>{--Ht==0&&os()},[]))}function ss(t,e){if(t._state===null){t._listeners.push(e);return}var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ht,Yr(Tf,[r,t,e])}function Tf(t,e,r){try{ts=e;var n,i=e._value;e._state?n=t(i):(kn.length&&(kn=[]),n=t(i),kn.indexOf(i)===-1&&Of(e)),r.resolve(n)}catch(s){r.reject(s)}finally{ts=null,--Ht==0&&os(),--r.psd.ref||r.psd.finalize()}}function qo(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var i=t._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,n=Ui(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+n)}return Xe&&(n=Ui(t._stackHolder,2),n&&e.indexOf(n)===-1&&e.push(n),t._prev&&qo(t._prev,e,r)),e}function Yo(t,e){var r=e?e._numPrev+1:0;r<Ff&&(t._prev=e,t._numPrev=r)}function Pn(){Xr()&&Zr()}function Xr(){var t=es;return es=!1,In=!1,t}function Zr(){var t,e,r;do for(;Jr.length>0;)for(t=Jr,Jr=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(Jr.length>0);es=!0,In=!0}function os(){var t=Vt;Vt=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=On.slice(0),r=e.length;r;)e[--r]()}function If(t){function e(){t(),On.splice(On.indexOf(e),1)}On.push(e),++Ht,Yr(()=>{--Ht==0&&os()},[])}function kf(t){Vt.some(e=>e._value===t._value)||Vt.push(t)}function Of(t){for(var e=Vt.length;e;)if(Vt[--e]._value===t._value){Vt.splice(e,1);return}}function Mn(t){return new M(qr,!1,t)}function oe(t,e){var r=K;return function(){var n=Xr(),i=K;try{return vt(r,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{vt(i,!1),n&&Zr()}}}var Ie={awaits:0,echoes:0,id:0},Pf=0,Rn=[],as=0,Ln=0,Mf=0;function yt(t,e,r,n){var i=K,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Mf;var o=dr.env;s.env=Xi?{Promise:M,PromiseProp:{value:M,configurable:!0,writable:!0},all:M.all,race:M.race,allSettled:M.allSettled,any:M.any,resolve:M.resolve,reject:M.reject,nthen:Zo(o.nthen,s),gthen:Zo(o.gthen,s)}:{},e&&Pe(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=hr(s,t,r,n);return s.ref===0&&s.finalize(),a}function pr(){return Ie.id||(Ie.id=++Pf),++Ie.awaits,Ie.echoes+=$o,Ie.id}function st(){return Ie.awaits?(--Ie.awaits==0&&(Ie.id=0),Ie.echoes=Ie.awaits*$o,!0):!1}(""+Wo).indexOf("[native code]")===-1&&(pr=st=ne);function Bn(t){return Ie.echoes&&t&&t.constructor===Tn?(pr(),t.then(e=>(st(),e),e=>(st(),ye(e)))):t}function Rf(t){++Ln,(!Ie.echoes||--Ie.echoes==0)&&(Ie.echoes=Ie.id=0),Rn.push(K),vt(t,!0)}function Lf(){var t=Rn[Rn.length-1];Rn.pop(),vt(t,!1)}function vt(t,e){var r=K;if((e?Ie.echoes&&(!as++||t!==K):as&&(!--as||t!==K))&&Xo(e?Rf.bind(null,t):Lf),t!==K&&(K=t,r===dr&&(dr.env=Jo()),Xi)){var n=dr.env.Promise,i=t.env;Dn.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(ie,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function Jo(){var t=ie.Promise;return Xi?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(ie,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Dn.then,gthen:t.prototype.then}:{}}function hr(t,e,r,n,i){var s=K;try{return vt(t,!0),e(r,n,i)}finally{vt(s,!1)}}function Xo(t){Wo.call(Yi,t)}function Nn(t,e,r,n){return typeof t!="function"?t:function(){var i=K;r&&pr(),vt(e,!0);try{return t.apply(this,arguments)}finally{vt(i,!1),n&&Xo(st)}}}function Zo(t,e){return function(r,n){return t.call(this,Nn(r,e),Nn(n,e))}}var ea="unhandledrejection";function ta(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,i={promise:e,reason:t};if(ie.document&&document.createEvent?(n=document.createEvent("Event"),n.initEvent(ea,!0,!0),Pe(n,i)):ie.CustomEvent&&(n=new CustomEvent(ea,{detail:i}),Pe(n,i)),n&&ie.dispatchEvent&&(dispatchEvent(n),!ie.PromiseRejectionEvent&&ie.onunhandledrejection))try{ie.onunhandledrejection(n)}catch{}Xe&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var ye=M.reject;function ls(t,e,r,n){if(!t.idbdb||!t._state.openComplete&&!K.letThrough&&!t._vip){if(t._state.openComplete)return ye(new V.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ye(new V.DatabaseClosed);t.open().catch(ne)}return t._state.dbReadyPromise.then(()=>ls(t,e,r,n))}else{var i=t._createTransaction(e,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===Qi.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>ls(t,e,r,n))):ye(s)}return i._promise(e,(s,o)=>yt(()=>(K.trans=i,n(s,o,i)))).then(s=>i._completion.then(()=>s))}}var ra="3.2.2",$t=String.fromCharCode(65535),us=-1/0,ot="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",na="String expected.",en=[],Kn=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Bf=Kn,Nf=Kn,ia=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),zn="__dbnames",cs="readonly",fs="readwrite";function Wt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var sa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Vn(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Ur(e),delete e[t]),e):e=>e}var oa=class{_trans(e,r,n){let i=this._tx||K.trans,s=this.name;function o(u,l,f){if(!f.schema[s])throw new V.NotFound("Table "+s+" not part of transaction");return r(f.idbtrans,f)}let a=Xr();try{return i&&i.db===this.db?i===K.trans?i._promise(e,o,n):yt(()=>i._promise(e,o,n),{trans:i,transless:K.transless||K}):ls(this.db,e,[this.name],o)}finally{a&&Zr()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Te(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let r=he(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(l=>l.compound&&r.every(f=>l.keyPath.indexOf(f)>=0)&&l.keyPath.every(f=>r.indexOf(f)>=0))[0];if(n&&this.db._maxKey!==$t)return this.where(n.name).equals(n.keyPath.map(l=>e[l]));!n&&Xe&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(l,f){try{return s.cmp(l,f)===0}catch{return!1}}let[a,u]=r.reduce(([l,f],h)=>{let c=i[h],d=e[h];return[l||c,l||!c?Wt(f,c&&c.multi?v=>{let w=nt(v,h);return Te(w)&&w.some(x=>o(d,x))}:v=>o(d,nt(v,h))):f]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(u):n?this.filter(u):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Te(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let r=n=>{if(!n)return n;let i=Object.create(e.prototype);for(var s in n)if(He(n,s))try{i[s]=n[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){function e(r){Pe(this,r)}return this.mapToClass(e)}add(e,r){let{auto:n,keyPath:i}=this.schema.primKey,s=e;return i&&n&&(s=Vn(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:r!=null?[r]:null,values:[s]})).then(o=>o.numFailures?M.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Qe(e,i,o)}catch{}return o})}update(e,r){if(typeof e=="object"&&!Te(e)){let n=nt(e,this.schema.primKey.keyPath);if(n===void 0)return ye(new V.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?he(r).forEach(i=>{Qe(e,i,r[i])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}else return this.where(":id").equals(e).modify(r)}put(e,r){let{auto:n,keyPath:i}=this.schema.primKey,s=e;return i&&n&&(s=Vn(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:r!=null?[r]:null})).then(o=>o.numFailures?M.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Qe(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?M.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:sa})).then(e=>e.numFailures?M.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let s=n?n.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new V.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let l=e.length,f=u&&a?e.map(Vn(u)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:f,wantResults:s}).then(({numFailures:h,results:c,lastResult:d,failures:v})=>{let w=s?c:d;if(h===0)return w;throw new Gr(`${this.name}.bulkAdd(): ${h} of ${l} operations failed`,v)})})}bulkPut(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let s=n?n.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new V.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let l=e.length,f=u&&a?e.map(Vn(u)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:f,wantResults:s}).then(({numFailures:h,results:c,lastResult:d,failures:v})=>{let w=s?c:d;if(h===0)return w;throw new Gr(`${this.name}.bulkPut(): ${h} of ${l} operations failed`,v)})})}bulkDelete(e){let r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:s})=>{if(n===0)return i;throw new Gr(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,s)})}};function tn(t){var e={},r=function(a,u){if(u){for(var l=arguments.length,f=new Array(l-1);--l;)f[l-1]=arguments[l];return e[a].subscribe.apply(null,f),t}else if(typeof a=="string")return e[a]};r.addEventType=s;for(var n=1,i=arguments.length;n<i;++n)s(arguments[n]);return r;function s(a,u,l){if(typeof a=="object")return o(a);u||(u=Sf),l||(l=ne);var f={subscribers:[],fire:l,subscribe:function(h){f.subscribers.indexOf(h)===-1&&(f.subscribers.push(h),f.fire=u(f.fire,h))},unsubscribe:function(h){f.subscribers=f.subscribers.filter(function(c){return c!==h}),f.fire=f.subscribers.reduce(u,l)}};return e[a]=r[a]=f,f}function o(a){he(a).forEach(function(u){var l=a[u];if(Te(l))s(u,a[u][0],a[u][1]);else if(l==="asap")var f=s(u,Qr,function(){for(var c=arguments.length,d=new Array(c);c--;)d[c]=arguments[c];f.subscribers.forEach(function(v){Po(function(){v.apply(null,d)})})});else throw new V.InvalidArgument("Invalid event config")})}}function rn(t,e){return ur(e).from({prototype:t}),e}function Kf(t){return rn(oa.prototype,function(r,n,i){this.db=t,this._tx=i,this.name=r,this.schema=n,this.hook=t._allTables[r]?t._allTables[r].hook:tn(null,{creating:[jf,ne],reading:[wf,Qr],updating:[Af,ne],deleting:[Cf,ne]})})}function mr(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function ds(t,e){t.filter=Wt(t.filter,e)}function ps(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>Wt(n(),e()):e,t.justLimit=r&&!n}function zf(t,e){t.isMatch=Wt(t.isMatch,e)}function Hn(t,e){if(t.isPrimKey)return e.primaryKey;let r=e.getIndexByKeyPath(t.index);if(!r)throw new V.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function aa(t,e,r){let n=Hn(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function $n(t,e,r,n){let i=t.replayFilter?Wt(t.filter,t.replayFilter()):t.filter;if(t.or){let s={},o=(a,u,l)=>{if(!i||i(u,l,c=>u.stop(c),c=>u.fail(c))){var f=u.primaryKey,h=""+f;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(f)),He(s,h)||(s[h]=!0,e(a,u,l))}};return Promise.all([t.or._iterate(o,r),la(aa(t,n,r),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return la(aa(t,n,r),Wt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function la(t,e,r,n){var i=n?(o,a,u)=>r(n(o),a,u):r,s=oe(i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,u=>a=u,u=>{o.stop(u),a=ne},u=>{o.fail(u),a=ne}))&&s(o.value,o,u=>a=u),a()})})}function Me(t,e){try{let r=ua(t),n=ua(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Hf(ca(t),ca(e));case"Array":return Vf(t,e)}}catch{}return NaN}function Vf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let s=0;s<i;++s){let o=Me(t[s],e[s]);if(o!==0)return o}return r===n?0:r<n?-1:1}function Hf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let s=0;s<i;++s)if(t[s]!==e[s])return t[s]<e[s]?-1:1;return r===n?0:r<n?-1:1}function ua(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let r=Hi(t);return r==="ArrayBuffer"?"binary":r}function ca(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var fa=class{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,ye.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,ye.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=Wt(r.algorithm,e)}_iterate(e,r){return $n(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Pe(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>$n(r,e,n,r.table.core))}count(e){return this._read(r=>{let n=this._ctx,i=n.table.core;if(mr(n,!0))return i.count({trans:r,query:{index:Hn(n,i.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var s=0;return $n(n,()=>(++s,!1),r,i).then(()=>s)}).then(e)}sortBy(e,r){let n=e.split(".").reverse(),i=n[0],s=n.length-1;function o(l,f){return f?o(l[n[f]],f-1):l[i]}var a=this._ctx.dir==="next"?1:-1;function u(l,f){var h=o(l,s),c=o(f,s);return h<c?-a:h>c?a:0}return this.toArray(function(l){return l.sort(u)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&mr(n,!0)&&n.limit>0){let{valueMapper:i}=n,s=Hn(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:s,range:n.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return $n(n,s=>i.push(s),r,n.table.core).then(()=>i)}},e)}offset(e){var r=this._ctx;return e<=0?this:(r.offset+=e,mr(r)?ps(r,()=>{var n=e;return(i,s)=>n===0?!0:n===1?(--n,!1):(s(()=>{i.advance(n),n=0}),!1)}):ps(r,()=>{var n=e;return()=>--n<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ps(this._ctx,()=>{var r=e;return function(n,i,s){return--r<=0&&i(s),r>=0}},!0),this}until(e,r){return ds(this._ctx,function(n,i,s){return e(n.value)?(i(s),r):!0}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return ds(this._ctx,function(r){return e(r.value)}),zf(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&mr(r,!0)&&r.limit>0)return this._read(i=>{var s=Hn(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:s,range:r.range}})}).then(({result:i})=>i).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return ds(this._ctx,function(i){var s=i.primaryKey.toString(),o=He(n,s);return n[s]=!0,!o}),this}modify(e){var r=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var s=he(e),o=s.length;i=function(w){for(var x=!1,p=0;p<o;++p){var b=s[p],m=e[b];nt(w,b)!==m&&(Qe(w,b,m),x=!0)}return x}}let a=r.table.core,{outbound:u,extractKey:l}=a.schema.primaryKey,f=this.db._options.modifyChunkSize||200,h=[],c=0,d=[],v=(w,x)=>{let{failures:p,numFailures:b}=x;c+=w-b;for(let m of he(p))h.push(p[m])};return this.clone().primaryKeys().then(w=>{let x=p=>{let b=Math.min(f,w.length-p);return a.getMany({trans:n,keys:w.slice(p,p+b),cache:"immutable"}).then(m=>{let g=[],_=[],y=u?[]:null,j=[];for(let S=0;S<b;++S){let E=m[S],P={value:Ur(E),primKey:w[p+S]};i.call(P,P.value,P)!==!1&&(P.value==null?j.push(w[p+S]):!u&&Me(l(E),l(P.value))!==0?(j.push(w[p+S]),g.push(P.value)):(_.push(P.value),u&&y.push(w[p+S])))}let C=mr(r)&&r.limit===1/0&&(typeof e!="function"||e===hs)&&{index:r.index,range:r.range};return Promise.resolve(g.length>0&&a.mutate({trans:n,type:"add",values:g}).then(S=>{for(let E in S.failures)j.splice(parseInt(E),1);v(g.length,S)})).then(()=>(_.length>0||C&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:y,values:_,criteria:C,changeSpec:typeof e!="function"&&e}).then(S=>v(_.length,S))).then(()=>(j.length>0||C&&e===hs)&&a.mutate({trans:n,type:"delete",keys:j,criteria:C}).then(S=>v(j.length,S))).then(()=>w.length>p+b&&x(p+f))})};return x(0).then(()=>{if(h.length>0)throw new Fn("Error modifying one or more objects",h,c,d);return w.length})})})}delete(){var e=this._ctx,r=e.range;return mr(e)&&(e.isPrimKey&&!Nf||r.type===3)?this._write(n=>{let{primaryKey:i}=e.table.core.schema,s=r;return e.table.core.count({trans:n,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(({failures:a,lastResult:u,results:l,numFailures:f})=>{if(f)throw new Fn("Could not delete some values",Object.keys(a).map(h=>a[h]),o-f);return o-f}))}):this.modify(hs)}},hs=(t,e)=>e.value=null;function $f(t){return rn(fa.prototype,function(r,n){this.db=t;let i=sa,s=null;if(n)try{i=n()}catch(l){s=l}let o=r._ctx,a=o.table,u=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:u!==Qr?u:null}})}function Wf(t,e){return t<e?-1:t===e?0:1}function Uf(t,e){return t>e?-1:t===e?0:1}function $e(t,e,r){var n=t instanceof ms?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function gr(t){return new t.Collection(t,()=>da("")).limit(0)}function Gf(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Qf(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function qf(t,e,r,n,i,s){for(var o=Math.min(t.length,n.length),a=-1,u=0;u<o;++u){var l=e[u];if(l!==n[u])return i(t[u],r[u])<0?t.substr(0,u)+r[u]+r.substr(u+1):i(t[u],n[u])<0?t.substr(0,u)+n[u]+r.substr(u+1):a>=0?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[u],l)<0&&(a=u)}return o<n.length&&s==="next"?t+r.substr(t.length):o<t.length&&s==="prev"?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function Wn(t,e,r,n){var i,s,o,a,u,l,f,h=r.length;if(!r.every(w=>typeof w=="string"))return $e(t,na);function c(w){i=Gf(w),s=Qf(w),o=w==="next"?Wf:Uf;var x=r.map(function(p){return{lower:s(p),upper:i(p)}}).sort(function(p,b){return o(p.lower,b.lower)});a=x.map(function(p){return p.upper}),u=x.map(function(p){return p.lower}),l=w,f=w==="next"?"":n}c("next");var d=new t.Collection(t,()=>_t(a[0],u[h-1]+n));d._ondirectionchange=function(w){c(w)};var v=0;return d._addAlgorithm(function(w,x,p){var b=w.key;if(typeof b!="string")return!1;var m=s(b);if(e(m,u,v))return!0;for(var g=null,_=v;_<h;++_){var y=qf(b,m,a[_],u[_],o,l);y===null&&g===null?v=_+1:(g===null||o(g,y)>0)&&(g=y)}return x(g!==null?function(){w.continue(g+f)}:p),!1}),d}function _t(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function da(t){return{type:1,lower:t,upper:t}}var ms=class{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||i)&&!(n&&i)?gr(this):new this.Collection(this,()=>_t(e,r,!n,!i))}catch{return $e(this,ot)}}equals(e){return e==null?$e(this,ot):new this.Collection(this,()=>da(e))}above(e){return e==null?$e(this,ot):new this.Collection(this,()=>_t(e,void 0,!0))}aboveOrEqual(e){return e==null?$e(this,ot):new this.Collection(this,()=>_t(e,void 0,!1))}below(e){return e==null?$e(this,ot):new this.Collection(this,()=>_t(void 0,e,!1,!0))}belowOrEqual(e){return e==null?$e(this,ot):new this.Collection(this,()=>_t(void 0,e))}startsWith(e){return typeof e!="string"?$e(this,na):this.between(e,e+$t,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Wn(this,(r,n)=>r.indexOf(n[0])===0,[e],$t)}equalsIgnoreCase(e){return Wn(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=it.apply(cr,arguments);return e.length===0?gr(this):Wn(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=it.apply(cr,arguments);return e.length===0?gr(this):Wn(this,(r,n)=>n.some(i=>r.indexOf(i)===0),e,$t)}anyOf(){let e=it.apply(cr,arguments),r=this._cmp;try{e.sort(r)}catch{return $e(this,ot)}if(e.length===0)return gr(this);let n=new this.Collection(this,()=>_t(e[0],e[e.length-1]));n._ondirectionchange=s=>{r=s==="next"?this._ascending:this._descending,e.sort(r)};let i=0;return n._addAlgorithm((s,o,a)=>{let u=s.key;for(;r(u,e[i])>0;)if(++i,i===e.length)return o(a),!1;return r(u,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[us,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=it.apply(cr,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return $e(this,ot)}let r=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[us,i]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){let n=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return gr(this);if(!e.every(g=>g[0]!==void 0&&g[1]!==void 0&&i(g[0],g[1])<=0))return $e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",V.InvalidArgument);let u=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0;function f(g,_){let y=0,j=g.length;for(;y<j;++y){let C=g[y];if(n(_[0],C[1])<0&&n(_[1],C[0])>0){C[0]=o(C[0],_[0]),C[1]=a(C[1],_[1]);break}}return y===j&&g.push(_),g}let h=i;function c(g,_){return h(g[0],_[0])}let d;try{d=e.reduce(f,[]),d.sort(c)}catch{return $e(this,ot)}let v=0,w=l?g=>i(g,d[v][1])>0:g=>i(g,d[v][1])>=0,x=u?g=>s(g,d[v][0])>0:g=>s(g,d[v][0])>=0;function p(g){return!w(g)&&!x(g)}let b=w,m=new this.Collection(this,()=>_t(d[0][0],d[d.length-1][1],!u,!l));return m._ondirectionchange=g=>{g==="next"?(b=w,h=i):(b=x,h=s),d.sort(c)},m._addAlgorithm((g,_,y)=>{for(var j=g.key;b(j);)if(++v,v===d.length)return _(y),!1;return p(j)?!0:(this._cmp(j,d[v][1])===0||this._cmp(j,d[v][0])===0||_(()=>{h===i?g.continue(d[v][0]):g.continue(d[v][1])}),!1)}),m}startsWithAnyOf(){let e=it.apply(cr,arguments);return e.every(r=>typeof r=="string")?e.length===0?gr(this):this.inAnyRange(e.map(r=>[r,r+$t])):$e(this,"startsWithAnyOf() only works with strings")}};function Yf(t){return rn(ms.prototype,function(r,n,i){this.db=t,this._ctx={table:r,index:n===":id"?null:n,or:i};let s=t._deps.indexedDB;if(!s)throw new V.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function Ze(t){return oe(function(e){return nn(e),t(e.target.error),!1})}function nn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var sn="storagemutated",bt="x-storagemutated-1",xt=tn(null,sn),pa=class{_lock(){return Wr(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this}_unlock(){if(Wr(!K.global),--this._reculock==0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{hr(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&K.lockOwnerFor!==this}create(e){if(!this.mode)return this;let r=this.db.idbdb,n=this.db._state.dbOpenError;if(Wr(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new V.DatabaseClosed(n);case"MissingAPIError":throw new V.MissingAPI(n.message,n);default:throw new V.OpenFailed(n)}if(!this.active)throw new V.TransactionInactive;return Wr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=oe(i=>{nn(i),this._reject(e.error)}),e.onabort=oe(i=>{nn(i),this.active&&this._reject(new V.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=oe(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&xt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return ye(new V.ReadOnly("Transaction is readonly"));if(!this.active)return ye(new V.TransactionInactive);if(this._locked())return new M((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(s,o)},K])});if(n)return yt(()=>{var s=new M((o,a)=>{this._lock();let u=r(o,a,this);u&&u.then&&u.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new M((s,o)=>{var a=r(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();let n=M.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=r._waitingFor;return new M((o,a)=>{n.then(u=>r._waitingQueue.push(oe(o.bind(null,u))),u=>r._waitingQueue.push(oe(a.bind(null,u)))).finally(()=>{r._waitingFor===s&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new V.Abort))}table(e){let r=this._memoizedTables||(this._memoizedTables={});if(He(r,e))return r[e];let n=this.schema[e];if(!n)throw new V.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),r[e]=i,i}};function Jf(t){return rn(pa.prototype,function(r,n,i,s,o){this.db=t,this.mode=r,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=tn(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new M((a,u)=>{this._resolve=a,this._reject=u}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var u=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):u&&this.idbtrans&&this.idbtrans.abort(),ye(a)})})}function gs(t,e,r,n,i,s,o){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(i?"++":"")+ha(e)}}function ha(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function ma(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:Mo(r,n=>[n.name,n])}}function Xf(t){return t.length===1?t[0]:t}var on=t=>{try{return t.only([[]]),on=()=>[[]],[[]]}catch{return on=()=>$t,$t}};function ys(t){return t==null?()=>{}:typeof t=="string"?Zf(t):e=>nt(e,t)}function Zf(t){return t.split(".").length===1?r=>r[t]:r=>nt(r,t)}function ga(t){return[].slice.call(t)}var ed=0;function an(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function td(t,e,r){function n(f,h){let c=ga(f.objectStoreNames);return{schema:{name:f.name,tables:c.map(d=>h.objectStore(d)).map(d=>{let{keyPath:v,autoIncrement:w}=d,x=Te(v),p=v==null,b={},m={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:x,keyPath:v,autoIncrement:w,unique:!0,extractKey:ys(v)},indexes:ga(d.indexNames).map(g=>d.index(g)).map(g=>{let{name:_,unique:y,multiEntry:j,keyPath:C}=g,S=Te(C),E={name:_,compound:S,keyPath:C,unique:y,multiEntry:j,extractKey:ys(C)};return b[an(C)]=E,E}),getIndexByKeyPath:g=>b[an(g)]};return b[":id"]=m.primaryKey,v!=null&&(b[an(v)]=m.primaryKey),m})},hasGetAll:c.length>0&&"getAll"in h.objectStore(c[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(f){if(f.type===3)return null;if(f.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:c,lowerOpen:d,upperOpen:v}=f;return h===void 0?c===void 0?null:e.upperBound(c,!!v):c===void 0?e.lowerBound(h,!!d):e.bound(h,c,!!d,!!v)}function s(f){let h=f.name;function c({trans:w,type:x,keys:p,values:b,range:m}){return new Promise((g,_)=>{g=oe(g);let y=w.objectStore(h),j=y.keyPath==null,C=x==="put"||x==="add";if(!C&&x!=="delete"&&x!=="deleteRange")throw new Error("Invalid operation type: "+x);let{length:S}=p||b||{length:1};if(p&&b&&p.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(S===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let E,P=[],L=[],O=0,z=q=>{++O,nn(q)};if(x==="deleteRange"){if(m.type===4)return g({numFailures:O,failures:L,results:[],lastResult:void 0});m.type===3?P.push(E=y.clear()):P.push(E=y.delete(i(m)))}else{let[q,Z]=C?j?[b,p]:[b,null]:[p,null];if(C)for(let A=0;A<S;++A)P.push(E=Z&&Z[A]!==void 0?y[x](q[A],Z[A]):y[x](q[A])),E.onerror=z;else for(let A=0;A<S;++A)P.push(E=y[x](q[A])),E.onerror=z}let J=q=>{let Z=q.target.result;P.forEach((A,F)=>A.error!=null&&(L[F]=A.error)),g({numFailures:O,failures:L,results:x==="delete"?p:P.map(A=>A.result),lastResult:Z})};E.onerror=q=>{z(q),J(q)},E.onsuccess=J})}function d({trans:w,values:x,query:p,reverse:b,unique:m}){return new Promise((g,_)=>{g=oe(g);let{index:y,range:j}=p,C=w.objectStore(h),S=y.isPrimaryKey?C:C.index(y.name),E=b?m?"prevunique":"prev":m?"nextunique":"next",P=x||!("openKeyCursor"in S)?S.openCursor(i(j),E):S.openKeyCursor(i(j),E);P.onerror=Ze(_),P.onsuccess=oe(L=>{let O=P.result;if(!O){g(null);return}O.___id=++ed,O.done=!1;let z=O.continue.bind(O),J=O.continuePrimaryKey;J&&(J=J.bind(O));let q=O.advance.bind(O),Z=()=>{throw new Error("Cursor not started")},A=()=>{throw new Error("Cursor not stopped")};O.trans=w,O.stop=O.continue=O.continuePrimaryKey=O.advance=Z,O.fail=oe(_),O.next=function(){let F=1;return this.start(()=>F--?this.continue():this.stop()).then(()=>this)},O.start=F=>{let T=new Promise((k,X)=>{k=oe(k),P.onerror=Ze(X),O.fail=X,O.stop=le=>{O.stop=O.continue=O.continuePrimaryKey=O.advance=A,k(le)}}),N=()=>{if(P.result)try{F()}catch(k){O.fail(k)}else O.done=!0,O.start=()=>{throw new Error("Cursor behind last entry")},O.stop()};return P.onsuccess=oe(k=>{P.onsuccess=N,N()}),O.continue=z,O.continuePrimaryKey=J,O.advance=q,N(),T},g(O)},_)})}function v(w){return x=>new Promise((p,b)=>{p=oe(p);let{trans:m,values:g,limit:_,query:y}=x,j=_===1/0?void 0:_,{index:C,range:S}=y,E=m.objectStore(h),P=C.isPrimaryKey?E:E.index(C.name),L=i(S);if(_===0)return p({result:[]});if(w){let O=g?P.getAll(L,j):P.getAllKeys(L,j);O.onsuccess=z=>p({result:z.target.result}),O.onerror=Ze(b)}else{let O=0,z=g||!("openKeyCursor"in P)?P.openCursor(L):P.openKeyCursor(L),J=[];z.onsuccess=q=>{let Z=z.result;if(!Z)return p({result:J});if(J.push(g?Z.value:Z.primaryKey),++O===_)return p({result:J});Z.continue()},z.onerror=Ze(b)}})}return{name:h,schema:f,mutate:c,getMany({trans:w,keys:x}){return new Promise((p,b)=>{p=oe(p);let m=w.objectStore(h),g=x.length,_=new Array(g),y=0,j=0,C,S=P=>{let L=P.target;(_[L._pos]=L.result)!=null,++j===y&&p(_)},E=Ze(b);for(let P=0;P<g;++P)x[P]!=null&&(C=m.get(x[P]),C._pos=P,C.onsuccess=S,C.onerror=E,++y);y===0&&p(_)})},get({trans:w,key:x}){return new Promise((p,b)=>{p=oe(p);let g=w.objectStore(h).get(x);g.onsuccess=_=>p(_.target.result),g.onerror=Ze(b)})},query:v(a),openCursor:d,count({query:w,trans:x}){let{index:p,range:b}=w;return new Promise((m,g)=>{let _=x.objectStore(h),y=p.isPrimaryKey?_:_.index(p.name),j=i(b),C=j?y.count(j):y.count();C.onsuccess=oe(S=>m(S.target.result)),C.onerror=Ze(g)})}}}let{schema:o,hasGetAll:a}=n(t,r),u=o.tables.map(f=>s(f)),l={};return u.forEach(f=>l[f.name]=f),{stack:"dbcore",transaction:t.transaction.bind(t),table(f){if(!l[f])throw new Error(`Table '${f}' not found`);return l[f]},MIN_KEY:-1/0,MAX_KEY:on(e),schema:o}}function rd(t,e){return e.reduce((r,{create:n})=>ce(ce({},r),n(r)),t)}function nd(t,e,{IDBKeyRange:r,indexedDB:n},i){return{dbcore:rd(td(e,r,i),t.dbcore)}}function vs({_novip:t},e){let r=e.db,n=nd(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(i=>{let s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Un({_novip:t},e,r,n){r.forEach(i=>{let s=n[i];e.forEach(o=>{let a=zi(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?rt(o,i,{get(){return this.table(i)},set(u){ko(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function _s({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function id(t,e){return t._cfg.version-e._cfg.version}function sd(t,e,r,n){let i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(r),s._completion.catch(n);let o=s._reject.bind(s),a=K.transless||K;yt(()=>{K.trans=s,K.transless=a,e===0?(he(i).forEach(u=>{bs(r,u,i[u].primKey,i[u].indexes)}),vs(t,r),M.follow(()=>t.on.populate.fire(s)).catch(o)):od(t,e,s,r).catch(o)})}function od({_novip:t},e,r,n){let i=[],s=t._versions,o=t._dbSchema=ws(t,t.idbdb,n),a=!1;s.filter(f=>f._cfg.version>=e).forEach(f=>{i.push(()=>{let h=o,c=f._cfg.dbschema;js(t,h,n),js(t,c,n),o=t._dbSchema=c;let d=ya(h,c);d.add.forEach(w=>{bs(n,w[0],w[1].primKey,w[1].indexes)}),d.change.forEach(w=>{if(w.recreate)throw new V.Upgrade("Not yet support for changing primary key");{let x=n.objectStore(w.name);w.add.forEach(p=>xs(x,p)),w.change.forEach(p=>{x.deleteIndex(p.name),xs(x,p)}),w.del.forEach(p=>x.deleteIndex(p))}});let v=f._cfg.contentUpgrade;if(v&&f._cfg.version>e){vs(t,n),r._memoizedTables={},a=!0;let w=Ro(c);d.del.forEach(m=>{w[m]=h[m]}),_s(t,[t.Transaction.prototype]),Un(t,[t.Transaction.prototype],he(w),w),r.schema=w;let x=Wi(v);x&&pr();let p,b=M.follow(()=>{if(p=v(r),p&&x){var m=st.bind(null,null);p.then(m,m)}});return p&&typeof p.then=="function"?M.resolve(p):b.then(()=>p)}}),i.push(h=>{if(!a||!Bf){let c=f._cfg.dbschema;ld(c,h)}_s(t,[t.Transaction.prototype]),Un(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})});function l(){return i.length?M.resolve(i.shift()(r.idbtrans)).then(l):M.resolve()}return l().then(()=>{ad(o,n)})}function ya(t,e){let r={del:[],add:[],change:[]},n;for(n in t)e[n]||r.del.push(n);for(n in e){let i=t[n],s=e[n];if(!i)r.add.push([n,s]);else{let o={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Kn)o.recreate=!0,r.change.push(o);else{let a=i.idxByName,u=s.idxByName,l;for(l in a)u[l]||o.del.push(l);for(l in u){let f=a[l],h=u[l];f?f.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}}}return r}function bs(t,e,r,n){let i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(s=>xs(i,s)),i}function ad(t,e){he(t).forEach(r=>{e.db.objectStoreNames.contains(r)||bs(e,r,t[r].primKey,t[r].indexes)})}function ld(t,e){[].slice.call(e.db.objectStoreNames).forEach(r=>t[r]==null&&e.db.deleteObjectStore(r))}function xs(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ws(t,e,r){let n={};return Sn(e.objectStoreNames,0).forEach(s=>{let o=r.objectStore(s),a=o.keyPath,u=gs(ha(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),l=[];for(let h=0;h<o.indexNames.length;++h){let c=o.index(o.indexNames[h]);a=c.keyPath;var f=gs(c.name,a,!!c.unique,!!c.multiEntry,!1,a&&typeof a!="string",!1);l.push(f)}n[s]=ma(s,u,l)}),n}function ud({_novip:t},e,r){t.verno=e.version/10;let n=t._dbSchema=ws(t,e,r);t._storeNames=Sn(e.objectStoreNames,0),Un(t,[t._allTables],he(n),n)}function cd(t,e){let r=ws(t,t.idbdb,e),n=ya(r,t._dbSchema);return!(n.add.length||n.change.some(i=>i.add.length||i.change.length))}function js({_novip:t},e,r){let n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){let s=n[i],o=r.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let u=o.indexNames[a],l=o.index(u).keyPath,f=typeof l=="string"?l:"["+Sn(l).join("+")+"]";if(e[s]){let h=e[s].idxByName[f];h&&(h.name=u,delete e[s].idxByName[f],e[s].idxByName[u]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ie.WorkerGlobalScope&&ie instanceof ie.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function fd(t){return t.split(",").map((e,r)=>{e=e.trim();let n=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return gs(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Te(i),r===0)})}var va=class{_parseStoresSpec(e,r){he(e).forEach(n=>{if(e[n]!==null){var i=fd(e[n]),s=i.shift();if(s.multi)throw new V.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new V.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new V.Schema("Index must have a name and cannot be an empty string")}),r[n]=ma(n,s,i)}})}stores(e){let r=this.db;this._cfg.storesSource=this._cfg.storesSource?Pe(this._cfg.storesSource,e):e;let n=r._versions,i={},s={};return n.forEach(o=>{Pe(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),r._dbSchema=s,_s(r,[r._allTables,r,r.Transaction.prototype]),Un(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],he(s),s),r._storeNames=he(s),this}upgrade(e){return this._cfg.contentUpgrade=qi(this._cfg.contentUpgrade||ne,e),this}};function dd(t){return rn(va.prototype,function(r){this.db=t,this._cfg={version:r,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Cs(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new lt(zn,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function As(t){return t&&typeof t.databases=="function"}function pd({indexedDB:t,IDBKeyRange:e}){return As(t)?Promise.resolve(t.databases()).then(r=>r.map(n=>n.name).filter(n=>n!==zn)):Cs(t,e).toCollection().primaryKeys()}function hd({indexedDB:t,IDBKeyRange:e},r){!As(t)&&r!==zn&&Cs(t,e).put({name:r}).catch(ne)}function md({indexedDB:t,IDBKeyRange:e},r){!As(t)&&r!==zn&&Cs(t,e).delete(r).catch(ne)}function Ss(t){return yt(function(){return K.letThrough=!0,t()})}function gd(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(r){var n=function(){return indexedDB.databases().finally(r)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}function yd(t){let e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?ye(e.dbOpenError):t);Xe&&(e.openCanceller._stackHolder=Kt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new V.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return M.race([n,(typeof navigator=="undefined"?M.resolve():gd()).then(()=>new M((u,l)=>{if(i(),!r)throw new V.MissingAPI;let f=t.name,h=e.autoSchema?r.open(f):r.open(f,Math.round(t.verno*10));if(!h)throw new V.MissingAPI;h.onerror=Ze(l),h.onblocked=oe(t._fireOnBlocked),h.onupgradeneeded=oe(c=>{if(o=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=nn,o.abort(),h.result.close();let v=r.deleteDatabase(f);v.onsuccess=v.onerror=oe(()=>{l(new V.NoSuchDatabase(`Database ${f} doesnt exist`))})}else{o.onerror=Ze(l);var d=c.oldVersion>Math.pow(2,62)?0:c.oldVersion;a=d<1,t._novip.idbdb=h.result,sd(t,d/10,o,l)}},l),h.onsuccess=oe(()=>{o=null;let c=t._novip.idbdb=h.result,d=Sn(c.objectStoreNames);if(d.length>0)try{let v=c.transaction(Xf(d),"readonly");e.autoSchema?ud(t,c,v):(js(t,t._dbSchema,v),cd(t,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),vs(t,v)}catch{}en.push(t),c.onversionchange=oe(v=>{e.vcFired=!0,t.on("versionchange").fire(v)}),c.onclose=oe(v=>{t.on("close").fire(v)}),a&&hd(t._deps,f),u()},l)}))]).then(()=>(i(),e.onReadyBeingFired=[],M.resolve(Ss(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let l=e.onReadyBeingFired.reduce(qi,ne);return e.onReadyBeingFired=[],M.resolve(Ss(()=>l(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch{}return n===e.openCanceller&&t._close(),ye(u)}).finally(()=>{e.openComplete=!0,s()})}function Fs(t){var e=o=>t.next(o),r=o=>t.throw(o),n=s(e),i=s(r);function s(o){return a=>{var u=o(a),l=u.value;return u.done?l:!l||typeof l.then!="function"?Te(l)?Promise.all(l).then(n,i):n(l):l.then(n,i)}}return s(e)()}function vd(t,e,r){var n=arguments.length;if(n<2)throw new V.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var s=Lo(i);return[t,s,r]}function _a(t,e,r,n,i){return M.resolve().then(()=>{let s=K.transless||K,o=t._createTransaction(e,r,t._dbSchema,n),a={trans:o,transless:s};if(n)o.idbtrans=n.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===Qi.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>_a(t,e,r,null,i))):ye(h)}let u=Wi(i);u&&pr();let l,f=M.follow(()=>{if(l=i.call(o,o),l)if(u){var h=st.bind(null,null);l.then(h,h)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Fs(l))},a);return(l&&typeof l.then=="function"?M.resolve(l).then(h=>o.active?h:ye(new V.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):f.then(()=>l)).then(h=>(n&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),ye(h)))})}function Gn(t,e,r){let n=Te(t)?t.slice():[t];for(let i=0;i<r;++i)n.push(e);return n}function _d(t){return ke(ce({},t),{table(e){let r=t.table(e),{schema:n}=r,i={},s=[];function o(c,d,v){let w=an(c),x=i[w]=i[w]||[],p=c==null?0:typeof c=="string"?1:c.length,b=d>0,m=ke(ce({},v),{isVirtual:b,keyTail:d,keyLength:p,extractKey:ys(c),unique:!b&&v.unique});if(x.push(m),m.isPrimaryKey||s.push(m),p>1){let g=p===2?c[0]:c.slice(0,p-1);o(g,d+1,v)}return x.sort((g,_)=>g.keyTail-_.keyTail),m}let a=o(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(let c of n.indexes)o(c.keyPath,0,c);function u(c){let d=i[an(c)];return d&&d[0]}function l(c,d){return{type:c.type===1?2:c.type,lower:Gn(c.lower,c.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:Gn(c.upper,c.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0}}function f(c){let d=c.query.index;return d.isVirtual?ke(ce({},c),{query:{index:d,range:l(c.query.range,d.keyTail)}}):c}return ke(ce({},r),{schema:ke(ce({},n),{primaryKey:a,indexes:s,getIndexByKeyPath:u}),count(c){return r.count(f(c))},query(c){return r.query(f(c))},openCursor(c){let{keyTail:d,isVirtual:v,keyLength:w}=c.query.index;if(!v)return r.openCursor(c);function x(p){function b(g){g!=null?p.continue(Gn(g,c.reverse?t.MAX_KEY:t.MIN_KEY,d)):c.unique?p.continue(p.key.slice(0,w).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,d)):p.continue()}return Object.create(p,{continue:{value:b},continuePrimaryKey:{value(g,_){p.continuePrimaryKey(Gn(g,t.MAX_KEY,d),_)}},primaryKey:{get(){return p.primaryKey}},key:{get(){let g=p.key;return w===1?g[0]:g.slice(0,w)}},value:{get(){return p.value}}})}return r.openCursor(f(c)).then(p=>p&&x(p))}})}})}var bd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:_d};function Es(t,e,r,n){return r=r||{},n=n||"",he(t).forEach(i=>{if(!He(e,i))r[n+i]=void 0;else{var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=Hi(s),u=Hi(o);a!==u?r[n+i]=e[i]:a==="Object"?Es(s,o,r,n+i+"."):s!==o&&(r[n+i]=e[i])}else s!==o&&(r[n+i]=e[i])}}),he(e).forEach(i=>{He(t,i)||(r[n+i]=e[i])}),r}function xd(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var wd={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>ke(ce({},t),{table(e){let r=t.table(e),{primaryKey:n}=r.schema;return ke(ce({},r),{mutate(s){let o=K.trans,{deleting:a,creating:u,updating:l}=o.table(e).hook;switch(s.type){case"add":if(u.fire===ne)break;return o._promise("readwrite",()=>f(s),!0);case"put":if(u.fire===ne&&l.fire===ne)break;return o._promise("readwrite",()=>f(s),!0);case"delete":if(a.fire===ne)break;return o._promise("readwrite",()=>f(s),!0);case"deleteRange":if(a.fire===ne)break;return o._promise("readwrite",()=>h(s),!0)}return r.mutate(s);function f(d){let v=K.trans,w=d.keys||xd(n,d);if(!w)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?ke(ce({},d),{keys:w}):ce({},d),d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),jd(r,d,w).then(x=>{let p=w.map((b,m)=>{let g=x[m],_={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(_,b,g,v);else if(d.type==="add"||g===void 0){let y=u.fire.call(_,b,d.values[m],v);b==null&&y!=null&&(b=y,d.keys[m]=b,n.outbound||Qe(d.values[m],n.keyPath,b))}else{let y=Es(g,d.values[m]),j=l.fire.call(_,y,b,g,v);if(j){let C=d.values[m];Object.keys(j).forEach(S=>{He(C,S)?C[S]=j[S]:Qe(C,S,j[S])})}}return _});return r.mutate(d).then(({failures:b,results:m,numFailures:g,lastResult:_})=>{for(let y=0;y<w.length;++y){let j=m?m[y]:w[y],C=p[y];j==null?C.onerror&&C.onerror(b[y]):C.onsuccess&&C.onsuccess(d.type==="put"&&x[y]?d.values[y]:j)}return{failures:b,results:m,numFailures:g,lastResult:_}}).catch(b=>(p.forEach(m=>m.onerror&&m.onerror(b)),Promise.reject(b)))})}function h(d){return c(d.trans,d.range,1e4)}function c(d,v,w){return r.query({trans:d,values:!1,query:{index:n,range:v},limit:w}).then(({result:x})=>f({type:"delete",keys:x,trans:d}).then(p=>p.numFailures>0?Promise.reject(p.failures[0]):x.length<w?{failures:[],numFailures:0,lastResult:void 0}:c(d,ke(ce({},v),{lower:x[x.length-1],lowerOpen:!0}),w)))}}})}})};function jd(t,e,r){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}function ba(t,e,r){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)Me(e.keys[i],t[s])===0&&(n.push(r?Ur(e.values[i]):e.values[i]),++s);return n.length===t.length?n:null}catch{return null}}var Cd={stack:"dbcore",level:-1,create:t=>({table:e=>{let r=t.table(e);return ke(ce({},r),{getMany:n=>{if(!n.cache)return r.getMany(n);let i=ba(n.keys,n.trans._cache,n.cache==="clone");return i?M.resolve(i):r.getMany(n).then(s=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Ur(s):s},s))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))})}})};function Ds(t){return!("from"in t)}var at=function(t,e){if(this)Pe(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let r=new at;return t&&"d"in t&&Pe(r,t),r}};lr(at.prototype,{add(t){return Qn(this,t),this},addKey(t){return ln(this,t,t),this},addKeys(t){return t.forEach(e=>ln(this,e,e)),this},[$i](){return Ts(this)}});function ln(t,e,r){let n=Me(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Ds(t))return Pe(t,{from:e,to:r,d:1});let i=t.l,s=t.r;if(Me(r,t.from)<0)return i?ln(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},xa(t);if(Me(e,t.to)>0)return s?ln(s,e,r):t.r={from:e,to:r,d:1,l:null,r:null},xa(t);Me(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),Me(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;i&&!t.l&&Qn(t,i),s&&o&&Qn(t,s)}function Qn(t,e){function r(n,{from:i,to:s,l:o,r:a}){ln(n,i,s),o&&r(n,o),a&&r(n,a)}Ds(e)||r(t,e)}function Ad(t,e){let r=Ts(e),n=r.next();if(n.done)return!1;let i=n.value,s=Ts(t),o=s.next(i.from),a=o.value;for(;!n.done&&!o.done;){if(Me(a.from,i.to)<=0&&Me(a.to,i.from)>=0)return!0;Me(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Ts(t){let e=Ds(t)?null:{s:0,n:t};return{next(r){let n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Me(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Me(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function xa(t){var e,r;let n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){let s=i==="r"?"l":"r",o=ce({},t),a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=wa(o)}t.d=wa(t)}function wa({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var Sd={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,r=new at(t.MIN_KEY,t.MAX_KEY);return ke(ce({},t),{table:n=>{let i=t.table(n),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:u}=o,l=ke(ce({},i),{mutate:c=>{let d=c.trans,v=d.mutatedParts||(d.mutatedParts={}),w=y=>{let j=`idb://${e}/${n}/${y}`;return v[j]||(v[j]=new at)},x=w(""),p=w(":dels"),{type:b}=c,[m,g]=c.type==="deleteRange"?[c.range]:c.type==="delete"?[c.keys]:c.values.length<50?[[],c.values]:[],_=c.trans._cache;return i.mutate(c).then(y=>{if(Te(m)){b!=="delete"&&(m=y.results),x.addKeys(m);let j=ba(m,_);!j&&b!=="add"&&p.addKeys(m),(j||g)&&Fd(w,s,j,g)}else if(m){let j={from:m.lower,to:m.upper};p.add(j),x.add(j)}else x.add(r),p.add(r),s.indexes.forEach(j=>w(j.name).add(r));return y})}}),f=({query:{index:c,range:d}})=>{var v,w;return[c,new at((v=d.lower)!==null&&v!==void 0?v:t.MIN_KEY,(w=d.upper)!==null&&w!==void 0?w:t.MAX_KEY)]},h={get:c=>[o,new at(c.key)],getMany:c=>[o,new at().addKeys(c.keys)],count:f,query:f,openCursor:f};return he(h).forEach(c=>{l[c]=function(d){let{subscr:v}=K;if(v){let w=g=>{let _=`idb://${e}/${n}/${g}`;return v[_]||(v[_]=new at)},x=w(""),p=w(":dels"),[b,m]=h[c](d);if(w(b.name||"").add(m),!b.isPrimaryKey)if(c==="count")p.add(r);else{let g=c==="query"&&u&&d.values&&i.query(ke(ce({},d),{values:!1}));return i[c].apply(this,arguments).then(_=>{if(c==="query"){if(u&&d.values)return g.then(({result:j})=>(x.addKeys(j),_));let y=d.values?_.result.map(a):_.result;d.values?x.addKeys(y):p.addKeys(y)}else if(c==="openCursor"){let y=_,j=d.values;return y&&Object.create(y,{key:{get(){return p.addKey(y.primaryKey),y.key}},primaryKey:{get(){let C=y.primaryKey;return p.addKey(C),C}},value:{get(){return j&&x.addKey(y.primaryKey),y.value}}})}return _})}}return i[c].apply(this,arguments)}}),l}})}};function Fd(t,e,r,n){function i(s){let o=t(s.name||"");function a(l){return l!=null?s.extractKey(l):null}let u=l=>s.multiEntry&&Te(l)?l.forEach(f=>o.addKey(f)):o.addKey(l);(r||n).forEach((l,f)=>{let h=r&&a(r[f]),c=n&&a(n[f]);Me(h,c)!==0&&(h!=null&&u(h),c!=null&&u(c))})}e.indexes.forEach(i)}var lt=class{constructor(e,r){this._middlewares={},this.verno=0;let n=lt.dependencies;this._options=r=ce({addons:lt.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};let{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new M(o=>{s.dbReadyResolve=o}),s.openCanceller=new M((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=tn(this,"populate","blocked","versionchange","close",{ready:[qi,ne]}),this.on.ready.subscribe=Oo(this.on.ready.subscribe,o=>(a,u)=>{lt.vip(()=>{let l=this._state;if(l.openComplete)l.dbOpenError||M.resolve().then(a),u&&o(a);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(a),u&&o(a);else{o(a);let f=this;u||o(function h(){f.on.ready.unsubscribe(a),f.on.ready.unsubscribe(h)})}})}),this.Collection=$f(this),this.Table=Kf(this),this.Transaction=Jf(this),this.Version=dd(this),this.WhereClause=Yf(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=on(r.IDBKeyRange),this._createTransaction=(o,a,u,l)=>new this.Transaction(o,a,u,this._options.chromeTransactionDurability,l),this._fireOnBlocked=o=>{this.on("blocked").fire(o),en.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(bd),this.use(wd),this.use(Sd),this.use(Cd),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new V.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new V.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let r=this._versions;var n=r.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(id),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new M((r,n)=>{if(this._state.openComplete)return n(new V.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){n(new V.DatabaseClosed);return}this.open().catch(ne)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:r,level:n??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:r?i.name!==r:!1)),this}open(){return yd(this)}_close(){let e=this._state,r=en.indexOf(this);if(r>=0&&en.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new M(n=>{e.dbReadyResolve=n}),e.openCanceller=new M((n,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new V.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,r=this._state;return new M((n,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=oe(()=>{md(this._deps,this.name),n()}),o.onerror=Ze(i),o.onblocked=this._fireOnBlocked};if(e)throw new V.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return he(this._allTables).map(e=>this._allTables[e])}transaction(){let e=vd.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let i=K.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=r.map(l=>{var f=l instanceof this.Table?l.name:l;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===cs)o=cs;else if(e=="rw"||e==fs)o=fs;else throw new V.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===cs&&o===fs)if(s)i=null;else throw new V.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(l=>{if(i&&i.storeNames.indexOf(l)===-1)if(s)i=null;else throw new V.SubTransaction("Table "+l+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(l){return i?i._promise(null,(f,h)=>{h(l)}):ye(l)}let u=_a.bind(null,this,o,a,i,n);return i?i._promise(o,u,"lock"):K.trans?hr(K.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!He(this._allTables,e))throw new V.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Ed=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",ja=class{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(!e||typeof e=="function"?{next:e,error:r,complete:n}:e)}[Ed](){return this}};function Ca(t,e){return he(e).forEach(r=>{let n=t[r]||(t[r]=new at);Qn(n,e[r])}),t}function Dd(t){return new ja(e=>{let r=Wi(t);function n(d){r&&pr();let v=()=>yt(t,{subscr:d,trans:null}),w=K.trans?hr(K.transless,v):v();return r&&w.then(st,st),w}let i=!1,s={},o={},a={get closed(){return i},unsubscribe:()=>{i=!0,xt.storagemutated.unsubscribe(h)}};e.start&&e.start(a);let u=!1,l=!1;function f(){return he(o).some(d=>s[d]&&Ad(s[d],o[d]))}let h=d=>{Ca(s,d),f()&&c()},c=()=>{if(u||i)return;s={};let d={},v=n(d);l||(xt(sn,h),l=!0),u=!0,Promise.resolve(v).then(w=>{u=!1,!i&&(f()?c():(s={},o=d,e.next&&e.next(w)))},w=>{u=!1,e.error&&e.error(w),a.unsubscribe()})};return c(),a})}var Is;try{Is={indexedDB:ie.indexedDB||ie.mozIndexedDB||ie.webkitIndexedDB||ie.msIndexedDB,IDBKeyRange:ie.IDBKeyRange||ie.webkitIDBKeyRange}}catch{Is={indexedDB:null,IDBKeyRange:null}}var Ut=lt;lr(Ut,ke(ce({},En),{delete(t){return new Ut(t,{addons:[]}).delete()},exists(t){return new Ut(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return pd(Ut.dependencies).then(t)}catch{return ye(new V.MissingAPI)}},defineClass(){function t(e){Pe(this,e)}return t},ignoreTransaction(t){return K.trans?hr(K.transless,t):t()},vip:Ss,async:function(t){return function(){try{var e=Fs(t.apply(this,arguments));return!e||typeof e.then!="function"?M.resolve(e):e}catch(r){return ye(r)}}},spawn:function(t,e,r){try{var n=Fs(t.apply(r,e||[]));return!n||typeof n.then!="function"?M.resolve(n):n}catch(i){return ye(i)}},currentTransaction:{get:()=>K.trans||null},waitFor:function(t,e){let r=M.resolve(typeof t=="function"?Ut.ignoreTransaction(t):t).timeout(e||6e4);return K.trans?K.trans.waitFor(r):r},Promise:M,debug:{get:()=>Xe,set:t=>{No(t,t==="dexie"?()=>!0:ia)}},derive:ur,extend:Pe,props:lr,override:Oo,Events:tn,on:xt,liveQuery:Dd,extendObservabilitySet:Ca,getByKeyPath:nt,setByKeyPath:Qe,delByKeyPath:df,shallowClone:Ro,deepClone:Ur,getObjectDiff:Es,cmp:Me,asap:Po,minKey:us,addons:[],connections:en,errnames:Qi,dependencies:Is,semVer:ra,version:ra.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,r*2))}));Ut.maxKey=on(Ut.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(xt(sn,t=>{if(!ut){let e;Kn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(bt,!0,!0,t)):e=new CustomEvent(bt,{detail:t}),ut=!0,dispatchEvent(e),ut=!1}}),addEventListener(bt,({detail:t})=>{ut||qn(t)}));function qn(t){let e=ut;try{ut=!0,xt.storagemutated.fire(t)}finally{ut=e}}var ut=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(bt);xt(sn,e=>{ut||t.postMessage(e)}),t.onmessage=e=>{e.data&&qn(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){xt(sn,e=>{try{ut||(typeof localStorage!="undefined"&&localStorage.setItem(bt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:bt,changedParts:e})))}catch{}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===bt){let r=JSON.parse(e.newValue);r&&qn(r.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",Td)}function Td({data:t}){t&&t.type===bt&&qn(t.changedParts)}M.rejectionMapper=xf;No(Xe,ia);var et=class extends lt{constructor(){super(et.dbName);this.version(et.dbVersion).stores({searchHistory:"++id",minisearch:"date"})}static async clearOldDatabases(){let e=(await indexedDB.databases()).filter(r=>r.name===et.dbName&&r.version!==et.dbVersion*10);if(e.length){console.log("Omnisearch - Those IndexedDb databases will be deleted:");for(let r of e)r.name&&indexedDB.deleteDatabase(r.name)}}static getInstance(){return et.instance||(et.instance=new et),et.instance}async clearCache(){await this.minisearch.clear()}},yr=et;yr.dbVersion=8,yr.dbName="omnisearch/cache/"+app.appId;var Ne=yr.getInstance();var Gt=An(!1),Qt='<strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>',ks=class extends W.PluginSettingTab{constructor(e){super(app,e);this.plugin=e,Gt.subscribe(async r=>{D.showExcerpt=r,await ue(this.plugin)})}display(){let{containerEl:e}=this;if(e.empty(),app.loadLocalStorage(un)=="1"){let d=e.createEl("span");d.innerHTML='<strong style="color: var(--text-accent)">\u26A0\uFE0F OMNISEARCH IS DISABLED \u26A0\uFE0F</strong>'}e.createEl("h2",{text:"Omnisearch"});let r=e.createDiv();r.innerHTML=`
        <iframe src="https://github.com/sponsors/scambier/button" title="Sponsor scambier" height="35" width="116" style="border: 0;"></iframe>
        <a href='https://ko-fi.com/B0B6LQ2C' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://cdn.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
    `,new W.Setting(e).setName("Indexing").setHeading();let n=new DocumentFragment;qe()?n.createSpan({},d=>{d.innerHTML=`\u{1F44D} You have installed <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a>, Omnisearch will use it to index PDFs and images.
            <br />Text extraction only works on desktop, but the cache can be synchronized with your mobile device.`}):n.createSpan({},d=>{d.innerHTML='\u26A0\uFE0F Omnisearch requires <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a> to index PDFs and images.'}),new W.Setting(e).setDesc(n);let i=new DocumentFragment;i.createSpan({},d=>{d.innerHTML="Include PDFs in search results"}),new W.Setting(e).setName(`PDFs Indexing ${qe()?"":"\u26A0\uFE0F Disabled"}`).setDesc(i).addToggle(d=>d.setValue(D.PDFIndexing).onChange(async v=>{D.PDFIndexing=v,await ue(this.plugin)})).setDisabled(!qe());let s=new DocumentFragment;s.createSpan({},d=>{d.innerHTML="Include images in search results"}),new W.Setting(e).setName(`Images Indexing ${qe()?"":"\u26A0\uFE0F Disabled"}`).setDesc(s).addToggle(d=>d.setValue(D.imagesIndexing).onChange(async v=>{D.imagesIndexing=v,await ue(this.plugin)})).setDisabled(!qe());let o=new DocumentFragment;o.createSpan({},d=>{d.innerHTML=`Include <a href="https://github.com/trey-wallis/obsidian-dataloom">DataLoom</a> <pre style="display:inline">.loom</pre> files in search results
      <br/>${Qt}`}),new W.Setting(e).setName("DataLoom indexing (beta)").setDesc(o).addToggle(d=>d.setValue(D.dataloomIndexing).onChange(async v=>{D.dataloomIndexing=v,await ue(this.plugin)})).setDisabled(!qe());let a=new DocumentFragment;a.createSpan({},d=>{d.innerHTML=`In addition to standard <code>md</code> files, Omnisearch can also index other <strong style="color: var(--text-accent)">PLAINTEXT</strong> files.<br/>
      Add extensions separated by a space, without the dot. Example: "<code>txt org csv</code>".<br />
      \u26A0\uFE0F <span style="color: var(--text-accent)">Using extensions of non-plaintext files (like .docx or .pptx) WILL cause crashes,
      because Omnisearch will try to index their content.</span><br />
      ${Qt}`}),new W.Setting(e).setName("Additional TEXT files to index").setDesc(a).addText(d=>{d.setValue(D.indexedFileTypes.join(" ")).setPlaceholder("Example: txt org csv").onChange(async v=>{D.indexedFileTypes=v.split(" "),await ue(this.plugin)})});let u=new DocumentFragment;u.createSpan({},d=>{d.innerHTML=`
      Omnisearch can index file<strong>names</strong> of "unsupported" files, such as e.g. <pre style="display:inline">.mp4</pre> or <pre style="display:inline">.xlsx</pre>.<br/>
      "Obsidian setting" will respect the value of "<em>Files & Links > Detect all file extensions</em>".
      <br />${Qt}`}),new W.Setting(e).setName("Index unsupported files (beta)").setDesc(u).addDropdown(d=>{d.addOptions({yes:"Yes",no:"No",default:"Obsidian setting"}).setValue(D.unsupportedFilesIndexing).onChange(async v=>{D.unsupportedFilesIndexing=v,await ue(this.plugin)})}),new W.Setting(e).setName("Behavior").setHeading(),new W.Setting(e).setName("Save index to cache").setDesc("Enable caching to speed up indexing time. In rare cases, the cache write may cause a freeze in Obsidian. This option will disable itself if it happens.").addToggle(d=>d.setValue(D.useCache).onChange(async v=>{D.useCache=v,await ue(this.plugin)})),new W.Setting(e).setName(`Respect Obsidian's "Excluded Files"`).setDesc(`By default, files that are in Obsidian's "Options > Files & Links > Excluded Files" list are downranked in results.
        Enable this option to completely hide them`).addToggle(d=>d.setValue(D.hideExcluded).onChange(async v=>{D.hideExcluded=v,await ue(this.plugin)}));let l=new DocumentFragment;l.createSpan({},d=>{d.innerHTML=`Normalize diacritics in search terms. Words like "br\xFBl\xE9e" or "\u017Elu\u0165ou\u010Dk\xFD" will be indexed as "brulee" and "zlutoucky".<br/>
        \u26A0\uFE0F <span style="color: var(--text-accent)">You probably should <strong>NOT</strong> disable this.</span><br>
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${Qt}
        `}),new W.Setting(e).setName("Ignore diacritics").setDesc(l).addToggle(d=>d.setValue(D.ignoreDiacritics).onChange(async v=>{await Ne.clearCache(),D.ignoreDiacritics=v,await ue(this.plugin)}));let f=new DocumentFragment;f.createSpan({},d=>{d.innerHTML=`Enable this if you want to be able to search for CamelCaseWords as separate words.<br/>        
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${Qt}
        `}),new W.Setting(e).setName("Split CamelCaseWords").setDesc(f).addToggle(d=>d.setValue(D.splitCamelCase).onChange(async v=>{await Ne.clearCache(),D.splitCamelCase=v,await ue(this.plugin)})),new W.Setting(e).setName("Simpler search").setDesc(`Enable this if Obsidian often freezes while making searches.
        Words shorter than 3 characters won't be used as prefixes; this can reduce search delay but will return fewer results.`).addToggle(d=>d.setValue(D.simpleSearch).onChange(async v=>{D.simpleSearch=v,await ue(this.plugin)})),new W.Setting(e).setName("Open in new pane").setDesc("Open and create files in a new pane instead of the current pane.").addToggle(d=>d.setValue(D.openInNewPane).onChange(async v=>{D.openInNewPane=v,await ue(this.plugin)})),new W.Setting(e).setName("Fuzziness").setDesc("Define the level of fuzziness for the search. The higher the fuzziness, the more results you'll get.").addDropdown(d=>d.addOptions({0:"Exact match",1:"Not too fuzzy",2:"Fuzzy enough"}).setValue(D.fuzziness).onChange(async v=>{["0","1","2"].includes(v)||(v="2"),D.fuzziness=v,await ue(this.plugin)})),new W.Setting(e).setName("User Interface").setHeading(),new W.Setting(e).setName("Show ribbon button").setDesc("Add a button on the sidebar to open the Vault search modal.").addToggle(d=>d.setValue(D.ribbonIcon).onChange(async v=>{D.ribbonIcon=v,await ue(this.plugin),v?this.plugin.addRibbonButton():this.plugin.removeRibbonButton()})),new W.Setting(e).setName("Show excerpts").setDesc("Shows the contextual part of the note that matches the search. Disable this to only show filenames in results.").addToggle(d=>d.setValue(D.showExcerpt).onChange(async v=>{Gt.set(v)})),new W.Setting(e).setName("Render line return in excerpts").setDesc("Activate this option to render line returns in result excerpts.").addToggle(d=>d.setValue(D.renderLineReturnInExcerpts).onChange(async v=>{D.renderLineReturnInExcerpts=v,await ue(this.plugin)})),new W.Setting(e).setName("Show previous query results").setDesc("Re-executes the previous query when opening Omnisearch.").addToggle(d=>d.setValue(D.showPreviousQueryResults).onChange(async v=>{D.showPreviousQueryResults=v,await ue(this.plugin)}));let h=new DocumentFragment;h.createSpan({},d=>{d.innerHTML=`Shows a button next to the search input, to create a note.
        Acts the same as the <code>shift \u21B5</code> shortcut, can be useful for mobile device users.`}),new W.Setting(e).setName('Show "Create note" button').setDesc(h).addToggle(d=>d.setValue(D.showCreateButton).onChange(async v=>{D.showCreateButton=v,await ue(this.plugin)})),new W.Setting(e).setName("Highlight matching words in results").setDesc("Will highlight matching results when enabled. See README for more customization options.").addToggle(d=>d.setValue(D.highlight).onChange(async v=>{D.highlight=v,await ue(this.plugin)})),new W.Setting(e).setName("Results weighting").setHeading(),new W.Setting(e).setName(`File name & declared aliases (default: ${wt.weightBasename})`).addSlider(d=>this.weightSlider(d,"weightBasename")),new W.Setting(e).setName(`File directory (default: ${wt.weightDirectory})`).addSlider(d=>this.weightSlider(d,"weightDirectory")),new W.Setting(e).setName(`Headings level 1 (default: ${wt.weightH1})`).addSlider(d=>this.weightSlider(d,"weightH1")),new W.Setting(e).setName(`Headings level 2 (default: ${wt.weightH2})`).addSlider(d=>this.weightSlider(d,"weightH2")),new W.Setting(e).setName(`Headings level 3 (default: ${wt.weightH3})`).addSlider(d=>this.weightSlider(d,"weightH3")),new W.Setting(e).setName(`Tags without the # (default: ${wt.weightUnmarkedTags})`).addSlider(d=>this.weightSlider(d,"weightUnmarkedTags")),new W.Setting(e).setName("Debugging").setHeading(),new W.Setting(e).setName("Enable verbose logging").setDesc("Adds a LOT of logs for debugging purposes. Don't forget to disable it.").addToggle(d=>d.setValue(D.verboseLogging).onChange(async v=>{D.verboseLogging=v,await ue(this.plugin)})),new W.Setting(e).setName("Danger Zone").setHeading();let c=new DocumentFragment;if(c.createSpan({},d=>{d.innerHTML=`Disable Omnisearch on this device only.<br>
        ${Qt}`}),new W.Setting(e).setName("Disable on this device").setDesc(c).addToggle(d=>d.setValue(Os()).onChange(async v=>{v?app.saveLocalStorage(un,"1"):app.saveLocalStorage(un),new W.Notice("Omnisearch - Disabled. Please restart Obsidian.")})),jt()){let d=new DocumentFragment;d.createSpan({},v=>{v.innerHTML=`Erase all Omnisearch cache data.
          Use this if Omnisearch results are inconsistent, missing, or appear outdated.<br>
          ${Qt}`}),new W.Setting(e).setName("Clear cache data").setDesc(d).addButton(v=>{v.setButtonText("Clear cache"),v.onClick(async()=>{await Ne.clearCache(),new W.Notice("Omnisearch - Cache cleared. Please restart Obsidian.")})})}}weightSlider(e,r){e.setLimits(1,5,.1).setValue(D[r]).setDynamicTooltip().onChange(n=>{D[r]=n,ue(this.plugin)})}},wt={useCache:!0,hideExcluded:!1,ignoreDiacritics:!0,indexedFileTypes:[],PDFIndexing:!1,imagesIndexing:!1,dataloomIndexing:!1,unsupportedFilesIndexing:"no",splitCamelCase:!1,openInNewPane:!1,ribbonIcon:!0,showExcerpt:!0,renderLineReturnInExcerpts:!0,showCreateButton:!1,highlight:!0,showPreviousQueryResults:!0,simpleSearch:!1,fuzziness:"0",weightBasename:3,weightDirectory:2,weightH1:1.5,weightH2:1.3,weightH3:1.1,weightUnmarkedTags:1.1,welcomeMessage:"",verboseLogging:!1},D=Object.assign({},wt);async function Aa(t){D=Object.assign({},wt,await t.loadData()),Gt.set(D.showExcerpt)}async function ue(t){await t.saveData(D)}function Os(){return app.loadLocalStorage(un)==="1"}function Sa(){return D.unsupportedFilesIndexing==="yes"||D.unsupportedFilesIndexing==="default"&&!!app.vault.getConfig("showUnsupportedFiles")}var Fa=Fe(require("obsidian"));var Ea=/[\u4e00-\u9fa5]/;var Da=100,cn=300,Ta=`suggestion-highlight omnisearch-highlight ${D.highlight?"omnisearch-default-highlight":""}`,un="omnisearch-disabled",G=new Ki,Yn={ToggleExcerpts:"toggle-excerpts"},We=(s=>(s[s.Done=0]="Done",s[s.LoadingCache=1]="LoadingCache",s[s.ReadingFiles=2]="ReadingFiles",s[s.IndexingFiles=3]="IndexingFiles",s[s.WritingCache=4]="WritingCache",s))(We||{});var Ct=An(0),Ia=!1;function Ps(t){Ia=t}function ka(){return Ia}function Jn(){return app.plugins.plugins["cm-chs-patch"]}function qe(){return app.plugins?.plugins?.["text-extractor"]?.api}function jt(){return!Fa.Platform.isIosApp&&D.useCache}var At=/[|\n\r -#%-*,.\/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Wa=Fe(require("obsidian"));var ct=Fe(require("obsidian"));var Pa=Fe(require("crypto")),Ma=Fe(Oa());function St(t,...e){return e[1].trim()?`<span>${e[0]}</span><span class="${Ta}">${e[1]}</span>`:"&lt;no content&gt;"}function Id(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Ra(t){let e=t.split("/");return e.pop(),e.join("/")}function kd(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"[$&]")}function Ft(t){if(!t.length)return/^$/g;t.sort((n,i)=>i.length-n.length);let e="("+(Jn()?"":D.splitCamelCase?`^|${At.source}|-|[A-Z]`:`^|${At.source}|-`)+`)(${t.map(n=>kd(n)).join("|")})`;return new RegExp(`${e}`,"giu")}function Xn(t,e){return t.headings?.filter(r=>r.level===e).map(r=>r.heading)??[]}function Zn(t,e){return(t+e)%e}function vr(t,e){try{let r=e??-1,n=Math.max(0,r-Da),i=Math.min(t.length,r+cn);if(r>-1?t=(n>0?"\u2026":"")+t.slice(n,i).trim()+(i<t.length-1?"\u2026":""):t=t.slice(0,cn),D.renderLineReturnInExcerpts){let s=new RegExp(/(?:\r\n|\r|\n)/g);t=t.split(s).filter(a=>a).join(`
`);let o=t.lastIndexOf(`
`,r-n);o>0&&(t=t.slice(o))}return t=Id(t),D.renderLineReturnInExcerpts&&(t=t.trim().replaceAll(`
`,"<br>")),t}catch(r){return new ct.Notice("Omnisearch - Error while creating excerpt, see developer console"),console.error("Omnisearch - Error while creating excerpt"),console.error(r),""}}function Rs(t){return t.replace(/(\*|_)+(.+?)(\*|_)+/g,(e,r,n)=>n)}function La(t){return t?.frontmatter?(0,ct.parseFrontMatterAliases)(t.frontmatter)??[]:[]}function Ba(t){let e=t?(0,ct.getAllTags)(t)??[]:[];return e=[...new Set(e.reduce((r,n)=>[...r,...n.split("/").filter(i=>i).map(i=>i.startsWith("#")?i:`#${i}`),n],[]))],e}function ft(t){return t==null?"":(t=t.replaceAll("`","[__omnisearch__backtick__]"),t=t.normalize("NFD").replace(/\p{Diacritic}/gu,""),t=t.replaceAll("[__omnisearch__backtick__]","`"),t)}function qt(){return ct.Platform.isMacOS?"\u2318":"ctrl"}function Od(t){let e=!!qe(),r=e&&D.PDFIndexing,n=e&&D.imagesIndexing;return ei(t)||br(t)||ti(t)||r&&_r(t)||n&&pn(t)}function Ls(t){return Sa()||ei(t)||br(t)||ti(t)||_r(t)||pn(t)}function dn(t){return Ls(t)||Od(t)}function pn(t){let e=Yt(t);return e==="png"||e==="jpg"||e==="jpeg"||e==="webp"}function _r(t){return Yt(t)==="pdf"}function ei(t){return[...D.indexedFileTypes,"md"].some(e=>t.endsWith(`.${e}`))}function br(t){return t.endsWith(".canvas")}function ti(t){return t.endsWith(".loom")||t.endsWith(".dashboard")}function Yt(t){let e=t.split(".");return e[e.length-1]??""}function Na(t){return ct.Platform.isMobileApp?(0,Ma.md5)(t.toString()):(0,Pa.createHash)("md5").update(t).digest("hex")}function Ka(t,e){let r=[],n=0,i=t.length;for(;n<i;)r.push(t.slice(n,n+=e));return r}function za(t){let e=t.replace(/([a-z](?=[A-Z]))/g,"$1 ").split(" ").filter(r=>r);return e.length>1?e:[]}function Va(t){let e=t.split("-").filter(r=>r);return e.length>1?e:[]}function de(...t){$a(console.log,...t)}function Ha(...t){$a(console.warn,...t)}function $a(t,...e){if(D.verboseLogging){let r=new Date,n=`${r.getMinutes()}:${r.getSeconds()}:${r.getMilliseconds()}`;t("Omnisearch -",n+" -",...e)}}async function Pd(t){let e=app.vault.getFiles().find(o=>o.path===t);if(!e)throw new Error(`Invalid file path: "${t}"`);let r=null,n=qe();if(ei(t))r=await app.vault.cachedRead(e);else if(br(t)){let o=JSON.parse(await app.vault.cachedRead(e)),a=[];for(let u of o.nodes)u.type==="text"?a.push(u.text):u.type==="file"&&a.push(u.file);for(let u of o.edges.filter(l=>!!l.label))a.push(u.label);r=a.join(`\r
`)}else if(D.dataloomIndexing&&ti(t))try{let o=JSON.parse(await app.vault.cachedRead(e)),a=[],u=l=>{for(let f in l)typeof l[f]=="object"?u(l[f]):f==="markdown"&&a.push(l[f])};u(o),r=a.join(`\r
`)}catch(o){console.error("Omnisearch: Error while parsing Dataloom file",t),console.error(o)}else n?.canFileBeExtracted(t)?r=await n.extractText(e):Ls(t)&&(r=e.path);r==null&&(console.warn(`Omnisearch: ${r} content for file`,e.path),r=""),r=ft(r);let i=app.metadataCache.getFileCache(e);if(i&&i.frontmatter?.["excalidraw-plugin"]){let o=i.sections?.filter(a=>a.type==="comment")??[];for(let{start:a,end:u}of o.map(l=>l.position))r=r.substring(0,a.offset-1)+r.substring(u.offset)}let s=Ba(i);return{basename:ft(e.basename),content:r,path:e.path,mtime:e.stat.mtime,tags:s,unmarkedTags:s.map(o=>o.replace("#","")),aliases:La(i).join(""),headings1:i?Xn(i,1).join(" "):"",headings2:i?Xn(i,2).join(" "):"",headings3:i?Xn(i,3).join(" "):""}}var Ua=class{constructor(){this.nextQueryIsEmpty=!1;this.documents=new Map}async addToLiveCache(e){try{let r=await Pd(e);if(!r.path){console.error(`Missing .path field in IndexedDocument "${r.basename}", skipping`);return}this.documents.set(e,r)}catch(r){console.warn(`Omnisearch: Error while adding "${e}" to live cache`,r),this.removeFromLiveCache(e)}}removeFromLiveCache(e){this.documents.delete(e)}async getDocument(e){return this.documents.has(e)?this.documents.get(e):(de("Generating IndexedDocument from",e),await this.addToLiveCache(e),this.documents.get(e))}async addToSearchHistory(e){if(!e){this.nextQueryIsEmpty=!0;return}this.nextQueryIsEmpty=!1;let r=await Ne.searchHistory.toArray();r=r.filter(n=>n.query!==e).reverse(),r.unshift({query:e}),r=r.slice(0,10),await Ne.searchHistory.clear(),await Ne.searchHistory.bulkAdd(r)}async getSearchHistory(){let e=(await Ne.searchHistory.toArray()).reverse().map(r=>r.query);return this.nextQueryIsEmpty&&e.unshift(""),e}getDocumentsChecksum(e){return Na(JSON.stringify(e.sort((r,n)=>r.path<n.path?-1:r.path>n.path?1:0)))}async getMinisearchCache(){try{return(await Ne.minisearch.toArray())[0]}catch(e){return new Wa.Notice("Omnisearch - Cache missing or invalid. Some freezes may occur while Omnisearch indexes your vault."),console.error("Omnisearch - Error while loading Minisearch cache"),console.error(e),null}}async writeMinisearchCache(e,r){let n=Array.from(r).map(([i,s])=>({path:i,mtime:s}));await Ne.minisearch.clear(),await Ne.minisearch.add({date:new Date().toISOString(),paths:n,data:e.toJSON()}),console.log("Omnisearch - Search cache written")}},we=new Ua;function Md(t){let e,r,n,i,s,o,a,u,l=t[8].default,f=rr(l,t,t[7],null);return{c(){e=R("div"),r=R("div"),n=R("input"),s=U(),f&&f.c(),B(n,"class","prompt-input"),B(n,"placeholder",t[0]),B(n,"spellcheck","false"),B(n,"type","text"),B(r,"class","omnisearch-input-field"),B(e,"class","omnisearch-input-container")},m(h,c){$(h,e,c),I(e,r),I(r,n),t[9](n),Oi(n,t[1]),I(e,s),f&&f.m(e,null),o=!0,a||(u=[Le(n,"input",t[10]),So(i=t[3].call(null,n)),Le(n,"compositionend",t[11]),Le(n,"compositionstart",t[12]),Le(n,"input",t[4])],a=!0)},p(h,[c]){(!o||c&1)&&B(n,"placeholder",h[0]),c&2&&n.value!==h[1]&&Oi(n,h[1]),f&&f.p&&(!o||c&128)&&ir(f,l,h,h[7],o?nr(l,h[7],c,null):sr(h[7]),null)},i(h){o||(ee(f,h),o=!0)},o(h){re(f,h),o=!1},d(h){h&&H(e),t[9](null),f&&f.d(h),a=!1,Ue(u)}}}function Rd(t,e,r){let{$$slots:n={},$$scope:i}=e,{initialValue:s=""}=e,{placeholder:o=""}=e,a=!1,u="",l,f=Ri();function h(m){r(1,u=m)}function c(m){m&&!a&&!u&&(a=!0,r(1,u=m),d())}function d(m){mt().then(()=>(l.focus(),mt())).then(()=>{l.select()})}let v=(0,Ga.debounce)(()=>{we.addToSearchHistory(""),f("input",u)},300);function w(m){tt[m?"unshift":"push"](()=>{l=m,r(2,l)})}function x(){u=this.value,r(1,u)}let p=m=>Ps(!1),b=m=>Ps(!0);return t.$$set=m=>{"initialValue"in m&&r(5,s=m.initialValue),"placeholder"in m&&r(0,o=m.placeholder),"$$scope"in m&&r(7,i=m.$$scope)},t.$$.update=()=>{if(t.$$.dirty&32){e:c(s)}},[o,u,l,d,v,s,h,i,n,w,x,p,b]}var Qa=class extends Ae{constructor(e){super();De(this,e,Rd,Md,be,{initialValue:5,placeholder:0,setInputValue:6})}get setInputValue(){return this.$$.ctx[6]}},ri=Qa;function Ld(t){let e,r,n,i,s=t[1].default,o=rr(s,t,t[0],null);return{c(){e=R("div"),o&&o.c(),B(e,"class","prompt-results")},m(a,u){$(a,e,u),o&&o.m(e,null),r=!0,n||(i=Le(e,"mousedown",Bd),n=!0)},p(a,[u]){o&&o.p&&(!r||u&1)&&ir(o,s,a,a[0],r?nr(s,a[0],u,null):sr(a[0]),null)},i(a){r||(ee(o,a),r=!0)},o(a){re(o,a),r=!1},d(a){a&&H(e),o&&o.d(a),n=!1,i()}}}var Bd=t=>t.preventDefault();function Nd(t,e,r){let{$$slots:n={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&r(0,i=s.$$scope)},[i,n]}var qa=class extends Ae{constructor(e){super();De(this,e,Nd,Ld,be,{})}},ni=qa;var Bs=Fe(require("obsidian"));async function ii(t,e=!1){let r=Ft(t.foundWords);r.exec(t.content);let n=r.lastIndex,i=!1;app.workspace.iterateAllLeaves(a=>{a.view instanceof Bs.MarkdownView&&!e&&a.getViewState().state?.file===t.path&&a.getViewState()?.pinned&&(app.workspace.setActiveLeaf(a,{focus:!0}),i=!0)}),i||await app.workspace.openLinkText(t.path,"",e);let s=app.workspace.getActiveViewOfType(Bs.MarkdownView);if(!s)return;let o=s.editor.offsetToPos(n);o.ch=0,s.editor.setCursor(o),s.editor.scrollIntoView({from:{line:o.line-10,ch:0},to:{line:o.line+10,ch:0}})}async function Ya(t,e=!1){try{let r;switch(app.vault.getConfig("newFileLocation")){case"current":r=(app.workspace.getActiveFile()?.parent?.path??"")+"/";break;case"folder":r=app.vault.getConfig("newFileFolderPath")+"/";break;default:r="";break}await app.workspace.openLinkText(`${r}${t}.md`,"",e)}catch(r){throw r.message="OmniSearch - Could not create note: "+r.message,console.error(r),r}}function Kd(t){let e;return{c(){e=R("span"),e.innerHTML='<svg viewBox="0 0 100 100" class="add-note-glyph" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="M23.3,6.7c-3.7,0-6.7,3-6.7,6.7v73.3c0,3.7,3,6.7,6.7,6.7h28.4c-3.2-4.8-5.1-10.5-5.1-16.7c0-16.6,13.4-30,30-30 c2.3,0,4.5,0.3,6.7,0.8V31.7c0-0.9-0.3-1.7-1-2.4L60.7,7.6c-0.6-0.6-1.5-1-2.4-1L23.3,6.7z M56.7,13L77,33.3H60 c-1.8,0-3.3-1.5-3.3-3.3L56.7,13z M76.7,53.3c-12.9,0-23.3,10.4-23.3,23.3S63.8,100,76.7,100S100,89.6,100,76.7 S89.6,53.3,76.7,53.3z M76.7,63.3c1.8,0,3.3,1.5,3.3,3.3v6.7h6.7c1.8,0,3.3,1.5,3.3,3.3c0,1.8-1.5,3.3-3.3,3.3H80v6.7 c0,1.8-1.5,3.3-3.3,3.3c-1.8,0-3.3-1.5-3.3-3.3V80h-6.7c-1.8,0-3.3-1.5-3.3-3.3s1.5-3.3,3.3-3.3h6.7v-6.7 C73.3,64.8,74.8,63.3,76.7,63.3L76.7,63.3z"></path></svg>',B(e,"class","suggestion-flair"),B(e,"aria-label","Not created yet, select to create")},m(r,n){$(r,e,n)},p:fe,i:fe,o:fe,d(r){r&&H(e)}}}function zd(t){"use strict";return[]}var Ja=class extends Ae{constructor(e){super();De(this,e,zd,Kd,be,{})}},Xa=Ja;function Za(t){let e,r;return e=new Xa({}),{c(){Be(e.$$.fragment)},m(n,i){Oe(e,n,i),r=!0},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function Vd(t){let e,r,n,i,s,o=t[2]&&Za(t),a=t[4].default,u=rr(a,t,t[3],null);return{c(){e=R("div"),o&&o.c(),r=U(),u&&u.c(),B(e,"data-result-id",t[0]),B(e,"class","suggestion-item omnisearch-result"),Pi(e,"is-selected",t[1])},m(l,f){$(l,e,f),o&&o.m(e,null),I(e,r),u&&u.m(e,null),n=!0,i||(s=[Le(e,"mousemove",t[5]),Le(e,"click",t[6]),Le(e,"keypress",t[7]),Le(e,"auxclick",t[8])],i=!0)},p(l,[f]){l[2]?o?f&4&&ee(o,1):(o=Za(l),o.c(),ee(o,1),o.m(e,r)):o&&(Bt(),re(o,1,1,()=>{o=null}),Nt()),u&&u.p&&(!n||f&8)&&ir(u,a,l,l[3],n?nr(a,l[3],f,null):sr(l[3]),null),(!n||f&1)&&B(e,"data-result-id",l[0]),(!n||f&2)&&Pi(e,"is-selected",l[1])},i(l){n||(ee(o),ee(u,l),n=!0)},o(l){re(o),re(u,l),n=!1},d(l){l&&H(e),o&&o.d(),u&&u.d(l),i=!1,Ue(s)}}}function Hd(t,e,r){let{$$slots:n={},$$scope:i}=e,{id:s}=e,{selected:o=!1}=e,{glyph:a=!1}=e;function u(c){Ve.call(this,t,c)}function l(c){Ve.call(this,t,c)}function f(c){Ve.call(this,t,c)}function h(c){Ve.call(this,t,c)}return t.$$set=c=>{"id"in c&&r(0,s=c.id),"selected"in c&&r(1,o=c.selected),"glyph"in c&&r(2,a=c.glyph),"$$scope"in c&&r(3,i=c.$$scope)},[s,o,a,i,n,u,l,f,h]}var el=class extends Ae{constructor(e){super();De(this,e,Hd,Vd,be,{id:0,selected:1,glyph:2})}},si=el;var xr=Fe(require("obsidian"));function tl(t){let e,r=t[1].matches.length+"",n,i,s=(t[1].matches.length>1?"matches":"match")+"",o;return{c(){e=R("span"),n=xe(r),i=xe("\xA0"),o=xe(s),B(e,"class","omnisearch-result__counter")},m(a,u){$(a,e,u),I(e,n),I(e,i),I(e,o)},p(a,u){u&2&&r!==(r=a[1].matches.length+"")&&Ge(n,r),u&2&&s!==(s=(a[1].matches.length>1?"matches":"match")+"")&&Ge(o,s)},d(a){a&&H(e)}}}function rl(t){let e,r,n,i,s;return{c(){e=R("div"),r=R("span"),n=U(),i=R("span"),s=xe(t[6]),B(e,"class","omnisearch-result__folder-path")},m(o,a){$(o,e,a),I(e,r),t[12](r),I(e,n),I(e,i),I(i,s)},p(o,a){a&64&&Ge(s,o[6])},d(o){o&&H(e),t[12](null)}}}function nl(t){let e,r=t[8].replace(t[9],St)+"";return{c(){e=R("div"),B(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&768&&r!==(r=n[8].replace(n[9],St)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function il(t){let e,r,n;return{c(){e=R("div"),r=R("img"),ze(r,"width","100px"),ki(r.src,n=t[5])||B(r,"src",n),B(r,"alt",""),B(e,"class","omnisearch-result__image-container")},m(i,s){$(i,e,s),I(e,r)},p(i,s){s&32&&!ki(r.src,n=i[5])&&B(r,"src",n)},d(i){i&&H(e)}}}function $d(t){let e,r,n,i,s,o,a=t[2].replace(t[9],St)+"",u,l,f,h=Yt(t[1].path)+"",c,d,v,w,x,p,b=t[1].matches.length>0&&tl(t),m=t[6]&&rl(t),g=t[10]&&nl(t),_=t[5]&&il(t);return{c(){e=R("div"),r=R("div"),n=R("span"),i=R("span"),s=U(),o=R("span"),u=U(),l=R("span"),f=xe("."),c=xe(h),d=U(),b&&b.c(),v=U(),m&&m.c(),w=U(),x=R("div"),g&&g.c(),p=U(),_&&_.c(),B(l,"class","omnisearch-result__extension"),B(n,"class","omnisearch-result__title"),B(r,"class","omnisearch-result__title-container"),ze(x,"display","flex"),ze(x,"flex-direction","row")},m(y,j){$(y,e,j),I(e,r),I(r,n),I(n,i),t[11](i),I(n,s),I(n,o),o.innerHTML=a,I(n,u),I(n,l),I(l,f),I(l,c),I(n,d),b&&b.m(n,null),I(e,v),m&&m.m(e,null),I(e,w),I(e,x),g&&g.m(x,null),I(x,p),_&&_.m(x,null)},p(y,j){j&516&&a!==(a=y[2].replace(y[9],St)+"")&&(o.innerHTML=a),j&2&&h!==(h=Yt(y[1].path)+"")&&Ge(c,h),y[1].matches.length>0?b?b.p(y,j):(b=tl(y),b.c(),b.m(n,null)):b&&(b.d(1),b=null),y[6]?m?m.p(y,j):(m=rl(y),m.c(),m.m(e,w)):m&&(m.d(1),m=null),y[10]?g?g.p(y,j):(g=nl(y),g.c(),g.m(x,p)):g&&(g.d(1),g=null),y[5]?_?_.p(y,j):(_=il(y),_.c(),_.m(x,null)):_&&(_.d(1),_=null)},d(y){y&&H(e),t[11](null),b&&b.d(),m&&m.d(),g&&g.d(),_&&_.d()}}}function Wd(t){let e,r;return e=new si({props:{glyph:t[7],id:t[1].path,selected:t[0],$$slots:{default:[$d]},$$scope:{ctx:t}}}),e.$on("click",t[13]),e.$on("auxclick",t[14]),e.$on("mousemove",t[15]),{c(){Be(e.$$.fragment)},m(n,i){Oe(e,n,i),r=!0},p(n,[i]){let s={};i&128&&(s.glyph=n[7]),i&2&&(s.id=n[1].path),i&1&&(s.selected=n[0]),i&67454&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function Ud(t,e,r){let n,i,s,o;bn(t,Gt,m=>r(10,o=m));let{selected:a=!1}=e,{note:u}=e,l=null,f="",h="",c,d;function v(m){tt[m?"unshift":"push"](()=>{d=m,r(4,d)})}function w(m){tt[m?"unshift":"push"](()=>{c=m,r(3,c)})}function x(m){Ve.call(this,t,m)}function p(m){Ve.call(this,t,m)}function b(m){Ve.call(this,t,m)}t.$$set=m=>{"selected"in m&&r(0,a=m.selected),"note"in m&&r(1,u=m.note)},t.$$.update=()=>{if(t.$$.dirty&2){e:if(r(5,l=null),pn(u.path)){let m=app.vault.getFiles().find(g=>g.path===u.path);m&&r(5,l=app.vault.getResourcePath(m))}}if(t.$$.dirty&2){e:r(9,n=Ft(u.foundWords))}if(t.$$.dirty&2){e:r(8,i=vr(u.content,u.matches[0]?.offset??-1))}if(t.$$.dirty&30){e:r(2,f=u.basename),r(6,h=Ra(u.path)),D.ignoreDiacritics&&r(2,f=ft(f)),c&&(0,xr.setIcon)(c,"folder-open"),d&&(pn(u.path)?(0,xr.setIcon)(d,"image"):_r(u.path)?(0,xr.setIcon)(d,"file-text"):br(u.path)?(0,xr.setIcon)(d,"layout-dashboard"):(0,xr.setIcon)(d,"file"))}};e:r(7,s=!1);return[a,u,f,c,d,l,h,s,i,n,o,v,w,x,p,b]}var sl=class extends Ae{constructor(e){super();De(this,e,Ud,Wd,be,{selected:0,note:1})}},ol=sl;var cl=Fe(ul()),Ns=["ext","path"],Jt=class{#e;constructor(e=""){D.ignoreDiacritics&&(e=ft(e));let r=(0,cl.parse)(e.toLowerCase(),{tokenize:!0,keywords:Ns});r.text=r.text??[],r.exclude=r.exclude??{},r.exclude.text=r.exclude.text??[],Array.isArray(r.exclude.text)||(r.exclude.text=[r.exclude.text]);for(let n of Ns){let i=r[n];i&&(r[n]=Array.isArray(i)?i:[i]);let s=r.exclude[n];s&&(r.exclude[n]=Array.isArray(s)?s:[s])}this.query=r,this.#e=e.match(/"([^"]+)"/g)?.map(n=>n.replace(/"/g,""))??[]}isEmpty(){for(let e of Ns)if(this.query[e]?.length||this.query.text.length)return!1;return!0}segmentsToStr(){return this.query.text.join(" ")}getTags(){return this.query.text.filter(e=>e.startsWith("#"))}getTagsWithoutHashtag(){return this.getTags().map(e=>e.replace(/^#/,""))}getExactTerms(){return[...new Set([...this.query.text.filter(e=>e.split(" ").length>1),...this.#e])]}};var ae=function(){return ae=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ae.apply(this,arguments)};function Gd(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(f){try{l(n.next(f))}catch(h){o(h)}}function u(f){try{l(n.throw(f))}catch(h){o(h)}}function l(f){f.done?s(f.value):i(f.value).then(a,u)}l((n=n.apply(t,e||[])).next())})}function Qd(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(f){return u([l,f])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Q(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}var qd="ENTRIES",fl="KEYS",dl="VALUES",Se="",Ks=function(){function t(e,r){var n=e._tree,i=Array.from(n.keys());this.set=e,this._type=r,this._path=i.length>0?[{node:n,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=wr(this._path),r=e.node,n=e.keys;if(wr(n)===Se)return{done:!1,value:this.result()};var i=r.get(wr(n));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=wr(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var r=e.keys;return wr(r)}).filter(function(e){return e!==Se}).join("")},t.prototype.value=function(){return wr(this._path).node.get(Se)},t.prototype.result=function(){switch(this._type){case dl:return this.value();case fl:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),wr=function(t){return t[t.length-1]},Yd=function(t,e,r){var n=new Map;if(e===void 0)return n;for(var i=e.length+1,s=i+r,o=new Uint8Array(s*i).fill(r+1),a=0;a<i;++a)o[a]=a;for(var u=1;u<s;++u)o[u*i]=u;return pl(t,e,r,n,o,1,i,""),n},pl=function(t,e,r,n,i,s,o,a){var u,l,f=s*o;try{e:for(var h=Q(t.keys()),c=h.next();!c.done;c=h.next()){var d=c.value;if(d===Se){var v=i[f-1];v<=r&&n.set(a,[t.get(d),v])}else{for(var w=s,x=0;x<d.length;++x,++w){for(var p=d[x],b=o*w,m=b-o,g=i[b],_=Math.max(0,w-r-1),y=Math.min(o-1,w+r),j=_;j<y;++j){var C=p!==e[j],S=i[m+j]+ +C,E=i[m+j+1]+1,P=i[b+j]+1,L=i[b+j+1]=Math.min(S,E,P);L<g&&(g=L)}if(g>r)continue e}pl(t.get(d),e,r,n,i,w,o,a+d)}}}catch(O){u={error:O}}finally{try{c&&!c.done&&(l=h.return)&&l.call(h)}finally{if(u)throw u.error}}},zs=function(){function t(e,r){e===void 0&&(e=new Map),r===void 0&&(r=""),this._size=void 0,this._tree=e,this._prefix=r}return t.prototype.atPrefix=function(e){var r,n;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=me(ai(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=me($s(o),2),u=a[0],l=a[1];try{for(var f=Q(u.keys()),h=f.next();!h.done;h=f.next()){var c=h.value;if(c!==Se&&c.startsWith(l)){var d=new Map;return d.set(c.slice(l.length),u.get(c)),new t(d,e)}}}catch(v){r={error:v}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}}return new t(s,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,Jd(this._tree,e)},t.prototype.entries=function(){return new Ks(this,qd)},t.prototype.forEach=function(e){var r,n;try{for(var i=Q(this),s=i.next();!s.done;s=i.next()){var o=me(s.value,2),a=o[0],u=o[1];e(a,u,this)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.fuzzyGet=function(e,r){return Yd(this._tree,e,r)},t.prototype.get=function(e){var r=Vs(this._tree,e);return r!==void 0?r.get(Se):void 0},t.prototype.has=function(e){var r=Vs(this._tree,e);return r!==void 0&&r.has(Se)},t.prototype.keys=function(){return new Ks(this,fl)},t.prototype.set=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Hs(this._tree,e);return n.set(Se,r),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Hs(this._tree,e);return n.set(Se,r(n.get(Se))),this},t.prototype.fetch=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Hs(this._tree,e),i=n.get(Se);return i===void 0&&n.set(Se,i=r()),i},t.prototype.values=function(){return new Ks(this,dl)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var r,n,i=new t;try{for(var s=Q(e),o=s.next();!o.done;o=s.next()){var a=me(o.value,2),u=a[0],l=a[1];i.set(u,l)}}catch(f){r={error:f}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),ai=function(t,e,r){var n,i;if(r===void 0&&(r=[]),e.length===0||t==null)return[t,r];try{for(var s=Q(t.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Se&&e.startsWith(a))return r.push([t,a]),ai(t.get(a),e.slice(a.length),r)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return r.push([t,e]),ai(void 0,"",r)},Vs=function(t,e){var r,n;if(e.length===0||t==null)return t;try{for(var i=Q(t.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Se&&e.startsWith(o))return Vs(t.get(o),e.slice(o.length))}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Hs=function(t,e){var r,n,i=e.length;e:for(var s=0;t&&s<i;){try{for(var o=(r=void 0,Q(t.keys())),a=o.next();!a.done;a=o.next()){var u=a.value;if(u!==Se&&e[s]===u[0]){for(var l=Math.min(i-s,u.length),f=1;f<l&&e[s+f]===u[f];)++f;var h=t.get(u);if(f===u.length)t=h;else{var c=new Map;c.set(u.slice(f),h),t.set(e.slice(s,s+f),c),t.delete(u),t=c}s+=f;continue e}}}catch(v){r={error:v}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}var d=new Map;return t.set(e.slice(s),d),d}return t},Jd=function(t,e){var r=me(ai(t,e),2),n=r[0],i=r[1];if(n!==void 0){if(n.delete(Se),n.size===0)hl(i);else if(n.size===1){var s=me(n.entries().next().value,2),o=s[0],a=s[1];ml(i,o,a)}}},hl=function(t){if(t.length!==0){var e=me($s(t),2),r=e[0],n=e[1];if(r.delete(n),r.size===0)hl(t.slice(0,-1));else if(r.size===1){var i=me(r.entries().next().value,2),s=i[0],o=i[1];s!==Se&&ml(t.slice(0,-1),s,o)}}},ml=function(t,e,r){if(t.length!==0){var n=me($s(t),2),i=n[0],s=n[1];i.set(s+e,r),i.delete(s)}},$s=function(t){return t[t.length-1]},hn,Ws="or",gl="and",Xd="and_not",Us=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var r=e.autoVacuum==null||e.autoVacuum===!0?Js:e.autoVacuum;this._options=ae(ae(ae({},Qs),e),{autoVacuum:r,searchOptions:ae(ae({},yl),e.searchOptions||{}),autoSuggestOptions:ae(ae({},np),e.autoSuggestOptions||{})}),this._index=new zs,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Ys,this.addFields(this._options.fields)}return t.prototype.add=function(e){var r,n,i,s,o,a,u=this._options,l=u.extractField,f=u.tokenize,h=u.processTerm,c=u.fields,d=u.idField,v=l(e,d);if(v==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(v))throw new Error("MiniSearch: duplicate ID ".concat(v));var w=this.addDocumentId(v);this.saveStoredFields(w,e);try{for(var x=Q(c),p=x.next();!p.done;p=x.next()){var b=p.value,m=l(e,b);if(m!=null){var g=f(m.toString(),b),_=this._fieldIds[b],y=new Set(g).size;this.addFieldLength(w,_,this._documentCount-1,y);try{for(var j=(i=void 0,Q(g)),C=j.next();!C.done;C=j.next()){var S=C.value,E=h(S,b);if(Array.isArray(E))try{for(var P=(o=void 0,Q(E)),L=P.next();!L.done;L=P.next()){var O=L.value;this.addTerm(_,w,O)}}catch(z){o={error:z}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(o)throw o.error}}else E&&this.addTerm(_,w,E)}}catch(z){i={error:z}}finally{try{C&&!C.done&&(s=j.return)&&s.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{p&&!p.done&&(n=x.return)&&n.call(x)}finally{if(r)throw r.error}}},t.prototype.addAll=function(e){var r,n;try{for(var i=Q(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.addAllAsync=function(e,r){var n=this;r===void 0&&(r={});var i=r.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(f,h,c){var d=f.chunk,v=f.promise;return d.push(h),(c+1)%s==0?{chunk:[],promise:v.then(function(){return new Promise(function(w){return setTimeout(w,0)})}).then(function(){return n.addAll(d)})}:{chunk:d,promise:v}},o),u=a.chunk,l=a.promise;return l.then(function(){return n.addAll(u)})},t.prototype.remove=function(e){var r,n,i,s,o,a,u=this._options,l=u.tokenize,f=u.processTerm,h=u.extractField,c=u.fields,d=u.idField,v=h(e,d);if(v==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var w=this._idToShortId.get(v);if(w==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(v,": it is not in the index"));try{for(var x=Q(c),p=x.next();!p.done;p=x.next()){var b=p.value,m=h(e,b);if(m!=null){var g=l(m.toString(),b),_=this._fieldIds[b],y=new Set(g).size;this.removeFieldLength(w,_,this._documentCount,y);try{for(var j=(i=void 0,Q(g)),C=j.next();!C.done;C=j.next()){var S=C.value,E=f(S,b);if(Array.isArray(E))try{for(var P=(o=void 0,Q(E)),L=P.next();!L.done;L=P.next()){var O=L.value;this.removeTerm(_,w,O)}}catch(z){o={error:z}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(o)throw o.error}}else E&&this.removeTerm(_,w,E)}}catch(z){i={error:z}}finally{try{C&&!C.done&&(s=j.return)&&s.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{p&&!p.done&&(n=x.return)&&n.call(x)}finally{if(r)throw r.error}}this._storedFields.delete(w),this._documentIds.delete(w),this._idToShortId.delete(v),this._fieldLength.delete(w),this._documentCount-=1},t.prototype.removeAll=function(e){var r,n;if(e)try{for(var i=Q(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new zs,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var r=this,n=this._idToShortId.get(e);if(n==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach(function(i,s){r.removeFieldLength(n,s,r._documentCount,i)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,r=e.minDirtFactor,n=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:n,minDirtFactor:r})}},t.prototype.discardAll=function(e){var r,n,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=Q(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var r=this._options,n=r.idField,i=r.extractField,s=i(e,n);this.discard(s),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,r){var n=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&r,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=n._enqueuedVacuumConditions;return n._enqueuedVacuumConditions=Ys,n.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(r)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,r){return Gd(this,void 0,void 0,function(){var n,i,s,o,a,u,l,f,h,c,d,v,w,x,p,b,m,g,_,y,j,C,S,E,P;return Qd(this,function(L){switch(L.label){case 0:if(n=this._dirtCount,!this.vacuumConditionsMet(r))return[3,10];i=e.batchSize||qs.batchSize,s=e.batchWait||qs.batchWait,o=1,L.label=1;case 1:L.trys.push([1,7,8,9]),a=Q(this._index),u=a.next(),L.label=2;case 2:if(u.done)return[3,6];l=me(u.value,2),f=l[0],h=l[1];try{for(c=(C=void 0,Q(h)),d=c.next();!d.done;d=c.next()){v=me(d.value,2),w=v[0],x=v[1];try{for(p=(E=void 0,Q(x)),b=p.next();!b.done;b=p.next())m=me(b.value,1),g=m[0],!this._documentIds.has(g)&&(x.size<=1?h.delete(w):x.delete(g))}catch(O){E={error:O}}finally{try{b&&!b.done&&(P=p.return)&&P.call(p)}finally{if(E)throw E.error}}}}catch(O){C={error:O}}finally{try{d&&!d.done&&(S=c.return)&&S.call(c)}finally{if(C)throw C.error}}return this._index.get(f).size===0&&this._index.delete(f),o%i!=0?[3,4]:[4,new Promise(function(O){return setTimeout(O,s)})];case 3:L.sent(),L.label=4;case 4:o+=1,L.label=5;case 5:return u=a.next(),[3,2];case 6:return[3,9];case 7:return _=L.sent(),y={error:_},[3,9];case 8:try{u&&!u.done&&(j=a.return)&&j.call(a)}finally{if(y)throw y.error}return[7];case 9:this._dirtCount-=n,L.label=10;case 10:return[4,null];case 11:return L.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var r=e.minDirtCount,n=e.minDirtFactor;return r=r||Js.minDirtCount,n=n||Js.minDirtFactor,this.dirtCount>=r&&this.dirtFactor>=n},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.search=function(e,r){var n,i;r===void 0&&(r={});var s=this.executeQuery(e,r),o=[];try{for(var a=Q(s),u=a.next();!u.done;u=a.next()){var l=me(u.value,2),f=l[0],h=l[1],c=h.score,d=h.terms,v=h.match,w=d.length,x={id:this._documentIds.get(f),score:c*w,terms:Object.keys(v),match:v};Object.assign(x,this._storedFields.get(f)),(r.filter==null||r.filter(x))&&o.push(x)}}catch(p){n={error:p}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o.sort(_l),o},t.prototype.autoSuggest=function(e,r){var n,i,s,o;r===void 0&&(r={}),r=ae(ae({},this._options.autoSuggestOptions),r);var a=new Map;try{for(var u=Q(this.search(e,r)),l=u.next();!l.done;l=u.next()){var f=l.value,h=f.score,c=f.terms,d=c.join(" "),v=a.get(d);v!=null?(v.score+=h,v.count+=1):a.set(d,{score:h,terms:c,count:1})}}catch(_){n={error:_}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}var w=[];try{for(var x=Q(a),p=x.next();!p.done;p=x.next()){var b=me(p.value,2),v=b[0],m=b[1],h=m.score,c=m.terms,g=m.count;w.push({suggestion:v,terms:c,score:h/g})}}catch(_){s={error:_}}finally{try{p&&!p.done&&(o=x.return)&&o.call(x)}finally{if(s)throw s.error}}return w.sort(_l),w},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,r){if(r==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),r)},t.getDefault=function(e){if(Qs.hasOwnProperty(e))return Gs(Qs,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,r){var n,i,s,o,a,u,l=e.index,f=e.documentCount,h=e.nextId,c=e.documentIds,d=e.fieldIds,v=e.fieldLength,w=e.averageFieldLength,x=e.storedFields,p=e.dirtCount,b=e.serializationVersion;if(b!==1&&b!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var m=new t(r);m._documentCount=f,m._nextId=h,m._documentIds=li(c),m._idToShortId=new Map,m._fieldIds=d,m._fieldLength=li(v),m._avgFieldLength=w,m._storedFields=li(x),m._dirtCount=p||0,m._index=new zs;try{for(var g=Q(m._documentIds),_=g.next();!_.done;_=g.next()){var y=me(_.value,2),j=y[0],C=y[1];m._idToShortId.set(C,j)}}catch(F){n={error:F}}finally{try{_&&!_.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}try{for(var S=Q(l),E=S.next();!E.done;E=S.next()){var P=me(E.value,2),L=P[0],O=P[1],z=new Map;try{for(var J=(a=void 0,Q(Object.keys(O))),q=J.next();!q.done;q=J.next()){var Z=q.value,A=O[Z];b===1&&(A=A.ds),z.set(parseInt(Z,10),li(A))}}catch(F){a={error:F}}finally{try{q&&!q.done&&(u=J.return)&&u.call(J)}finally{if(a)throw a.error}}m._index.set(L,z)}}catch(F){s={error:F}}finally{try{E&&!E.done&&(o=S.return)&&o.call(S)}finally{if(s)throw s.error}}return m},t.prototype.executeQuery=function(e,r){var n=this;if(r===void 0&&(r={}),typeof e!="string"){var i=ae(ae(ae({},r),e),{queries:void 0}),s=e.queries.map(function(x){return n.executeQuery(x,i)});return this.combineResults(s,e.combineWith)}var o=this._options,a=o.tokenize,u=o.processTerm,l=o.searchOptions,f=ae(ae({tokenize:a,processTerm:u},l),r),h=f.tokenize,c=f.processTerm,d=h(e).flatMap(function(x){return c(x)}).filter(function(x){return!!x}),v=d.map(rp(f)),w=v.map(function(x){return n.executeQuerySpec(x,f)});return this.combineResults(w,f.combineWith)},t.prototype.executeQuerySpec=function(e,r){var n,i,s,o,a=ae(ae({},this._options.searchOptions),r),u=(a.fields||this._options.fields).reduce(function(Z,A){var F;return ae(ae({},Z),(F={},F[A]=Gs(Z,A)||1,F))},a.boost||{}),l=a.boostDocument,f=a.weights,h=a.maxFuzzy,c=a.bm25,d=ae(ae({},yl.weights),f),v=d.fuzzy,w=d.prefix,x=this._index.get(e.term),p=this.termResults(e.term,e.term,1,x,u,l,c),b,m;if(e.prefix&&(b=this._index.atPrefix(e.term)),e.fuzzy){var g=e.fuzzy===!0?.2:e.fuzzy,_=g<1?Math.min(h,Math.round(e.term.length*g)):g;_&&(m=this._index.fuzzyGet(e.term,_))}if(b)try{for(var y=Q(b),j=y.next();!j.done;j=y.next()){var C=me(j.value,2),S=C[0],E=C[1],P=S.length-e.term.length;if(!!P){m==null||m.delete(S);var L=w*S.length/(S.length+.3*P);this.termResults(e.term,S,L,E,u,l,c,p)}}}catch(Z){n={error:Z}}finally{try{j&&!j.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}if(m)try{for(var O=Q(m.keys()),z=O.next();!z.done;z=O.next()){var S=z.value,J=me(m.get(S),2),q=J[0],P=J[1];if(!!P){var L=v*S.length/(S.length+P);this.termResults(e.term,S,L,q,u,l,c,p)}}}catch(Z){s={error:Z}}finally{try{z&&!z.done&&(o=O.return)&&o.call(O)}finally{if(s)throw s.error}}return p},t.prototype.combineResults=function(e,r){if(r===void 0&&(r=Ws),e.length===0)return new Map;var n=r.toLowerCase();return e.reduce(Zd[n])||new Map},t.prototype.toJSON=function(){var e,r,n,i,s=[];try{for(var o=Q(this._index),a=o.next();!a.done;a=o.next()){var u=me(a.value,2),l=u[0],f=u[1],h={};try{for(var c=(n=void 0,Q(f)),d=c.next();!d.done;d=c.next()){var v=me(d.value,2),w=v[0],x=v[1];h[w]=Object.fromEntries(x)}}catch(p){n={error:p}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}s.push([l,h])}}catch(p){e={error:p}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},t.prototype.termResults=function(e,r,n,i,s,o,a,u){var l,f,h,c,d;if(u===void 0&&(u=new Map),i==null)return u;try{for(var v=Q(Object.keys(s)),w=v.next();!w.done;w=v.next()){var x=w.value,p=s[x],b=this._fieldIds[x],m=i.get(b);if(m!=null){var g=m.size,_=this._avgFieldLength[b];try{for(var y=(h=void 0,Q(m.keys())),j=y.next();!j.done;j=y.next()){var C=j.value;if(!this._documentIds.has(C)){this.removeTerm(b,C,r),g-=1;continue}var S=o?o(this._documentIds.get(C),r):1;if(!!S){var E=m.get(C),P=this._fieldLength.get(C)[b],L=tp(E,g,this._documentCount,P,_,a),O=n*p*S*L,z=u.get(C);if(z){z.score+=O,ip(z.terms,e);var J=Gs(z.match,r);J?J.push(x):z.match[r]=[x]}else u.set(C,{score:O,terms:[e],match:(d={},d[r]=[x],d)})}}}catch(q){h={error:q}}finally{try{j&&!j.done&&(c=y.return)&&c.call(y)}finally{if(h)throw h.error}}}}}catch(q){l={error:q}}finally{try{w&&!w.done&&(f=v.return)&&f.call(v)}finally{if(l)throw l.error}}return u},t.prototype.addTerm=function(e,r,n){var i=this._index.fetch(n,bl),s=i.get(e);if(s==null)s=new Map,s.set(r,1),i.set(e,s);else{var o=s.get(r);s.set(r,(o||0)+1)}},t.prototype.removeTerm=function(e,r,n){if(!this._index.has(n)){this.warnDocumentChanged(r,e,n);return}var i=this._index.fetch(n,bl),s=i.get(e);s==null||s.get(r)==null?this.warnDocumentChanged(r,e,n):s.get(r)<=1?s.size<=1?i.delete(e):s.delete(r):s.set(r,s.get(r)-1),this._index.get(n).size===0&&this._index.delete(n)},t.prototype.warnDocumentChanged=function(e,r,n){var i,s;try{for(var o=Q(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var u=a.value;if(this._fieldIds[u]===r){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(n,'" was not present in field "').concat(u,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var r=this._nextId;return this._idToShortId.set(e,r),this._documentIds.set(r,e),this._documentCount+=1,this._nextId+=1,r},t.prototype.addFields=function(e){for(var r=0;r<e.length;r++)this._fieldIds[e[r]]=r},t.prototype.addFieldLength=function(e,r,n,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[r]=i;var o=this._avgFieldLength[r]||0,a=o*n+i;this._avgFieldLength[r]=a/(n+1)},t.prototype.removeFieldLength=function(e,r,n,i){if(n===1){this._avgFieldLength[r]=0;return}var s=this._avgFieldLength[r]*n-i;this._avgFieldLength[r]=s/(n-1)},t.prototype.saveStoredFields=function(e,r){var n,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var u=this._storedFields.get(e);u==null&&this._storedFields.set(e,u={});try{for(var l=Q(o),f=l.next();!f.done;f=l.next()){var h=f.value,c=a(r,h);c!==void 0&&(u[h]=c)}}catch(d){n={error:d}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}}},t}(),Gs=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},Zd=(hn={},hn[Ws]=function(t,e){var r,n;try{for(var i=Q(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=t.get(o);if(a==null)t.set(o,e.get(o));else{var u=e.get(o),l=u.score,f=u.terms,h=u.match;a.score=a.score+l,a.match=Object.assign(a.match,h),vl(a.terms,f)}}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},hn[gl]=function(t,e){var r,n,i=new Map;try{for(var s=Q(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,u=t.get(a);if(u!=null){var l=e.get(a),f=l.score,h=l.terms,c=l.match;vl(u.terms,h),i.set(a,{score:u.score+f,terms:u.terms,match:Object.assign(u.match,c)})}}}catch(d){r={error:d}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},hn[Xd]=function(t,e){var r,n;try{for(var i=Q(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;t.delete(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},hn),ep={k:1.2,b:.7,d:.5},tp=function(t,e,r,n,i,s){var o=s.k,a=s.b,u=s.d,l=Math.log(1+(r-e+.5)/(e+.5));return l*(u+t*(o+1)/(t+o*(1-a+a*n/i)))},rp=function(t){return function(e,r,n){var i=typeof t.fuzzy=="function"?t.fuzzy(e,r,n):t.fuzzy||!1,s=typeof t.prefix=="function"?t.prefix(e,r,n):t.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},Qs={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t,e){return t.split(sp)},processTerm:function(t,e){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e,r){return console!=null&&console.warn!=null&&console[t](e)},autoVacuum:!0},yl={combineWith:Ws,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:ep},np={combineWith:gl,prefix:function(t,e,r){return e===r.length-1}},qs={batchSize:1e3,batchWait:10},Ys={minDirtFactor:.1,minDirtCount:20},Js=ae(ae({},qs),Ys),ip=function(t,e){t.includes(e)||t.push(e)},vl=function(t,e){var r,n;try{for(var i=Q(e),s=i.next();!s.done;s=i.next()){var o=s.value;t.includes(o)||t.push(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},_l=function(t,e){var r=t.score,n=e.score;return n-r},bl=function(){return new Map},li=function(t){var e,r,n=new Map;try{for(var i=Q(Object.keys(t)),s=i.next();!s.done;s=i.next()){var o=s.value;n.set(parseInt(o,10),t[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},sp=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var jc=Fe(require("obsidian"));var op=typeof global=="object"&&global&&global.Object===Object&&global,ui=op;var ap=typeof self=="object"&&self&&self.Object===Object&&self,lp=ui||ap||Function("return this")(),je=lp;var up=je.Symbol,Re=up;var xl=Object.prototype,cp=xl.hasOwnProperty,fp=xl.toString,mn=Re?Re.toStringTag:void 0;function dp(t){var e=cp.call(t,mn),r=t[mn];try{t[mn]=void 0;var n=!0}catch{}var i=fp.call(t);return n&&(e?t[mn]=r:delete t[mn]),i}var wl=dp;var pp=Object.prototype,hp=pp.toString;function mp(t){return hp.call(t)}var jl=mp;var gp="[object Null]",yp="[object Undefined]",Cl=Re?Re.toStringTag:void 0;function vp(t){return t==null?t===void 0?yp:gp:Cl&&Cl in Object(t)?wl(t):jl(t)}var Ye=vp;function _p(t){return t!=null&&typeof t=="object"}var Je=_p;var bp="[object Symbol]";function xp(t){return typeof t=="symbol"||Je(t)&&Ye(t)==bp}var dt=xp;function wp(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var jr=wp;var jp=Array.isArray,pe=jp;var Cp=1/0,Al=Re?Re.prototype:void 0,Sl=Al?Al.toString:void 0;function Fl(t){if(typeof t=="string")return t;if(pe(t))return jr(t,Fl)+"";if(dt(t))return Sl?Sl.call(t):"";var e=t+"";return e=="0"&&1/t==-Cp?"-0":e}var El=Fl;function Ap(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Et=Ap;function Sp(t){return t}var Dt=Sp;var Fp="[object AsyncFunction]",Ep="[object Function]",Dp="[object GeneratorFunction]",Tp="[object Proxy]";function Ip(t){if(!Et(t))return!1;var e=Ye(t);return e==Ep||e==Dp||e==Fp||e==Tp}var ci=Ip;var kp=je["__core-js_shared__"],fi=kp;var Dl=function(){var t=/[^.]+$/.exec(fi&&fi.keys&&fi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Op(t){return!!Dl&&Dl in t}var Tl=Op;var Pp=Function.prototype,Mp=Pp.toString;function Rp(t){if(t!=null){try{return Mp.call(t)}catch{}try{return t+""}catch{}}return""}var pt=Rp;var Lp=/[\\^$.*+?()[\]{}|]/g,Bp=/^\[object .+?Constructor\]$/,Np=Function.prototype,Kp=Object.prototype,zp=Np.toString,Vp=Kp.hasOwnProperty,Hp=RegExp("^"+zp.call(Vp).replace(Lp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $p(t){if(!Et(t)||Tl(t))return!1;var e=ci(t)?Hp:Bp;return e.test(pt(t))}var Il=$p;function Wp(t,e){return t==null?void 0:t[e]}var kl=Wp;function Up(t,e){var r=kl(t,e);return Il(r)?r:void 0}var Ke=Up;var Gp=Ke(je,"WeakMap"),di=Gp;function Qp(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Ol=Qp;var qp=800,Yp=16,Jp=Date.now;function Xp(t){var e=0,r=0;return function(){var n=Jp(),i=Yp-(n-r);if(r=n,i>0){if(++e>=qp)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Pl=Xp;function Zp(t){return function(){return t}}var Ml=Zp;var eh=function(){try{var t=Ke(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Xs=eh;var th=Xs?function(t,e){return Xs(t,"toString",{configurable:!0,enumerable:!1,value:Ml(e),writable:!0})}:Dt,Rl=th;var rh=Pl(Rl),Ll=rh;var nh=9007199254740991,ih=/^(?:0|[1-9]\d*)$/;function sh(t,e){var r=typeof t;return e=e??nh,!!e&&(r=="number"||r!="symbol"&&ih.test(t))&&t>-1&&t%1==0&&t<e}var Cr=sh;function oh(t,e){return t===e||t!==t&&e!==e}var Ar=oh;var Bl=Math.max;function ah(t,e,r){return e=Bl(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=Bl(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ol(t,this,a)}}var Nl=ah;function lh(t,e){return Ll(Nl(t,e,Dt),t+"")}var Kl=lh;var uh=9007199254740991;function ch(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uh}var Sr=ch;function fh(t){return t!=null&&Sr(t.length)&&!ci(t)}var Tt=fh;function dh(t,e,r){if(!Et(r))return!1;var n=typeof e;return(n=="number"?Tt(r)&&Cr(e,r.length):n=="string"&&e in r)?Ar(r[e],t):!1}var Zs=dh;var ph=Object.prototype;function hh(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ph;return t===r}var zl=hh;function mh(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Vl=mh;var gh="[object Arguments]";function yh(t){return Je(t)&&Ye(t)==gh}var eo=yh;var Hl=Object.prototype,vh=Hl.hasOwnProperty,_h=Hl.propertyIsEnumerable,bh=eo(function(){return arguments}())?eo:function(t){return Je(t)&&vh.call(t,"callee")&&!_h.call(t,"callee")},Fr=bh;function xh(){return!1}var $l=xh;var Wl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ul=Wl&&typeof module=="object"&&module&&!module.nodeType&&module,wh=Ul&&Ul.exports===Wl,Gl=wh?je.Buffer:void 0,jh=Gl?Gl.isBuffer:void 0,Ch=jh||$l,gn=Ch;var Ah="[object Arguments]",Sh="[object Array]",Fh="[object Boolean]",Eh="[object Date]",Dh="[object Error]",Th="[object Function]",Ih="[object Map]",kh="[object Number]",Oh="[object Object]",Ph="[object RegExp]",Mh="[object Set]",Rh="[object String]",Lh="[object WeakMap]",Bh="[object ArrayBuffer]",Nh="[object DataView]",Kh="[object Float32Array]",zh="[object Float64Array]",Vh="[object Int8Array]",Hh="[object Int16Array]",$h="[object Int32Array]",Wh="[object Uint8Array]",Uh="[object Uint8ClampedArray]",Gh="[object Uint16Array]",Qh="[object Uint32Array]",se={};se[Kh]=se[zh]=se[Vh]=se[Hh]=se[$h]=se[Wh]=se[Uh]=se[Gh]=se[Qh]=!0;se[Ah]=se[Sh]=se[Bh]=se[Fh]=se[Nh]=se[Eh]=se[Dh]=se[Th]=se[Ih]=se[kh]=se[Oh]=se[Ph]=se[Mh]=se[Rh]=se[Lh]=!1;function qh(t){return Je(t)&&Sr(t.length)&&!!se[Ye(t)]}var Ql=qh;function Yh(t){return function(e){return t(e)}}var pi=Yh;var ql=typeof exports=="object"&&exports&&!exports.nodeType&&exports,yn=ql&&typeof module=="object"&&module&&!module.nodeType&&module,Jh=yn&&yn.exports===ql,to=Jh&&ui.process,Xh=function(){try{var t=yn&&yn.require&&yn.require("util").types;return t||to&&to.binding&&to.binding("util")}catch{}}(),ro=Xh;var Yl=ro&&ro.isTypedArray,Zh=Yl?pi(Yl):Ql,hi=Zh;var em=Object.prototype,tm=em.hasOwnProperty;function rm(t,e){var r=pe(t),n=!r&&Fr(t),i=!r&&!n&&gn(t),s=!r&&!n&&!i&&hi(t),o=r||n||i||s,a=o?Vl(t.length,String):[],u=a.length;for(var l in t)(e||tm.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Cr(l,u)))&&a.push(l);return a}var Jl=rm;function nm(t,e){return function(r){return t(e(r))}}var Xl=nm;var im=Xl(Object.keys,Object),Zl=im;var sm=Object.prototype,om=sm.hasOwnProperty;function am(t){if(!zl(t))return Zl(t);var e=[];for(var r in Object(t))om.call(t,r)&&r!="constructor"&&e.push(r);return e}var eu=am;function lm(t){return Tt(t)?Jl(t):eu(t)}var Er=lm;var um=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cm=/^\w*$/;function fm(t,e){if(pe(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||dt(t)?!0:cm.test(t)||!um.test(t)||e!=null&&t in Object(e)}var Dr=fm;var dm=Ke(Object,"create"),ht=dm;function pm(){this.__data__=ht?ht(null):{},this.size=0}var tu=pm;function hm(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ru=hm;var mm="__lodash_hash_undefined__",gm=Object.prototype,ym=gm.hasOwnProperty;function vm(t){var e=this.__data__;if(ht){var r=e[t];return r===mm?void 0:r}return ym.call(e,t)?e[t]:void 0}var nu=vm;var _m=Object.prototype,bm=_m.hasOwnProperty;function xm(t){var e=this.__data__;return ht?e[t]!==void 0:bm.call(e,t)}var iu=xm;var wm="__lodash_hash_undefined__";function jm(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ht&&e===void 0?wm:e,this}var su=jm;function Tr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Tr.prototype.clear=tu;Tr.prototype.delete=ru;Tr.prototype.get=nu;Tr.prototype.has=iu;Tr.prototype.set=su;var no=Tr;function Cm(){this.__data__=[],this.size=0}var ou=Cm;function Am(t,e){for(var r=t.length;r--;)if(Ar(t[r][0],e))return r;return-1}var It=Am;var Sm=Array.prototype,Fm=Sm.splice;function Em(t){var e=this.__data__,r=It(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Fm.call(e,r,1),--this.size,!0}var au=Em;function Dm(t){var e=this.__data__,r=It(e,t);return r<0?void 0:e[r][1]}var lu=Dm;function Tm(t){return It(this.__data__,t)>-1}var uu=Tm;function Im(t,e){var r=this.__data__,n=It(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var cu=Im;function Ir(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ir.prototype.clear=ou;Ir.prototype.delete=au;Ir.prototype.get=lu;Ir.prototype.has=uu;Ir.prototype.set=cu;var kt=Ir;var km=Ke(je,"Map"),Ot=km;function Om(){this.size=0,this.__data__={hash:new no,map:new(Ot||kt),string:new no}}var fu=Om;function Pm(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var du=Pm;function Mm(t,e){var r=t.__data__;return du(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Pt=Mm;function Rm(t){var e=Pt(this,t).delete(t);return this.size-=e?1:0,e}var pu=Rm;function Lm(t){return Pt(this,t).get(t)}var hu=Lm;function Bm(t){return Pt(this,t).has(t)}var mu=Bm;function Nm(t,e){var r=Pt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var gu=Nm;function kr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}kr.prototype.clear=fu;kr.prototype.delete=pu;kr.prototype.get=hu;kr.prototype.has=mu;kr.prototype.set=gu;var Xt=kr;var Km="Expected a function";function io(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Km);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(io.Cache||Xt),r}io.Cache=Xt;var yu=io;var zm=500;function Vm(t){var e=yu(t,function(n){return r.size===zm&&r.clear(),n}),r=e.cache;return e}var vu=Vm;var Hm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$m=/\\(\\)?/g,Wm=vu(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Hm,function(r,n,i,s){e.push(i?s.replace($m,"$1"):n||r)}),e}),_u=Wm;function Um(t){return t==null?"":El(t)}var bu=Um;function Gm(t,e){return pe(t)?t:Dr(t,e)?[t]:_u(bu(t))}var mi=Gm;var Qm=1/0;function qm(t){if(typeof t=="string"||dt(t))return t;var e=t+"";return e=="0"&&1/t==-Qm?"-0":e}var Mt=qm;function Ym(t,e){e=mi(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Mt(e[r++])];return r&&r==n?t:void 0}var Or=Ym;function Jm(t,e,r){var n=t==null?void 0:Or(t,e);return n===void 0?r:n}var xu=Jm;function Xm(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var gi=Xm;var wu=Re?Re.isConcatSpreadable:void 0;function Zm(t){return pe(t)||Fr(t)||!!(wu&&t&&t[wu])}var ju=Zm;function Cu(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=ju),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?Cu(a,e-1,r,n,i):gi(i,a):n||(i[i.length]=a)}return i}var Au=Cu;function eg(){this.__data__=new kt,this.size=0}var Su=eg;function tg(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Fu=tg;function rg(t){return this.__data__.get(t)}var Eu=rg;function ng(t){return this.__data__.has(t)}var Du=ng;var ig=200;function sg(t,e){var r=this.__data__;if(r instanceof kt){var n=r.__data__;if(!Ot||n.length<ig-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Xt(n)}return r.set(t,e),this.size=r.size,this}var Tu=sg;function Pr(t){var e=this.__data__=new kt(t);this.size=e.size}Pr.prototype.clear=Su;Pr.prototype.delete=Fu;Pr.prototype.get=Eu;Pr.prototype.has=Du;Pr.prototype.set=Tu;var Mr=Pr;function og(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}var Iu=og;function ag(){return[]}var ku=ag;var lg=Object.prototype,ug=lg.propertyIsEnumerable,Ou=Object.getOwnPropertySymbols,cg=Ou?function(t){return t==null?[]:(t=Object(t),Iu(Ou(t),function(e){return ug.call(t,e)}))}:ku,Pu=cg;function fg(t,e,r){var n=e(t);return pe(t)?n:gi(n,r(t))}var Mu=fg;function dg(t){return Mu(t,Er,Pu)}var so=dg;var pg=Ke(je,"DataView"),yi=pg;var hg=Ke(je,"Promise"),vi=hg;var mg=Ke(je,"Set"),_i=mg;var Ru="[object Map]",gg="[object Object]",Lu="[object Promise]",Bu="[object Set]",Nu="[object WeakMap]",Ku="[object DataView]",yg=pt(yi),vg=pt(Ot),_g=pt(vi),bg=pt(_i),xg=pt(di),Zt=Ye;(yi&&Zt(new yi(new ArrayBuffer(1)))!=Ku||Ot&&Zt(new Ot)!=Ru||vi&&Zt(vi.resolve())!=Lu||_i&&Zt(new _i)!=Bu||di&&Zt(new di)!=Nu)&&(Zt=function(t){var e=Ye(t),r=e==gg?t.constructor:void 0,n=r?pt(r):"";if(n)switch(n){case yg:return Ku;case vg:return Ru;case _g:return Lu;case bg:return Bu;case xg:return Nu}return e});var oo=Zt;var wg=je.Uint8Array,ao=wg;var jg="__lodash_hash_undefined__";function Cg(t){return this.__data__.set(t,jg),this}var zu=Cg;function Ag(t){return this.__data__.has(t)}var Vu=Ag;function bi(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Xt;++e<r;)this.add(t[e])}bi.prototype.add=bi.prototype.push=zu;bi.prototype.has=Vu;var Hu=bi;function Sg(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var $u=Sg;function Fg(t,e){return t.has(e)}var Wu=Fg;var Eg=1,Dg=2;function Tg(t,e,r,n,i,s){var o=r&Eg,a=t.length,u=e.length;if(a!=u&&!(o&&u>a))return!1;var l=s.get(t),f=s.get(e);if(l&&f)return l==e&&f==t;var h=-1,c=!0,d=r&Dg?new Hu:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var v=t[h],w=e[h];if(n)var x=o?n(w,v,h,e,t,s):n(v,w,h,t,e,s);if(x!==void 0){if(x)continue;c=!1;break}if(d){if(!$u(e,function(p,b){if(!Wu(d,b)&&(v===p||i(v,p,r,n,s)))return d.push(b)})){c=!1;break}}else if(!(v===w||i(v,w,r,n,s))){c=!1;break}}return s.delete(t),s.delete(e),c}var xi=Tg;function Ig(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var Uu=Ig;function kg(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Gu=kg;var Og=1,Pg=2,Mg="[object Boolean]",Rg="[object Date]",Lg="[object Error]",Bg="[object Map]",Ng="[object Number]",Kg="[object RegExp]",zg="[object Set]",Vg="[object String]",Hg="[object Symbol]",$g="[object ArrayBuffer]",Wg="[object DataView]",Qu=Re?Re.prototype:void 0,lo=Qu?Qu.valueOf:void 0;function Ug(t,e,r,n,i,s,o){switch(r){case Wg:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $g:return!(t.byteLength!=e.byteLength||!s(new ao(t),new ao(e)));case Mg:case Rg:case Ng:return Ar(+t,+e);case Lg:return t.name==e.name&&t.message==e.message;case Kg:case Vg:return t==e+"";case Bg:var a=Uu;case zg:var u=n&Og;if(a||(a=Gu),t.size!=e.size&&!u)return!1;var l=o.get(t);if(l)return l==e;n|=Pg,o.set(t,e);var f=xi(a(t),a(e),n,i,s,o);return o.delete(t),f;case Hg:if(lo)return lo.call(t)==lo.call(e)}return!1}var qu=Ug;var Gg=1,Qg=Object.prototype,qg=Qg.hasOwnProperty;function Yg(t,e,r,n,i,s){var o=r&Gg,a=so(t),u=a.length,l=so(e),f=l.length;if(u!=f&&!o)return!1;for(var h=u;h--;){var c=a[h];if(!(o?c in e:qg.call(e,c)))return!1}var d=s.get(t),v=s.get(e);if(d&&v)return d==e&&v==t;var w=!0;s.set(t,e),s.set(e,t);for(var x=o;++h<u;){c=a[h];var p=t[c],b=e[c];if(n)var m=o?n(b,p,c,e,t,s):n(p,b,c,t,e,s);if(!(m===void 0?p===b||i(p,b,r,n,s):m)){w=!1;break}x||(x=c=="constructor")}if(w&&!x){var g=t.constructor,_=e.constructor;g!=_&&"constructor"in t&&"constructor"in e&&!(typeof g=="function"&&g instanceof g&&typeof _=="function"&&_ instanceof _)&&(w=!1)}return s.delete(t),s.delete(e),w}var Yu=Yg;var Jg=1,Ju="[object Arguments]",Xu="[object Array]",wi="[object Object]",Xg=Object.prototype,Zu=Xg.hasOwnProperty;function Zg(t,e,r,n,i,s){var o=pe(t),a=pe(e),u=o?Xu:oo(t),l=a?Xu:oo(e);u=u==Ju?wi:u,l=l==Ju?wi:l;var f=u==wi,h=l==wi,c=u==l;if(c&&gn(t)){if(!gn(e))return!1;o=!0,f=!1}if(c&&!f)return s||(s=new Mr),o||hi(t)?xi(t,e,r,n,i,s):qu(t,e,u,r,n,i,s);if(!(r&Jg)){var d=f&&Zu.call(t,"__wrapped__"),v=h&&Zu.call(e,"__wrapped__");if(d||v){var w=d?t.value():t,x=v?e.value():e;return s||(s=new Mr),i(w,x,r,n,s)}}return c?(s||(s=new Mr),Yu(t,e,r,n,i,s)):!1}var ec=Zg;function tc(t,e,r,n,i){return t===e?!0:t==null||e==null||!Je(t)&&!Je(e)?t!==t&&e!==e:ec(t,e,r,n,tc,i)}var ji=tc;var ey=1,ty=2;function ry(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var u=a[0],l=t[u],f=a[1];if(o&&a[2]){if(l===void 0&&!(u in t))return!1}else{var h=new Mr;if(n)var c=n(l,f,u,t,e,h);if(!(c===void 0?ji(f,l,ey|ty,n,h):c))return!1}}return!0}var rc=ry;function ny(t){return t===t&&!Et(t)}var Ci=ny;function iy(t){for(var e=Er(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,Ci(i)]}return e}var nc=iy;function sy(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var Ai=sy;function oy(t){var e=nc(t);return e.length==1&&e[0][2]?Ai(e[0][0],e[0][1]):function(r){return r===t||rc(r,t,e)}}var ic=oy;function ay(t,e){return t!=null&&e in Object(t)}var sc=ay;function ly(t,e,r){e=mi(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=Mt(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&Sr(i)&&Cr(o,i)&&(pe(t)||Fr(t)))}var oc=ly;function uy(t,e){return t!=null&&oc(t,e,sc)}var ac=uy;var cy=1,fy=2;function dy(t,e){return Dr(t)&&Ci(e)?Ai(Mt(t),e):function(r){var n=xu(r,t);return n===void 0&&n===e?ac(r,t):ji(e,n,cy|fy)}}var lc=dy;function py(t){return function(e){return e==null?void 0:e[t]}}var uc=py;function hy(t){return function(e){return Or(e,t)}}var cc=hy;function my(t){return Dr(t)?uc(Mt(t)):cc(t)}var fc=my;function gy(t){return typeof t=="function"?t:t==null?Dt:typeof t=="object"?pe(t)?lc(t[0],t[1]):ic(t):fc(t)}var dc=gy;function yy(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var u=o[t?a:++i];if(r(s[u],u,s)===!1)break}return e}}var pc=yy;var vy=pc(),hc=vy;function _y(t,e){return t&&hc(t,e,Er)}var mc=_y;function by(t,e){return function(r,n){if(r==null)return r;if(!Tt(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}var gc=by;var xy=gc(mc),yc=xy;function wy(t,e){var r=-1,n=Tt(t)?Array(t.length):[];return yc(t,function(i,s,o){n[++r]=e(i,s,o)}),n}var vc=wy;function jy(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}var _c=jy;function Cy(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,s=dt(t),o=e!==void 0,a=e===null,u=e===e,l=dt(e);if(!a&&!l&&!s&&t>e||s&&o&&u&&!a&&!l||n&&o&&u||!r&&u||!i)return 1;if(!n&&!s&&!l&&t<e||l&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!u)return-1}return 0}var bc=Cy;function Ay(t,e,r){for(var n=-1,i=t.criteria,s=e.criteria,o=i.length,a=r.length;++n<o;){var u=bc(i[n],s[n]);if(u){if(n>=a)return u;var l=r[n];return u*(l=="desc"?-1:1)}}return t.index-e.index}var xc=Ay;function Sy(t,e,r){e.length?e=jr(e,function(s){return pe(s)?function(o){return Or(o,s.length===1?s[0]:s)}:s}):e=[Dt];var n=-1;e=jr(e,pi(dc));var i=vc(t,function(s,o,a){var u=jr(e,function(l){return l(s)});return{criteria:u,index:++n,value:s}});return _c(i,function(s,o){return xc(s,o,r)})}var wc=Sy;var Fy=Kl(function(t,e){if(t==null)return[];var r=e.length;return r>1&&Zs(t,e[0],e[1])?e=[]:r>2&&Zs(e[0],e[1],e[2])&&(e=[e[0]]),wc(t,Au(e,1),[])}),uo=Fy;var Ey=t=>{let e=t.split(At),r=Jn();return r?e=e.flatMap(n=>Ea.test(n)?r.cut(n):[n]):(e=[...e,...e.flatMap(za)],e=[...e,...e.flatMap(Va)]),e},Si=class{constructor(){this.indexedDocuments=new Map;this.minisearch=new Us(Si.options)}async loadCache(){let e=await we.getMinisearchCache();return e?(this.minisearch=Us.loadJS(e.data,Si.options),this.indexedDocuments=new Map(e.paths.map(r=>[r.path,r.mtime])),!0):(console.log("Omnisearch - No cache found"),!1)}getDiff(e){let r=new Map(e.map(s=>[s.path,s.mtime])),n=e.filter(s=>!this.indexedDocuments.has(s.path)||this.indexedDocuments.get(s.path)!==s.mtime),i=[...this.indexedDocuments].filter(([s,o])=>!r.has(s)||r.get(s)!==o).map(s=>({path:s[0],mtime:s[1]}));return{toAdd:n,toRemove:i}}async addFromPaths(e){de("Adding files",e);let r=(await Promise.all(e.map(async i=>await we.getDocument(i)))).filter(i=>!!i?.path);de("Sorting documents to first index markdown"),r=uo(r,i=>i.path.endsWith(".md")?0:1),this.removeFromPaths(r.filter(i=>this.indexedDocuments.has(i.path)).map(i=>i.path));let n=Ka(r,500);for(let i of n){de("Indexing into search engine",i),i.forEach(o=>this.indexedDocuments.set(o.path,o.mtime));let s=i.filter(o=>this.minisearch.has(o.path));this.removeFromPaths(s.map(o=>o.path)),await this.minisearch.addAllAsync(i)}}removeFromPaths(e){e.forEach(n=>this.indexedDocuments.delete(n));let r=e.filter(n=>this.minisearch.has(n));this.minisearch.discardAll(r)}async search(e,r){if(e.isEmpty())return[];de("Starting search for",e);let n;switch(D.fuzziness){case"0":n=0;break;case"1":n=.1;break;default:n=.2;break}let i=this.minisearch.search(e.segmentsToStr(),{prefix:l=>l.length>=r.prefixLength,fuzzy:l=>l.length<=3?0:l.length<=5?n/2:n,combineWith:"AND",boost:{basename:D.weightBasename,directory:D.weightDirectory,aliases:D.weightBasename,headings1:D.weightH1,headings2:D.weightH2,headings3:D.weightH3,unmarkedTags:D.weightUnmarkedTags}});if(de("Found",i.length,"results"),e.query.ext?.length&&(i=i.filter(l=>{let f="."+l.id.split(".").pop();return e.query.ext?.some(h=>f.startsWith(h.startsWith(".")?h:"."+h))})),e.query.path&&(i=i.filter(l=>e.query.path?.some(f=>l.id.toLowerCase().includes(f.toLowerCase())))),e.query.exclude.path&&(i=i.filter(l=>!e.query.exclude.path?.some(f=>l.id.toLowerCase().includes(f.toLowerCase())))),!i.length)return[];if(r.singleFilePath)return i.filter(l=>l.id===r.singleFilePath);D.hideExcluded?i=i.filter(l=>!(app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id))):i.forEach(l=>{app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id)&&(l.score/=10)});let s=e.getTags();for(let l of s)for(let f of i)(f.tags??[]).includes(l)&&(f.score*=100);de("Sorting and limiting results"),i=i.sort((l,f)=>f.score-l.score).slice(0,50);let o=await Promise.all(i.map(async l=>await we.getDocument(l.id))),a=e.getExactTerms();a.length&&(de("Filtering with quoted terms"),i=i.filter(l=>{let f=o.find(d=>d.path===l.id),h=f?.path.toLowerCase()??"",c=Rs(f?.content??"").toLowerCase();return a.every(d=>c.includes(d)||h.includes(d))}));let u=e.query.exclude.text;return u.length&&(de("Filtering with exclusions"),i=i.filter(l=>{let f=Rs(o.find(h=>h.path===l.id)?.content??"").toLowerCase();return u.every(h=>!f.includes(h))})),de("Deduping"),i=i.filter((l,f,h)=>h.findIndex(c=>c.id===l.id)===f),i}getMatches(e,r,n){let i=new Date().getTime(),s=null,o=[],a=0;for(;(s=r.exec(e))!==null;){if(++a>=100||new Date().getTime()-i>50){Ha("Stopped getMatches at",a,"results");break}let l=s[0];l&&o.push({match:l,offset:s.index})}let u=e.toLowerCase().indexOf(n.segmentsToStr());return u>-1&&o.unshift({offset:u,match:n.segmentsToStr()}),o}async getSuggestions(e,r){let n;D.simpleSearch?n=await this.search(e,{prefixLength:3,singleFilePath:r?.singleFilePath}):n=await this.search(e,{prefixLength:1,singleFilePath:r?.singleFilePath});let i=await Promise.all(n.map(async o=>await we.getDocument(o.id)));return n.map(o=>{de("Locating matches for",o.id);let a=i.find(h=>h.path===o.id);a||(console.warn(`Omnisearch - Note "${o.id}" not in the live cache`),a={content:"",basename:o.id,path:o.id});let u=[...Object.keys(o.match),...e.getExactTerms(),...e.getTags()].filter(h=>h.length>1||/\p{Emoji}/u.test(h));de("Matching tokens:",u),de("Getting matches locations...");let l=this.getMatches(a.content,Ft(u),e);return de("Matches:",l),ce({score:o.score,foundWords:u,matches:l},a)})}async writeToCache(){await we.writeMinisearchCache(this.minisearch,this.indexedDocuments)}},co=Si;co.options={tokenize:Ey,extractField:(e,r)=>{if(r==="directory"){let n=e.path.split("/");return n.pop(),n.join("/")}return e[r]},processTerm:e=>(D.ignoreDiacritics?ft(e):e).toLowerCase(),idField:"path",fields:["basename","directory","aliases","content","headings1","headings2","headings3"],storeFields:["tags"],logger(e,r,n){n==="version_conflict"&&new jc.Notice("Omnisearch - Your index cache may be incorrect or corrupted. If this message keeps appearing, go to Settings to clear the cache.",5e3)}};var ve=new co;var fo=new Set;function Cc(t){fo.add(t)}async function Fi(){let t=[...fo].map(e=>e.path);t.length&&(ve.removeFromPaths(t),ve.addFromPaths(t),fo.clear())}var Sc=Fe(Ac());function Fc(t,e,r){let n=t.slice();return n[35]=e[r],n[37]=r,n}function Dy(t){let e,r,n;return{c(){e=R("button"),e.textContent="Create note"},m(i,s){$(i,e,s),r||(n=Le(e,"click",t[12]),r=!0)},p:fe,d(i){i&&H(e),r=!1,n()}}}function Ty(t){let e,r=D.showCreateButton&&Dy(t);return{c(){r&&r.c(),e=or()},m(n,i){r&&r.m(n,i),$(n,e,i)},p(n,i){D.showCreateButton&&r.p(n,i)},d(n){r&&r.d(n),n&&H(e)}}}function Ec(t){let e,r,n;return{c(){e=R("div"),r=xe("\u23F3 Work in progress: "),n=xe(t[3]),ze(e,"text-align","center"),ze(e,"color","var(--text-accent)"),ze(e,"margin-top","10px")},m(i,s){$(i,e,s),I(e,r),I(e,n)},p(i,s){s[0]&8&&Ge(n,i[3])},d(i){i&&H(e)}}}function Dc(t){let e,r;function n(...i){return t[18](t[37],...i)}return e=new ol({props:{selected:t[37]===t[0],note:t[35]}}),e.$on("mousemove",n),e.$on("click",t[10]),e.$on("auxclick",t[19]),{c(){Be(e.$$.fragment)},m(i,s){Oe(e,i,s),r=!0},p(i,s){t=i;let o={};s[0]&1&&(o.selected=t[37]===t[0]),s[0]&4&&(o.note=t[35]),e.$set(o)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){re(e.$$.fragment,i),r=!1},d(i){Ee(e,i)}}}function Iy(t){let e;return{c(){e=xe("Searching...")},m(r,n){$(r,e,n)},p:fe,d(r){r&&H(e)}}}function ky(t){let e,r=D.simpleSearch&&t[1].split(At).some(Ic),n,i=r&&Tc(t);return{c(){e=xe(`We found 0 result for your search here.
      `),i&&i.c(),n=or()},m(s,o){$(s,e,o),i&&i.m(s,o),$(s,n,o)},p(s,o){o[0]&2&&(r=D.simpleSearch&&s[1].split(At).some(Ic)),r?i||(i=Tc(s),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(s){s&&H(e),i&&i.d(s),s&&H(n)}}}function Tc(t){let e,r,n;return{c(){e=R("br"),r=U(),n=R("span"),n.textContent=`You have enabled "Simpler Search" in the settings, try to type more
          characters.`,ze(n,"color","var(--text-accent)"),ze(n,"font-size","small")},m(i,s){$(i,e,s),$(i,r,s),$(i,n,s)},d(i){i&&H(e),i&&H(r),i&&H(n)}}}function Oy(t){let e,r,n,i=t[2],s=[];for(let f=0;f<i.length;f+=1)s[f]=Dc(Fc(t,i,f));let o=f=>re(s[f],1,1,()=>{s[f]=null});function a(f,h){if(!f[2].length&&f[1]&&!f[4])return ky;if(f[4])return Iy}let u=a(t,[-1,-1]),l=u&&u(t);return{c(){for(let f=0;f<s.length;f+=1)s[f].c();e=U(),r=R("div"),l&&l.c(),ze(r,"text-align","center")},m(f,h){for(let c=0;c<s.length;c+=1)s[c].m(f,h);$(f,e,h),$(f,r,h),l&&l.m(r,null),n=!0},p(f,h){if(h[0]&3077){i=f[2];let c;for(c=0;c<i.length;c+=1){let d=Fc(f,i,c);s[c]?(s[c].p(d,h),ee(s[c],1)):(s[c]=Dc(d),s[c].c(),ee(s[c],1),s[c].m(e.parentNode,e))}for(Bt(),c=i.length;c<s.length;c+=1)o(c);Nt()}u===(u=a(f,h))&&l?l.p(f,h):(l&&l.d(1),l=u&&u(f),l&&(l.c(),l.m(r,null)))},i(f){if(!n){for(let h=0;h<i.length;h+=1)ee(s[h]);n=!0}},o(f){s=s.filter(Boolean);for(let h=0;h<s.length;h+=1)re(s[h]);n=!1},d(f){xn(s,f),f&&H(e),f&&H(r),l&&l.d()}}}function Py(t){let e,r,n,i,s,o,a,u,l,f,h,c,d,v,w,x,p,b,m,g,_,y,j,C,S,E,P,L,O,z,J,q,Z,A,F,T,N,k,X,le,_e,Ce={initialValue:t[1],placeholder:"Omnisearch - Vault",$$slots:{default:[Ty]},$$scope:{ctx:t}};e=new ri({props:Ce}),t[16](e),e.$on("input",t[17]);let te=t[3]&&Ec(t);return i=new ni({props:{$$slots:{default:[Oy]},$$scope:{ctx:t}}}),{c(){Be(e.$$.fragment),r=U(),te&&te.c(),n=U(),Be(i.$$.fragment),s=U(),o=R("div"),a=R("div"),a.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',u=U(),l=R("div"),l.innerHTML=`<span class="prompt-instruction-command">alt \u2191\u2193</span> 
    <span>to cycle history</span>`,f=U(),h=R("div"),c=R("span"),d=xe(t[7]),v=R("span"),v.textContent="to open",w=U(),x=R("div"),x.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to In-File Search</span>`,p=U(),b=R("div"),m=R("span"),g=xe(t[6]),_=U(),y=R("span"),y.textContent="to open in a new pane",j=U(),C=R("div"),S=R("span"),E=xe(t[9]),P=U(),L=R("span"),L.textContent="to create",O=U(),z=R("div"),J=R("span"),q=xe(t[8]),Z=U(),A=R("span"),A.textContent="to create in a new pane",F=U(),T=R("div"),T.innerHTML=`<span class="prompt-instruction-command">alt \u21B5</span> 
    <span>to insert a link</span>`,N=U(),k=R("div"),k.innerHTML=`<span class="prompt-instruction-command">ctrl+h</span> 
    <span>to toggle excerpts</span>`,X=U(),le=R("div"),le.innerHTML='<span class="prompt-instruction-command">esc</span><span>to close</span>',B(a,"class","prompt-instruction"),B(l,"class","prompt-instruction"),B(c,"class","prompt-instruction-command"),B(h,"class","prompt-instruction"),B(x,"class","prompt-instruction"),B(m,"class","prompt-instruction-command"),B(b,"class","prompt-instruction"),B(S,"class","prompt-instruction-command"),B(C,"class","prompt-instruction"),B(J,"class","prompt-instruction-command"),B(z,"class","prompt-instruction"),B(T,"class","prompt-instruction"),B(k,"class","prompt-instruction"),B(le,"class","prompt-instruction"),B(o,"class","prompt-instructions")},m(Y,ge){Oe(e,Y,ge),$(Y,r,ge),te&&te.m(Y,ge),$(Y,n,ge),Oe(i,Y,ge),$(Y,s,ge),$(Y,o,ge),I(o,a),I(o,u),I(o,l),I(o,f),I(o,h),I(h,c),I(c,d),I(h,v),I(o,w),I(o,x),I(o,p),I(o,b),I(b,m),I(m,g),I(b,_),I(b,y),I(o,j),I(o,C),I(C,S),I(S,E),I(C,P),I(C,L),I(o,O),I(o,z),I(z,J),I(J,q),I(z,Z),I(z,A),I(o,F),I(o,T),I(o,N),I(o,k),I(o,X),I(o,le),_e=!0},p(Y,ge){let Ti={};ge[0]&2&&(Ti.initialValue=Y[1]),ge[1]&128&&(Ti.$$scope={dirty:ge,ctx:Y}),e.$set(Ti),Y[3]?te?te.p(Y,ge):(te=Ec(Y),te.c(),te.m(n.parentNode,n)):te&&(te.d(1),te=null);let yo={};ge[0]&23|ge[1]&128&&(yo.$$scope={dirty:ge,ctx:Y}),i.$set(yo),(!_e||ge[0]&128)&&Ge(d,Y[7]),(!_e||ge[0]&64)&&Ge(g,Y[6]),(!_e||ge[0]&512)&&Ge(E,Y[9]),(!_e||ge[0]&256)&&Ge(q,Y[8])},i(Y){_e||(ee(e.$$.fragment,Y),ee(i.$$.fragment,Y),_e=!0)},o(Y){re(e.$$.fragment,Y),re(i.$$.fragment,Y),_e=!1},d(Y){t[16](null),Ee(e,Y),Y&&H(r),te&&te.d(Y),Y&&H(n),Ee(i,Y),Y&&H(s),Y&&H(o)}}}var Ic=t=>t.length<3;function My(t,e,r){let n,i;bn(t,Ct,k=>r(15,i=k));let{modal:s}=e,{previousQuery:o}=e,a=0,u=0,l,f=[],h,c="",d=!0,v,w,x,p,b;zr(async()=>{G.enable("vault"),G.on("vault","enter",C),G.on("vault","create-note",O),G.on("vault","open-in-new-pane",S),G.on("vault","insert-link",z),G.on("vault","tab",J),G.on("vault","arrow-up",()=>q(-1)),G.on("vault","arrow-down",()=>q(1)),G.on("vault","prev-search-history",m),G.on("vault","next-search-history",g),await Fi(),D.showPreviousQueryResults&&r(13,o=(await we.getSearchHistory())[0])}),Vr(()=>{G.disable("vault")});async function m(){let k=(await we.getSearchHistory()).filter(X=>X);++u>=k.length&&(u=0),r(1,l=k[u]),v?.setInputValue(l)}async function g(){let k=(await we.getSearchHistory()).filter(X=>X);--u<0&&(u=k.length?k.length-1:0),r(1,l=k[u]),v?.setInputValue(l)}let _=null;async function y(){_&&(_.cancel(),_=null),h=new Jt(l),_=(0,Sc.cancelable)(new Promise(k=>{k(ve.getSuggestions(h))})),r(2,f=await _),r(0,a=0),await Z()}function j(k){!n||(k?.ctrlKey?S():C(),s.close())}function C(){!n||(P(n),s.close())}function S(){!n||(P(n,!0),s.close())}function E(){l&&we.addToSearchHistory(l)}function P(k,X=!1){E(),ii(k,X)}async function L(k){await O()}async function O(k){if(l){try{await Ya(l,k?.newLeaf)}catch(X){new Rt.Notice(X.message);return}s.close()}}function z(){if(!n)return;let k=app.vault.getMarkdownFiles().find(te=>te.path===n.path),X=app.workspace.getActiveFile(),le=app.workspace.getActiveViewOfType(Rt.MarkdownView);if(!le?.editor){new Rt.Notice("Omnisearch - Error - No active editor",3e3);return}let _e;k&&X?_e=app.fileManager.generateMarkdownLink(k,X.path):_e=`[[${n.basename}.${Yt(n.path)}]]`;let Ce=le.editor.getCursor();le.editor.replaceRange(_e,Ce,Ce),Ce.ch+=_e.length,le.editor.setCursor(Ce),s.close()}function J(){if(!(n&&(_r(n?.path)||!n?.matches.length)))if(E(),s.close(),n){let k=app.vault.getAbstractFileByPath(n.path);k&&k instanceof Rt.TFile&&new Rr(app,k,l).open()}else{let k=app.workspace.getActiveViewOfType(Rt.MarkdownView);k&&new Rr(app,k.file,l).open()}}function q(k){r(0,a=Zn(a+k,f.length)),Z()}async function Z(){await mt(),n&&activeWindow.document.querySelector(`[data-result-id="${n.path}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}function A(k){tt[k?"unshift":"push"](()=>{v=k,r(5,v)})}let F=k=>r(1,l=k.detail),T=(k,X)=>r(0,a=k),N=k=>{k.button==1&&S()};t.$$set=k=>{"modal"in k&&r(14,s=k.modal),"previousQuery"in k&&r(13,o=k.previousQuery)},t.$$.update=()=>{if(t.$$.dirty[0]&8194){e:r(1,l=l??o)}if(t.$$.dirty[0]&2){e:l?(r(4,d=!0),y().then(()=>{r(4,d=!1)})):(r(4,d=!1),r(2,f=[]))}if(t.$$.dirty[0]&5){e:n=f[a]}if(t.$$.dirty[0]&32768){e:switch(i){case We.LoadingCache:r(3,c="Loading cache...");break;case We.ReadingFiles:r(3,c="Reading files...");break;case We.IndexingFiles:r(3,c="Indexing files...");break;case We.WritingCache:y(),r(3,c="Updating cache...");break;default:y(),r(3,c="");break}}};e:D.openInNewPane?(r(6,w="\u21B5"),r(7,x=qt()+" \u21B5"),r(8,p="shift \u21B5"),r(9,b=qt()+" shift \u21B5")):(r(6,w=qt()+" \u21B5"),r(7,x="\u21B5"),r(8,p=qt()+" shift \u21B5"),r(9,b="shift \u21B5"));return[a,l,f,c,d,v,w,x,p,b,j,S,L,o,s,i,A,F,T,N]}var kc=class extends Ae{constructor(e){super();De(this,e,My,Py,be,{modal:14,previousQuery:13},null,[-1,-1])}},Oc=kc;var Rc=Fe(require("obsidian"));function Ry(t){let e,r=t[2].replace(t[3],St)+"";return{c(){e=R("div"),B(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&12&&r!==(r=n[2].replace(n[3],St)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function Ly(t){let e,r;return e=new si({props:{id:t[0].toString(),selected:t[1],$$slots:{default:[Ry]},$$scope:{ctx:t}}}),e.$on("mousemove",t[6]),e.$on("click",t[7]),e.$on("auxclick",t[8]),{c(){Be(e.$$.fragment)},m(n,i){Oe(e,n,i),r=!0},p(n,[i]){let s={};i&1&&(s.id=n[0].toString()),i&2&&(s.selected=n[1]),i&524&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){re(e.$$.fragment,n),r=!1},d(n){Ee(e,n)}}}function By(t,e,r){let n,i,{offset:s}=e,{note:o}=e,{index:a=0}=e,{selected:u=!1}=e;function l(c){Ve.call(this,t,c)}function f(c){Ve.call(this,t,c)}function h(c){Ve.call(this,t,c)}return t.$$set=c=>{"offset"in c&&r(4,s=c.offset),"note"in c&&r(5,o=c.note),"index"in c&&r(0,a=c.index),"selected"in c&&r(1,u=c.selected)},t.$$.update=()=>{if(t.$$.dirty&32){e:r(3,n=Ft(o.foundWords))}if(t.$$.dirty&48){e:r(2,i=vr(o?.content??"",s))}},[a,u,i,n,s,o,l,f,h]}var Pc=class extends Ae{constructor(e){super();De(this,e,By,Ly,be,{offset:4,note:5,index:0,selected:1})}},Mc=Pc;function Lc(t,e,r){let n=t.slice();return n[19]=e[r],n[21]=r,n}function Ny(t){let e;return{c(){e=R("div"),e.textContent="We found 0 result for your search here.",ze(e,"text-align","center")},m(r,n){$(r,e,n)},p:fe,i:fe,o:fe,d(r){r&&H(e)}}}function Ky(t){let e,r,n=t[4],i=[];for(let o=0;o<n.length;o+=1)i[o]=Bc(Lc(t,n,o));let s=o=>re(i[o],1,1,()=>{i[o]=null});return{c(){for(let o=0;o<i.length;o+=1)i[o].c();e=or()},m(o,a){for(let u=0;u<i.length;u+=1)i[u].m(o,a);$(o,e,a),r=!0},p(o,a){if(a&120){n=o[4];let u;for(u=0;u<n.length;u+=1){let l=Lc(o,n,u);i[u]?(i[u].p(l,a),ee(i[u],1)):(i[u]=Bc(l),i[u].c(),ee(i[u],1),i[u].m(e.parentNode,e))}for(Bt(),u=n.length;u<i.length;u+=1)s(u);Nt()}},i(o){if(!r){for(let a=0;a<n.length;a+=1)ee(i[a]);r=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)re(i[a]);r=!1},d(o){xn(i,o),o&&H(e)}}}function Bc(t){let e,r;function n(...i){return t[11](t[21],...i)}return e=new Mc({props:{offset:t[19],note:t[3],index:t[21],selected:t[21]===t[5]}}),e.$on("mousemove",n),e.$on("click",t[12]),e.$on("auxclick",t[13]),{c(){Be(e.$$.fragment)},m(i,s){Oe(e,i,s),r=!0},p(i,s){t=i;let o={};s&16&&(o.offset=t[19]),s&8&&(o.note=t[3]),s&32&&(o.selected=t[21]===t[5]),e.$set(o)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){re(e.$$.fragment,i),r=!1},d(i){Ee(e,i)}}}function zy(t){let e,r,n,i,s=[Ky,Ny],o=[];function a(u,l){return u[4].length&&u[3]?0:1}return e=a(t,-1),r=o[e]=s[e](t),{c(){r.c(),n=or()},m(u,l){o[e].m(u,l),$(u,n,l),i=!0},p(u,l){let f=e;e=a(u,l),e===f?o[e].p(u,l):(Bt(),re(o[f],1,1,()=>{o[f]=null}),Nt(),r=o[e],r?r.p(u,l):(r=o[e]=s[e](u),r.c()),ee(r,1),r.m(n.parentNode,n))},i(u){i||(ee(r),i=!0)},o(u){re(r),i=!1},d(u){o[e].d(u),u&&H(n)}}}function Vy(t){let e;return{c(){e=R("span"),e.textContent="to close"},m(r,n){$(r,e,n)},d(r){r&&H(e)}}}function Hy(t){let e;return{c(){e=R("span"),e.textContent="to go back to Vault Search"},m(r,n){$(r,e,n)},d(r){r&&H(e)}}}function $y(t){let e,r,n,i,s,o,a,u,l,f,h,c,d,v,w,x,p,b,m,g;e=new ri({props:{placeholder:"Omnisearch - File",initialValue:t[1]}}),e.$on("input",t[10]),n=new ni({props:{$$slots:{default:[zy]},$$scope:{ctx:t}}});function _(C,S){return C[0]?Hy:Vy}let y=_(t,-1),j=y(t);return{c(){Be(e.$$.fragment),r=U(),Be(n.$$.fragment),i=U(),s=R("div"),o=R("div"),o.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=U(),u=R("div"),u.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',l=U(),f=R("div"),f.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to Vault Search</span>`,h=U(),c=R("div"),d=R("span"),d.textContent="esc",v=U(),j.c(),w=U(),x=R("div"),p=R("span"),p.textContent=`${qt()} \u21B5`,b=U(),m=R("span"),m.textContent="to open in a new pane",B(o,"class","prompt-instruction"),B(u,"class","prompt-instruction"),B(f,"class","prompt-instruction"),B(d,"class","prompt-instruction-command"),B(c,"class","prompt-instruction"),B(p,"class","prompt-instruction-command"),B(x,"class","prompt-instruction"),B(s,"class","prompt-instructions")},m(C,S){Oe(e,C,S),$(C,r,S),Oe(n,C,S),$(C,i,S),$(C,s,S),I(s,o),I(s,a),I(s,u),I(s,l),I(s,f),I(s,h),I(s,c),I(c,d),I(c,v),j.m(c,null),I(s,w),I(s,x),I(x,p),I(x,b),I(x,m),g=!0},p(C,[S]){let E={};S&2&&(E.initialValue=C[1]),e.$set(E);let P={};S&4194360&&(P.$$scope={dirty:S,ctx:C}),n.$set(P),y!==(y=_(C,S))&&(j.d(1),j=y(C),j&&(j.c(),j.m(c,null)))},i(C){g||(ee(e.$$.fragment,C),ee(n.$$.fragment,C),g=!0)},o(C){re(e.$$.fragment,C),re(n.$$.fragment,C),g=!1},d(C){Ee(e,C),C&&H(r),Ee(n,C),C&&H(i),C&&H(s),j.d()}}}function Wy(t,e,r){let n=t.find(i=>i.offset>e);return n?t.filter(i=>i.offset>e&&i.offset<=n.offset+r):[]}function Uy(t,e,r){let{modal:n}=e,{parent:i=null}=e,{singleFilePath:s=""}=e,{previousQuery:o}=e,a,u=[],l=0,f,h;zr(()=>{G.enable("infile"),G.on("infile","enter",x),G.on("infile","open-in-new-pane",w),G.on("infile","arrow-up",()=>d(-1)),G.on("infile","arrow-down",()=>d(1)),G.on("infile","tab",p)}),Vr(()=>{G.disable("infile")});function c(y){let j=[],C=-1,S=0;for(;;){let E=Wy(y,C,cn);if(!E.length||(C=E.last().offset,j.push(E),++S>100))break}return j}function d(y){r(5,l=Zn(l+y,u.length)),v()}async function v(){await mt(),document.querySelector(`[data-result-id="${l}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}async function w(){return x(!0)}async function x(y=!1){if(f){n.close(),i&&i.close(),await ii(f,y);let j=app.workspace.getActiveViewOfType(Rc.MarkdownView);if(!j)return;let C=u[l]??0,S=j.editor.offsetToPos(C);S.ch=0,j.editor.setCursor(S),j.editor.scrollIntoView({from:{line:S.line-10,ch:0},to:{line:S.line+10,ch:0}})}}function p(){new er(app,a??o).open(),n.close()}let b=y=>r(2,a=y.detail),m=(y,j)=>r(5,l=y),g=y=>x(y.ctrlKey),_=y=>{y.button==1&&x(!0)};return t.$$set=y=>{"modal"in y&&r(7,n=y.modal),"parent"in y&&r(0,i=y.parent),"singleFilePath"in y&&r(8,s=y.singleFilePath),"previousQuery"in y&&r(1,o=y.previousQuery)},t.$$.update=()=>{if(t.$$.dirty&2){e:r(2,a=o??"")}if(t.$$.dirty&772){e:(async()=>{a&&(r(9,h=new Jt(a)),r(3,f=(await ve.getSuggestions(h,{singleFilePath:s}))[0]??null)),r(5,l=0),await v()})()}if(t.$$.dirty&8){e:if(f){let y=c(f.matches);r(4,u=y.map(j=>Math.round((j.first().offset+j.last().offset)/2)))}}},[i,o,a,f,u,l,x,n,s,h,b,m,g,_]}var Nc=class extends Ae{constructor(e){super();De(this,e,Uy,$y,be,{modal:7,parent:0,singleFilePath:8,previousQuery:1})}},Kc=Nc;var ho=class extends zc.Modal{constructor(e){super(e);this.modalEl.replaceChildren(),this.modalEl.addClass("omnisearch-modal","prompt"),this.modalEl.removeClass("modal"),this.modalEl.tabIndex=-1,this.scope.register([],"ArrowDown",o=>{o.preventDefault(),G.emit("arrow-down")}),this.scope.register([],"ArrowUp",o=>{o.preventDefault(),G.emit("arrow-up")});for(let o of[{k:"J",dir:"down"},{k:"K",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],o.k,u=>{this.app.vault.getConfig("vimMode")&&G.emit("arrow-"+o.dir)});for(let o of[{k:"N",dir:"down"},{k:"P",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],o.k,u=>{this.app.vault.getConfig("vimMode")&&G.emit("arrow-"+o.dir)});let r,n,i,s;D.openInNewPane?(r=["Mod"],n=[],i=["Mod","Shift"],s=["Shift"]):(r=[],n=["Mod"],i=["Shift"],s=["Mod","Shift"]),this.scope.register(n,"Enter",o=>{o.preventDefault(),G.emit("open-in-new-pane")}),this.scope.register(["Alt"],"Enter",o=>{o.preventDefault(),G.emit("insert-link")}),this.scope.register(i,"Enter",o=>{o.preventDefault(),G.emit("create-note")}),this.scope.register(s,"Enter",o=>{o.preventDefault(),G.emit("create-note",{newLeaf:!0})}),this.scope.register(r,"Enter",o=>{ka()||(o.preventDefault(),G.emit("enter"))}),this.scope.register([],"Tab",o=>{o.preventDefault(),G.emit("tab")}),this.scope.register(["Alt"],"ArrowDown",o=>{o.preventDefault(),G.emit("next-search-history")}),this.scope.register(["Alt"],"ArrowUp",o=>{o.preventDefault(),G.emit("prev-search-history")}),this.scope.register(["Ctrl"],"H",o=>{G.emit(Yn.ToggleExcerpts)})}},er=class extends ho{constructor(e,r){super(e);let n=new Oc({target:this.modalEl,props:{modal:this,previousQuery:r}});this.onClose=()=>{n.$destroy()}}},Rr=class extends ho{constructor(e,r,n="",i){super(e);let s=new Kc({target:this.modalEl,props:{modal:this,singleFilePath:r.path,parent:i,previousQuery:n}});i&&i.containerEl.toggleVisibility(!1),this.onClose=()=>{i&&i.containerEl.toggleVisibility(!0),s.$destroy()}}};var Vc=!1,Di=[];function Gy(t){return t.map(e=>{let{score:r,path:n,basename:i,foundWords:s,matches:o,content:a}=e,u=vr(a,o[0]?.offset??-1);return{score:r,path:n,basename:i,foundWords:s,matches:o.map(l=>({match:l.match,offset:l.offset})),excerpt:u}})}async function Qy(t){let e=new Jt(t),r=await ve.getSuggestions(e);return Gy(r)}function qy(t){Di.push(t),Vc&&t()}function Yy(t){Di=Di.filter(e=>e!==t)}function Hc(){Vc=!0,Di.forEach(t=>t())}var mo={search:Qy,registerOnIndexed:qy,unregisterOnIndexed:Yy,refreshIndex:Fi};var go=class extends Lr.Plugin{async onload(){if(await Aa(this),this.addSettingTab(new ks(this)),Os()){console.log("Omnisearch - Plugin disabled");return}await Jy(),await yr.clearOldDatabases(),Xy(this),D.ribbonIcon&&this.addRibbonButton(),G.disable("vault"),G.disable("infile"),G.on("global",Yn.ToggleExcerpts,()=>{Gt.set(!D.showExcerpt)}),this.addCommand({id:"show-modal",name:"Vault search",callback:()=>{new er(app).open()}}),this.addCommand({id:"show-modal-infile",name:"In-file search",editorCallback:(e,r)=>{r.file&&new Rr(app,r.file).open()}}),app.workspace.onLayoutReady(async()=>{this.registerEvent(this.app.vault.on("create",e=>{dn(e.path)&&(de("Indexing new file",e.path),ve.addFromPaths([e.path]))})),this.registerEvent(this.app.vault.on("delete",e=>{de("Removing file",e.path),we.removeFromLiveCache(e.path),ve.removeFromPaths([e.path])})),this.registerEvent(this.app.vault.on("modify",async e=>{dn(e.path)&&(de("Updating file",e.path),await we.addToLiveCache(e.path),Cc(e))})),this.registerEvent(this.app.vault.on("rename",async(e,r)=>{dn(e.path)&&(de("Renaming file",e.path),we.removeFromLiveCache(r),we.addToLiveCache(e.path),ve.removeFromPaths([r]),await ve.addFromPaths([e.path]))})),this.executeFirstLaunchTasks(),await this.populateIndex()})}executeFirstLaunchTasks(){let e="1.10.1";if(D.welcomeMessage!==e){let r=new DocumentFragment;r.createSpan({},n=>{n.innerHTML="\u{1F50E} Omnisearch now requires the <strong>Text Extractor</strong> plugin to index PDF and images. See Omnisearch settings for more information."}),new Lr.Notice(r,2e4)}D.welcomeMessage=e,this.saveData(D)}async onunload(){delete globalThis.omnisearch,await Ne.clearCache()}addRibbonButton(){this.ribbonButton=this.addRibbonIcon("search","Omnisearch",e=>{new er(app).open()})}removeRibbonButton(){this.ribbonButton&&this.ribbonButton.parentNode?.removeChild(this.ribbonButton)}async populateIndex(){console.time("Omnisearch - Indexing total time"),Ct.set(We.ReadingFiles);let e=app.vault.getFiles().filter(n=>dn(n.path));console.log(`Omnisearch - ${e.length} files total`),console.log(`Omnisearch - Cache is ${jt()?"enabled":"disabled"}`),jt()&&(console.time("Omnisearch - Loading index from cache"),Ct.set(We.LoadingCache),await ve.loadCache()&&console.timeEnd("Omnisearch - Loading index from cache"));let r=ve.getDiff(e.map(n=>({path:n.path,mtime:n.stat.mtime})));jt()&&(r.toAdd.length&&console.log("Omnisearch - Total number of files to add/update: "+r.toAdd.length),r.toRemove.length&&console.log("Omnisearch - Total number of files to remove: "+r.toRemove.length)),r.toAdd.length>=1e3&&jt()&&new Lr.Notice(`Omnisearch - ${r.toAdd.length} files need to be indexed. Obsidian may experience stutters and freezes during the process`,1e4),Ct.set(We.IndexingFiles),ve.removeFromPaths(r.toRemove.map(n=>n.path)),await ve.addFromPaths(r.toAdd.map(n=>n.path)),(r.toRemove.length||r.toAdd.length)&&jt()&&(Ct.set(We.WritingCache),D.useCache=!1,ue(this),await ve.writeToCache(),D.useCache=!0,ue(this)),console.timeEnd("Omnisearch - Indexing total time"),r.toAdd.length>=1e3&&new Lr.Notice("Omnisearch - Your files have been indexed."),Ct.set(We.Done),Hc()}};async function Jy(){let t=[`${app.vault.configDir}/plugins/omnisearch/searchIndex.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.data`,`${app.vault.configDir}/plugins/omnisearch/searchIndex.data`,`${app.vault.configDir}/plugins/omnisearch/historyCache.json`,`${app.vault.configDir}/plugins/omnisearch/pdfCache.data`];for(let e of t)if(await app.vault.adapter.exists(e))try{await app.vault.adapter.remove(e)}catch{}}function Xy(t){t.registerObsidianProtocolHandler("omnisearch",e=>{new er(app,e.query).open()}),globalThis.omnisearch=mo,app.plugins.plugins.omnisearch.api=mo}
